###########################
# Central American Decisions
###########################
# By Beelzebub
###########################
Forming_Central_America = {
	CEN_unite_central_america = {
		icon = generic_prepare_civil_war

		allowed = { always = no } #activated in the history file

		available = {
			if = {
				limit = { original_tag = GUA }
				custom_override_tooltip = {
					tooltip = CEN_four_political_foci_completed
					has_completed_focus = GUA_death_letter
					NOT = {
						has_idea = GUA_civil_war1
						has_idea = GUA_civil_war2
						has_idea = GUA_civil_war3
						has_idea = GUA_civil_war4
					}
				}
			}
			else_if = {
				limit = { original_tag = ELS }
				custom_override_tooltip = {
					tooltip = CEN_four_political_foci_completed
					check_variable = { ELS_political_foci_count > 3 }
				}
			}
			else_if = {
				limit = { original_tag = HON }
				custom_override_tooltip = {
					tooltip = CEN_four_political_foci_completed
					check_variable = { HON_political_foci_count > 3 }
				}
			}
			else_if = {
				limit = { original_tag = NIC }
				custom_override_tooltip = {
					tooltip = CEN_four_political_foci_completed
					check_variable = { NIC_political_foci_count > 3 }
				}
			}
			is_valid_peace_target = yes
			has_war = no
			312 = { is_owned_by_ROOT_or_ally = yes } #Honduras
			313 = { is_owned_by_ROOT_or_ally = yes } #Guatemala
			314 = { is_owned_by_ROOT_or_ally = yes } #El Salvador
			317 = { is_owned_by_ROOT_or_ally = yes } #Managua
			if = {
				limit = { original_tag = PAN }
				316 = { is_owned_by_ROOT_or_ally = yes } #Costa Rica
			}
		}

		cost = 0
		fire_only_once = yes

		ai_will_do = { factor = 1000 }

		complete_effect = {
			log = "[GetLogRoot]: Decision complete CEN_unite_central_america"
			# Clearing variables
			clear_variable = ELS_political_foci_count
			clear_variable = HON_political_foci_count
			clear_variable = NIC_political_foci_count
			# If Costa Rica is the unifier, handle it through their unique event
			if = {
				limit = { original_tag = COS }
				country_event = central_america_democratic_events.250
			}
			# Otherwise fire the whole effect here
			else = {
				CEN_initiate_unification = yes
				hidden_effect = {
					## Dismantle any unifier leader faction before annexing tags to avoid CTD on Linux/MacOS
					if = {
						limit = { is_faction_leader = yes }
						dismantle_faction = yes
					}
				}
				CEN_complete_unification = yes
			}
		}
		fixed_random_seed = no
	}
	CEN_conflict_escalates_mission = {
		icon = generic_ignite_civil_war
		priority = 100
		allowed = { always = no }	#manually activated
		available = {
			hidden_trigger = {
				always = no
			}
		}
		days_mission_timeout = 30
		timeout_effect = {
			log = "[GetLogRoot]: Decision timeout CEN_conflict_escalates_mission"
			add_political_power = 20
			set_global_flag = CEN_the_conflict_begins
			custom_effect_tooltip = CEN_sparks_flying
			if = {
				limit = { num_faction_members < 4 }
				if = {
					limit = { tag = GUA }
					if = {
						limit = {
							is_in_faction_with = ELS
							is_in_faction_with = HON
						}
						CEN = { add_to_variable = { CEN_lose_manpower_var = 5000 } }
					}
					else_if = {
						limit = {
							NOT = {
								is_in_faction_with = ELS
								is_in_faction_with = HON
							}
						}
						CEN = { add_to_variable = { CEN_lose_manpower_var = 17000 } }
					}
					else = {
						CEN = { add_to_variable = { CEN_lose_manpower_var = 13500 } }
					}
				}
				else_if = {
					limit = { tag = ELS }
					if = {
						limit = {
							is_in_faction_with = GUA
							is_in_faction_with = HON
						}
						CEN = { add_to_variable = { CEN_lose_manpower_var = 5000 } }
					}
					else_if = {
						limit = { is_in_faction_with = HON }
						CEN = { add_to_variable = { CEN_lose_manpower_var = 9000 } }
					}
					else = {
						CEN = { add_to_variable = { CEN_lose_manpower_var = 12500 } }
					}
				}
				else_if = {
					limit = { tag = HON }
					if = {
						limit = { is_in_faction_with = GUA }
						CEN = { add_to_variable = { CEN_lose_manpower_var = 8000 } }
					}
					else_if = {
						limit = { NIC = { has_country_flag = NIC_government_distrusted_flag } }
						if = {
							limit = { is_in_faction_with = ELS }
							CEN = { add_to_variable = { CEN_lose_manpower_var = 11500 } }
						}
						else = {
							CEN = { add_to_variable = { CEN_lose_manpower_var = 14000 } }
						}
					}
					else = {
						if = {
							limit = { is_in_faction_with = ELS }
							CEN = { add_to_variable = { CEN_lose_manpower_var = 8500 } }
						}
						else = {
							CEN = { add_to_variable = { CEN_lose_manpower_var = 11000 } }
						}
					}
				}
				else_if = {
					limit = { tag = NIC }
					if = {
						limit = { has_country_flag = NIC_government_distrusted_flag }
						if = {
							limit = {
								OR = {
									is_in_faction_with = GUA
									is_in_faction_with = ELS
								}
								is_in_faction_with = HON
							}
							CEN = { add_to_variable = { CEN_lose_manpower_var = 9000 } }
						}
						else = {
							CEN = { add_to_variable = { CEN_lose_manpower_var = 14000 } }
						}
					}
					else = {
						if = {
							limit = {
								OR = {
									is_in_faction_with = GUA
									is_in_faction_with = ELS
								}
								is_in_faction_with = HON
							}
							CEN = { add_to_variable = { CEN_lose_manpower_var = 6000 } }
						}
						CEN = { add_to_variable = { CEN_lose_manpower_var = 11000 } }
					}
				}
			}
		}
		fixed_random_seed = no
	}
	CEN_form_ties = {
		icon = GFX_decision_generic_agreement
		allowed = {
			OR = {
				tag = NIC
				tag = HON
				tag = ELS
				tag = GUA
			}
		}
		visible = {
			if = {
				limit = {
					has_authoritarian_government = yes
				}
				date > 1937.10.1
			}
			FROM = {
				exists = yes
				CEN_country_is_friendly = yes
				NOT = {
					has_country_flag = CEN_already_formed_ties_with_@ROOT
				}
			}
		}
		targets = { NIC HON ELS GUA }
		target_trigger = {
			FROM = {
				CEN_country_is_friendly = yes
				NOT = { has_country_flag = CEN_already_formed_ties_with_@ROOT }
			}
		}
		ai_will_do = { factor = 100 }
		fire_only_once = yes
		complete_effect = {
			log = "[GetLogRoot][GetLogFrom]: Decision complete CEN_form_ties"
			set_country_flag = CEN_already_formed_ties_with_@FROM
			add_political_power = 20
			FROM = {
				set_country_flag = CEN_already_formed_ties_with_@ROOT
				country_event = central_america_unification_events.1
			}
		}
		fixed_random_seed = no
	}
	CEN_found_revolutionary_pact = {
		icon = GFX_decision_generic_political_discourse
		allowed = {
			OR = {
				tag = ELS
				tag = GUA
				tag = HON
				tag = NIC
			}
		}
		available = {
			is_in_faction = no
			date > 1938.3.1
		}
		visible = {
			has_socialist_government = yes
			NOT = { has_event_target = CEN_socialist_leader }
		}
		cost = 30
		fire_only_once = yes
		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					ELS = {
						is_ai = no
						has_socialist_government = yes
					}
					GUA = {
						is_ai = no
						has_socialist_government = yes
					}
					HON = {
						is_ai = no
						has_socialist_government = yes
					}
					NIC = {
						is_ai = no
						has_socialist_government = yes
					}
				}
			}
		}
		complete_effect = {
			log = "[GetLogRoot]: Decision complete CEN_found_revolutionary_pact"
			CEN_conflict_escalates = yes
			save_global_event_target_as = CEN_socialist_leader
			create_faction_from_template = { template = faction_template_internationale_successor name = faction_revolutionary_front }
			set_faction_manifest = faction_manifest_unite_central_america
			hidden_effect = { set_as_temporary_faction = yes }
			every_other_country = {
				limit = {
					OR = {
						tag = ELS
						tag = GUA
						tag = HON
						tag = NIC
					}
				}
				country_event = { id = central_america_unification_events.5 days = 1 }
			}
		}
		fixed_random_seed = no
	}
	CEN_found_liberal_pact = {
		icon = GFX_decision_generic_political_discourse
		allowed = {
			OR = {
				tag = ELS
				tag = GUA
				tag = HON
				tag = NIC
			}
		}
		available = {
			is_in_faction = no
			is_subject = no
			date > 1938.3.1
			if = {
				limit = {
					tag = GUA
					has_government = social_democrat
				}
				has_completed_focus = GUA_new_election
			}
		}
		visible = {
			has_elected_government = yes
			NOT = { has_event_target = CEN_liberal_leader }
		}
		cost = 30
		fire_only_once = yes
		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					ELS = {
						is_ai = no
						has_elected_government = yes
					}
					GUA = {
						is_ai = no
						has_elected_government = yes
					}
					HON = {
						is_ai = no
						has_elected_government = yes
					}
					NIC = {
						is_ai = no
						has_elected_government = yes
					}
				}
			}
		}
		complete_effect = {
			log = "[GetLogRoot]: Decision complete CEN_found_liberal_pact"
			CEN_conflict_escalates = yes
			save_global_event_target_as = CEN_liberal_leader
			create_faction_from_template = { template = faction_template_defender_of_democracy name = faction_liberal_pact }
			set_faction_manifest = faction_manifest_unite_central_america
			hidden_effect = { set_as_temporary_faction = yes }
			every_other_country = {
				limit = {
					OR = {
						tag = ELS
						tag = GUA
						tag = HON
						tag = NIC
					}
				}
				country_event = { id = central_america_unification_events.6 days = 1 }
			}
		}
		fixed_random_seed = no
	}
	CEN_found_military_pact = {
		icon = GFX_decision_generic_political_discourse
		allowed = {
			OR = {
				tag = ELS
				tag = GUA
				tag = HON
				tag = NIC
			}
		}
		available = {
			is_in_faction = no
			date > 1938.3.1
		}
		visible = {
			has_authoritarian_government = yes
			NOT = { has_event_target = CEN_military_leader }
		}
		cost = 30
		fire_only_once = yes
		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					ELS = {
						is_ai = no
						has_authoritarian_government = yes
					}
					GUA = {
						is_ai = no
						has_authoritarian_government = yes
					}
					HON = {
						is_ai = no
						has_authoritarian_government = yes
					}
					NIC = {
						is_ai = no
						has_authoritarian_government = yes
					}
				}
			}
		}
		complete_effect = {
			log = "[GetLogRoot]: Decision complete CEN_found_military_pact"
			CEN_conflict_escalates = yes
			save_global_event_target_as = CEN_military_leader
			create_faction_from_template = { template = faction_template_harbinger_of_a_new_order name = faction_peoples_vanguard }
			set_faction_manifest = faction_manifest_unite_central_america
			hidden_effect = { set_as_temporary_faction = yes }
			every_other_country = {
				limit = {
					OR = {
						tag = ELS
						tag = GUA
						tag = HON
						tag = NIC
					}
				}
				country_event = { id = central_america_unification_events.7 days = 1 }
			}
		}
		fixed_random_seed = no
	}
	CEN_join_faction = {
		icon = GFX_decision_generic_agreement
		allowed = {
			OR = {
				tag = ELS
				tag = GUA
				tag = HON
				tag = NIC
			}
		}
		visible = {
			is_in_faction = no
			if = {
				limit = {
					has_socialist_government = yes
				}
				country_exists = event_target:CEN_socialist_leader
				event_target:CEN_socialist_leader = {
					is_faction_leader = yes
					has_socialist_government = yes
					NOT = { has_war_with = ROOT }
				}
			}
			else_if = {
				limit = {
					has_authoritarian_government = yes
				}
				country_exists = event_target:CEN_military_leader
				event_target:CEN_military_leader = {
					is_faction_leader = yes
					has_authoritarian_government = yes
					NOT = { has_war_with = ROOT }
				}
			}
			else = {
				country_exists = event_target:CEN_liberal_leader
				event_target:CEN_liberal_leader = {
					is_faction_leader = yes
					has_elected_government = yes
					NOT = { has_war_with = ROOT }
				}
			}
		}
		cost = 0
		ai_will_do = { factor = 800 }
		complete_effect = {
			log = "[GetLogRoot]: Decision complete CEN_join_faction"
			if = {
				limit = { has_socialist_government = yes }
				event_target:CEN_socialist_leader = { country_event = central_america_unification_events.8 }
			}
			else_if = {
				limit = { has_authoritarian_government = yes }
				event_target:CEN_military_leader = { country_event = central_america_unification_events.8 }
			}
			else = {
				event_target:CEN_liberal_leader = { country_event = central_america_unification_events.8 }
			}
		}
		fixed_random_seed = no
	}
	CEN_leave_faction = {
		icon = GFX_decision_generic_agreement
		allowed = {
			OR = {
				tag = ELS
				tag = GUA
				tag = HON
				tag = NIC
			}
		}
		visible = {
			is_in_faction = yes
			if = {
				limit = { is_faction_leader = yes }
				OR = {
					AND = {
						tag = event_target:CEN_socialist_leader
						has_socialist_government = no
					}
					AND = {
						tag = event_target:CEN_liberal_leader
						has_elected_government = no
					}
					AND = {
						tag = event_target:CEN_military_leader
						has_authoritarian_government = no
					}
				}
			}
			else = {
				faction_leader = {
					is_central_american_tag = yes
					same_government_type_as_ROOT_authoritarian = no
				}
			}
		}
		cost = 0
		ai_will_do = { factor = 800 }
		complete_effect = {
			log = "[GetLogRoot]: Decision complete CEN_leave_faction"
			if = {
				limit = { is_faction_leader = yes }
				if = {
					limit = { tag = event_target:CEN_socialist_leader }
					clear_global_event_target = CEN_socialist_leader
				}
				if = {
					limit = { tag = event_target:CEN_liberal_leader }
					clear_global_event_target = CEN_liberal_leader
				}
				if = {
					limit = { tag = event_target:CEN_military_leader }
					clear_global_event_target = CEN_military_leader
				}
				dismantle_faction = yes
			}
			else = {
				leave_faction = yes
			}
		}
		fixed_random_seed = no
	}
	CEN_invite_country_to_faction = {
		icon = GFX_decision_generic_agreement
		allowed = {
			OR = {
				tag = GUA
				tag = ELS
				tag = HON
				tag = NIC
			}
		}
		visible = {
			is_faction_leader = yes
			FROM = {
				exists = yes
				CEN_country_is_friendly = yes
				is_subject = no
				is_in_faction = no
				has_capitulated = no
				NOT = { has_war_with = ROOT }
			}
		}
		targets = { GUA ELS HON NIC }
		target_root_trigger = {
			is_faction_leader = yes
		}
		target_trigger = {
			FROM = {
				CEN_country_is_friendly = yes
				is_subject = no
				is_in_faction = no
				NOT = { has_war_with = ROOT }
			}
		}
		cost = 0
		ai_will_do = { factor = 800 }
		complete_effect = {
			log = "[GetLogRoot][GetLogFrom]: Decision complete CEN_invite_country_to_faction"
			FROM = { country_event = central_america_unification_events.9 }
		}
		fixed_random_seed = no
	}
	# War stuff
	CEN_attack_country = {
		icon = GFX_decision_generic_ignite_civil_war
		allowed = {
			OR = {
				tag = ELS
				tag = NIC
				tag = HON
				tag = GUA
			}
		}

		available = {
			OR = {
				is_neighbor_of = FROM
				FROM = { any_home_area_neighbor_country = { is_ally_with = ROOT } }
			}
			if = {
				limit = { FROM = { original_tag = NIC } }
				FROM = {
					OR = {
						has_country_flag = NIC_liberal_revolution_flag
						has_country_flag = NIC_socialist_revolution_flag
					}
				}
			}
		}

		visible = {
			has_global_flag = CEN_the_conflict_begins
			can_declare_war_on = FROM
			FROM = { CEN_country_is_friendly = no }
		}

		cancel_trigger = {
			OR = {
				NOT = { can_declare_war_on = FROM }
				if = {
					limit = { FROM = { is_subject = yes } }
					if = {
						limit = { has_socialist_government = yes }
						var:FROM.overlord = {
							if = {
								limit = { tag = NIC }
								OR = {
									has_socialist_government = yes
									has_government = social_democrat
								}
							}
							else = {
								has_socialist_government = yes
							}
						}
					}
					else_if = {
						limit = { has_authoritarian_government = yes }
						var:FROM.overlord = { has_authoritarian_government = yes }
					}
					else = {
						var:FROM.overlord = {
							if = {
								limit = { tag = NIC }
								has_elected_government = yes
								NOT = { has_government = social_democrat }
							}
							else = {
								has_elected_government = yes
							}
						}
					}
				}
				else_if = {
					limit = { has_socialist_government = yes }
					FROM = {
						if = {
							limit = { tag = NIC }
							OR = {
								has_government = social_democrat
								has_socialist_government = yes
							}
						}
						else = {
							has_socialist_government = yes
						}
					}
				}
				else_if = {
					limit = { has_authoritarian_government = yes }
					FROM = { has_authoritarian_government = yes }
				}
				else = {
					FROM = {
						if = {
							limit = { tag = NIC }
							has_elected_government = yes
							NOT = { has_government = social_democrat }
						}
						else = {
							has_elected_government = yes
						}
					}
				}
			}
		}

		cost = 20
		days_remove = 25
		war_with_target_on_remove = yes

		targets = { GUA ELS HON NIC }
		target_root_trigger = {
			has_global_flag = CEN_the_conflict_begins
		}
		target_trigger = {
			can_declare_war_on = FROM
			FROM = { CEN_country_is_friendly = no }
		}

		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				country_has_any_active_threat = yes
			}
			modifier = {
				factor = 0
				FROM = { default_attack_AI_trigger = yes }
			}
			modifier = {
				factor = 0
				FROM = { dont_start_major_faction_wars = yes }
			}
		}
		cancel_effect = {
			log = "[GetLogRoot][GetLogFrom]: Decision cancel CEN_attack_country"
			add_political_power = 20
			clear_decision_attack_AI = yes
		}

		complete_effect = {
			log = "[GetLogRoot][GetLogFrom]: Decision complete CEN_attack_country"
			FROM = { country_event = central_america_unification_events.34 } #warning event
			setup_decision_attack_AI = yes
		}

		remove_effect = {
			log = "[GetLogRoot][GetLogFrom]: Decision remove CEN_attack_country"
			clear_decision_attack_AI = yes
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
		fixed_random_seed = no
	}
	CEN_core_matagalpa = {
		icon = GFX_decision_generic_nationalism
		allowed = {
			tag = CEN
		}
		available = {
			has_full_control_of_state = 1071
		}
		visible = {
			owns_state = 1071
			1071 = { has_dynamic_modifier = { modifier = conscription_exemptions_granted } }
		}
		cost = 0
		days_remove = 100
		fire_only_once = yes
		ai_will_do = { factor = 100 }

		remove_effect = {
			log = "[GetLogRoot]: Decision remove CEN_core_matagalpa"
			1071 = { remove_dynamic_modifier = { modifier = conscription_exemptions_granted } }
		}
		fixed_random_seed = no
	}
}

