##################################
#    Left Kuomintang Effects     #
##################################
# By Suzuha and Chiang Kai-Shrek #
##################################

########################################
#########- Table of Contents - #########
########################################

#Section 1: League War Effects
#Section 2: Power Struggle Effects
#Section 3: Mid Game Effects
#Section 4: Late Game Effects
#Section 5: End Game Effects

########################################
#####- Section 1: League War - #########
########################################

#Cancel this to test advisors
CHI_setup_hide_commander_effect = {
	set_character_flag = CHN_original_unit_leader
	retire = yes
}

CHI_setup_hide_political_advisor_effect = {
	retire = yes
}

CHI_spawn_fujian_revolt = {
	set_global_flag = LEP_war
	if = {
		limit = { has_template = "Fujian Bubing Zhen" }
		delete_unit_template_and_units = { division_template = "Fujian Bubing Zhen" }
	}
	custom_effect_tooltip = tooltip_white_line
	595 = { #Nanping
		damage_building = { type = infrastructure damage = 0.5 }
		effect_tooltip = { set_state_controller_to = CHI }
	}
	1046 = { #Longyan
		damage_building = { type = infrastructure damage = 0.5 }
		effect_tooltip = { set_state_controller_to = CHI }
	}
	hidden_effect = { #Spawned units are named after historical NRA divisions from the 1st, 4th, and 6th Army Corps
		1046 = { #Longyan
			set_demilitarized_zone = no
			set_state_controller_to = CHI
			create_unit = {
				division = "name = \"Di shi er shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #12th Division of the 4th Army, Yue Army
				prioritize_location = 10010
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di shi shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #10th Division of the 4th Army, Yue Army
				prioritize_location = 7099
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di shisi shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #14th Division of the 1st Army
				prioritize_location = 12084
				owner = CHI
			}
		}
		595 = { #Nanping
			set_demilitarized_zone = no
			set_state_controller_to = CHI
			create_unit = {
				division = "name = \"Di er shiwu shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #25th Division of the 4th Army, Yue Army
				prioritize_location = 1138
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di er shiyi shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #21th Division of the 4th Army, Yue Army
				prioritize_location = 1006
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di shiqi shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #17th Division of the 6th Army Corps - Hunan Army
				prioritize_location = 1193
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di shiba shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #18th Division of the 6th Army Corps
				prioritize_location = 12057
				owner = CHI
			}
		}
		CHI = {
			end_exile = CHI
			leave_faction = yes

			set_province_controller = 12030
			set_province_controller = 10112
			set_province_controller = 4081
			CHI_wang_jingwei = { remove_trait = { trait = CHI_exiled_chairman ideology = radical_socialist_subtype } }
			set_capital = { state = 1046 }
			LEP_add_collapse_dm = yes

			activate_mission = CHI_mission_get_access_sea
			activate_mission = CHI_mission_secure_fujian
			activate_mission = CHI_mission_secure_gannan
			if = {
				limit = { has_country_flag = CHI_prepare_a_mobile_reserve_flag }
				add_equipment_to_stockpile = { type = infantry_equipment amount = 500 }
				add_command_power = 50
				clr_country_flag = CHI_prepare_a_mobile_reserve_flag
			}
			if = {
				limit = { has_country_flag = CHI_rally_more_divisions_flag }
				clr_country_flag = CHI_rally_more_divisions_flag
				1046 = {
					create_unit = {
						division = "name = \"Di san shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #3rd Division of the 1st Army
						prioritize_location = 12084
						owner = CHI
					}
				}
			}
			if = {
				limit = { has_country_flag = CHI_armed_xiamen_flag }
				clr_country_flag = CHI_armed_xiamen_flag
				595 = {
					create_unit = {
						division = "name = \"Xinbian di sanshiliu shi\" division_template = \"Qibing Shi\" start_experience_factor = 0.1" #New 36th Division, historical NRA cavalry division
						prioritize_location = 12057 #Fujian
						owner = CHI
					}
				}
			}
		}
		600 = { #Ganzhou
			create_unit = {
				division = "name = \"Di er shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #Second Division of the 1st Army
				prioritize_location = 10112
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di ershi shi \" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #Twentieth Division of the 1st Army
				prioritize_location = 4081
				owner = CHI
			}
			create_unit = {
				division = "name = \"Di shijiu shi\" division_template = \"Géming Minbing Lü\" start_experience_factor = 0.1" #19th Division of the 3rd Army Corps
				prioritize_location = 12030
				owner = CHI
			}
			if = {
				limit = { CHI = { has_country_flag = CHI_armed_jiangxi_flag } } #From CHI.introgame.005
				create_unit = {
					division = "name = \"Xinbian di sanshiliu shi\" division_template = \"Qibing Shi\" start_experience_factor = 0.1" #New 36th Division, historical NRA cavalry division
					prioritize_location = 12030 #Jiangxi
					owner = CHI
				}
				CHI = { clr_country_flag = CHI_armed_jiangxi_flag }
			}
		}
		set_province_controller = 4070
		set_province_controller = 4113
		set_province_controller = 10012
		set_province_controller = 10042

		QIE = {
			country_event = { id = qing_foreign_policy_events.103 hours = 1 }
		}
	}
}
CHI_protracted_war_effect = {
	613 = {
		if = {
			limit = { NOT = { is_controlled_by = ROOT } }
			damage_building = {
				type = infrastructure
				damage = 0.15
			}
		}
	}
	1044 = {
		if = {
			limit = { NOT = { is_controlled_by = ROOT } }
			damage_building = {
				type = infrastructure
				damage = 0.15
			}
		}
	}
	596 = {
		if = {
			limit = { NOT = { is_controlled_by = ROOT } }
			damage_building = {
				type = infrastructure
				damage = 0.15
			}
		}
	}
	606 = {
		if = {
			limit = { NOT = { is_controlled_by = ROOT } }
			damage_building = {
				type = infrastructure
				damage = 0.15
			}
		}
	}
	1050 = {
		if = {
			limit = { NOT = { is_controlled_by = ROOT } }
			damage_building = {
				type = infrastructure
				damage = 0.15
			}
		}
	}
}
CHI_send_advisors_and_guns_effect = {
	army_experience = 20
	add_offsite_building = {
		type = arms_factory
		level = 1
	}
	subtract_from_variable = {
		var = CHI_foreign_offmap_mils_var
		value = 1
	}
	CHI_LCS_medium_effect = yes
}

CHI_send_advisors_only_effect = {
	army_experience = 20
	CHI_LCS_small_effect = yes
}

CHI_insurgent_army_transition_effect = {
	if = {
		limit = { has_idea = CHI_insurgent_army_idea_1 }
		swap_ideas = {
			remove_idea = 	CHI_insurgent_army_idea_1
			add_idea = CHI_nra_idea
		}
	}
	if = {
		limit = { has_idea = CHI_insurgent_army_idea_2 }
		swap_ideas = {
			remove_idea = CHI_insurgent_army_idea_2
			add_idea = CHI_nra_idea
		}
	}
}

########################################
#####- Section 2: Power Struggle - #####
########################################

#Radicalism Base Effect
CHI_clamp_rad_effect = {
	clamp_variable = {
		var = CHI.CHI_radicalism_var
		min = 0
		max = 1
	}
}
CHI_RAD_warning_event_effect = {
	if = {
		limit = { has_any_power_balance = yes }
		if = {
			limit = {
				check_variable = { CHI.CHI_radicalism_var > 0.25 }
				NOT = { has_country_flag = CHI_RAD_warning_one_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.021 days = 3 } } #Out of the Shadows
		}
		else_if = {
			limit = {
				check_variable = { CHI.CHI_radicalism_var > 0.50 }
				NOT = { has_country_flag = CHI_RAD_warning_two_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.022 days = 3 } } #The Polarisation of the NRA
		}
		else_if = {
			limit = {
				check_variable = { CHI.CHI_radicalism_var > 0.75 }
				NOT = { has_country_flag = CHI_RAD_warning_three_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.023 days = 3 } } #A Brazen Attempt!
		}
		else_if = {
			limit = {
				check_variable = { CHI.CHI_radicalism_var > 0.95 }
				NOT = { has_country_flag = CHI_RAD_warning_four_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.025 days = 3 } } #Shadow over the Countryside
		}
	}
}
CHI_add_rad_small_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = 0.01
		tooltip = CHI_add_rad_small_tt
	}
	CHI_clamp_rad_effect = yes
	CHI_RAD_warning_event_effect = yes
}
CHI_add_rad_medium_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = 0.03
		tooltip = CHI_add_rad_medium_tt
	}
	CHI_clamp_rad_effect = yes
	CHI_RAD_warning_event_effect = yes
}
CHI_add_rad_large_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = 0.05
		tooltip = CHI_add_rad_large_tt
	}
	CHI_clamp_rad_effect = yes
	CHI_RAD_warning_event_effect = yes
}
CHI_add_rad_mega_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = 0.10
		tooltip = CHI_add_rad_mega_tt
	}
	CHI_clamp_rad_effect = yes
	CHI_RAD_warning_event_effect = yes
}
CHI_add_rad_giga_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = 0.25
		tooltip = CHI_add_rad_giga_tt
	}
	CHI_clamp_rad_effect = yes
	CHI_RAD_warning_event_effect = yes
}
CHI_sub_rad_small_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = -0.01
		tooltip = CHI_sub_rad_small_tt
	}
	CHI_clamp_rad_effect = yes
}
CHI_sub_rad_medium_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = -0.03
		tooltip = CHI_sub_rad_medium_tt
	}
	CHI_clamp_rad_effect = yes
}
CHI_sub_rad_large_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = -0.05
		tooltip = CHI_sub_rad_large_tt
	}
	CHI_clamp_rad_effect = yes
}
CHI_sub_rad_mega_effect = {
	add_to_variable = {
		var = CHI.CHI_radicalism_var
		value = -0.10
		tooltip = CHI_sub_rad_mega_tt
	}
	CHI_clamp_rad_effect = yes
}
#CHI_sub_rad_giga_effect = {
#	add_to_variable = {
#		var = CHI.CHI_radicalism_var
#		value = -0.25
#		tooltip = CHI_sub_rad_giga_tt
#	}
#	CHI_clamp_rad_effect = yes
#}

#Strengthening RCA
CHI_add_RCA_effect = {
	add_popularity = {
		ideology = radical_socialist
		popularity = var:CHI_size_var
	}
}
CHI_RCA_small_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_small_var }
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = 0.02
			tooltip_side = CHI_RCA_winning_side
		}
	}
	CHI_add_RCA_effect = yes
}
CHI_RCA_medium_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_medium_var }
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = 0.06
			tooltip_side = CHI_RCA_winning_side
		}
	}
	CHI_add_RCA_effect = yes
}
CHI_RCA_large_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_large_var }
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = 0.10
			tooltip_side = CHI_RCA_winning_side
		}
	}
	CHI_add_RCA_effect = yes
}
CHI_RCA_mega_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_mega_var }
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = 0.20
			tooltip_side = CHI_RCA_winning_side
		}
	}
	CHI_add_RCA_effect = yes
}
#CHI_RCA_giga_effect = {
#	set_temp_variable = { CHI_size_var = CHI_size_giga_var }
#	if = {
#		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
#		add_power_balance_value = {
#			id = CHI_power_balance
#			value = 0.50
#			tooltip_side = CHI_RCA_winning_side
#		}
#	}
#	CHI_add_RCA_effect = yes
#}
#Strengthening PAC
CHI_add_PAC_effect = {
	if = {
		limit = { CHI_Song_victory_trigger = no }
		add_popularity = {
			ideology = social_democrat
			popularity = var:CHI_size_var
		}
	}
	else = {
		add_popularity = {
			ideology = radical_socialist
			popularity = var:CHI_size_var
		}
	}
}
CHI_PAC_small_effect = {
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = -0.02
			tooltip_side = CHI_PAC_winning_side
		}
	}
	set_temp_variable = { CHI_size_var = CHI_size_small_var }
	CHI_add_PAC_effect = yes
}
CHI_PAC_medium_effect = {
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = -0.06
			tooltip_side = CHI_PAC_winning_side
		}
	}
	set_temp_variable = { CHI_size_var = CHI_size_medium_var }
	CHI_add_PAC_effect = yes
}
CHI_PAC_large_effect = {
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = -0.10
			tooltip_side = CHI_PAC_winning_side
		}
	}
	set_temp_variable = { CHI_size_var = CHI_size_large_var }
	CHI_add_PAC_effect = yes
}
CHI_PAC_mega_effect = {
	if = {
		limit = { has_any_power_balance = yes }
		#Sucks but atm add power balance doesn't accept variables
		add_power_balance_value = {
			id = CHI_power_balance
			value = -0.20
			tooltip_side = CHI_PAC_winning_side
		}
	}
	set_temp_variable = { CHI_size_var = CHI_size_mega_var }
	CHI_add_PAC_effect = yes
}
#CHI_PAC_giga_effect = {
#	if = {
#		limit = { has_any_power_balance = yes }
#		#Sucks but atm add power balance doesn't accept variables
#		add_power_balance_value = {
#			id = CHI_power_balance
#			value = -0.50
#			tooltip_side = CHI_PAC_winning_side
#		}
#	}
#	set_temp_variable = { CHI_size_var = CHI_size_giga_var }
#	CHI_add_PAC_effect = yes
#}
#Strengthening CRS
CHI_add_CRS_effect = {
	add_popularity = {
		ideology = totalist
		popularity = var:CHI_size_var
	}
}
CHI_CRS_small_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_small_var }
	CHI_add_CRS_effect = yes
	CHI_add_rad_small_effect = yes
}
CHI_CRS_medium_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_medium_var }
	CHI_add_CRS_effect = yes
	CHI_add_rad_medium_effect = yes
}
CHI_CRS_large_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_large_var }
	CHI_add_CRS_effect = yes
	CHI_add_rad_large_effect = yes
}
CHI_CRS_mega_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_mega_var }
	CHI_add_CRS_effect = yes
	CHI_add_rad_mega_effect = yes
}
#CHI_CRS_giga_effect = {
#	set_temp_variable = { CHI_size_var = CHI_size_giga_var }
#	CHI_add_CRS_effect = yes
#	CHI_add_rad_giga_effect = yes
#}

#Strengthening RCF
CHI_add_RCF_effect = {
	add_popularity = {
		ideology = social_liberal
		popularity = var:CHI_size_var
	}
}
CHI_RCF_mechanic_event_warning_effect = {
	if = {
		limit = { NOT = { has_country_flag = CHI_RCF_warning_one_flag } }
		hidden_effect = { #Fire a warning event for the player that they are letting Soc Lib popularity get too high
			country_event = { id = CHI.midgame.029 days = 3 } #A Hawaiian Fifth Column?
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = CHI_RCF_warning_two_flag }
			CHI_RCF_level_four_trigger = no
			CHI_RCF_level_five_trigger = no
		}
		hidden_effect = { #Fire a second warning event for the player that they are letting Soc Lib popularity get too high
			country_event = { id = CHI.midgame.030 days = 3 } #An Indian Clique Conspiracy
		}
	}
}
CHI_RCF_mechanic_effect = {
	if = {
		limit = { has_any_power_balance = yes }
		if = {
			limit = { CHI_RCF_level_one_trigger = yes }
			CHI_sub_rad_medium_effect = yes
		}
		else_if = {
			limit = { CHI_RCF_level_two_trigger = yes }
			CHI_sub_rad_small_effect = yes
		}
		else_if = {
			limit = { CHI_RCF_level_four_trigger = yes }
			CHI_add_rad_small_effect = yes
			CHI_RCF_mechanic_event_warning_effect = yes
		}
		else_if = {
			limit = { CHI_RCF_level_five_trigger = yes }
			CHI_add_rad_medium_effect = yes
			CHI_RCF_mechanic_event_warning_effect = yes
		}
		else_if = {
			limit = { CHI_RCF_level_six_trigger = yes }
			CHI_add_rad_large_effect = yes
			CHI_RCF_mechanic_event_warning_effect = yes
		}
		else_if = {
			limit = { CHI_RCF_level_seven_trigger = yes }
			CHI_add_rad_mega_effect = yes
			CHI_RCF_mechanic_event_warning_effect = yes
		}
		# Note from Pelmen - you don't use else, so just comment this
		# else_if = {
		# 	limit = { CHI_RCF_level_three_trigger = yes }
		# 	#Deliberately blank
		# }
	}
}
CHI_RCF_small_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_small_var }
	#Effect tooltip used because it looks ugly to have the tooltip above the add soc lib popularity effect.
	#Also keep the actual add soc lib popularity effect below the mechanic effect because otherwise the tooltip lies.
	effect_tooltip = { CHI_add_RCF_effect = yes }
	CHI_RCF_mechanic_effect = yes
	hidden_effect = { CHI_add_RCF_effect = yes }
}
CHI_RCF_medium_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_medium_var }
	effect_tooltip = { CHI_add_RCF_effect = yes }
	CHI_RCF_mechanic_effect = yes
	hidden_effect = { CHI_add_RCF_effect = yes }
}
CHI_RCF_large_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_large_var }
	effect_tooltip = { CHI_add_RCF_effect = yes }
	CHI_RCF_mechanic_effect = yes
	hidden_effect = { CHI_add_RCF_effect = yes }
}
CHI_RCF_mega_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_mega_var }
	effect_tooltip = { CHI_add_RCF_effect = yes }
	CHI_RCF_mechanic_effect = yes
	hidden_effect = { CHI_add_RCF_effect = yes }
}
#CHI_RCF_giga_effect = {
#	set_temp_variable = { CHI_size_var = CHI_size_giga_var }
#	CHI_add_RCF_effect = yes
#	CHI_RCF_mechanic_effect = yes
#}
#Strengthening LCS
CHI_LCS_mechanic_event_warning_effect = {
	if = {
		limit = {
			NOT = { has_country_flag = CHI_LCS_warning_one_flag }
			syndicalist > 0.15
		}
		hidden_effect = { #Fire a warning event for the player that they are letting Syndicalist popularity get too high
			country_event = { id = CHI.midgame.039 days = 3 } #A House Divided
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = CHI_LCS_warning_two_flag }
			syndicalist > 0.25
		}
		hidden_effect = { #Fire a second warning event for the player that they are letting Syndicalist popularity get too high
			country_event = { id = CHI.midgame.040 days = 3 } #The Younger Sister Grows Up!
		}
	}
}
CHI_add_LCS_effect = {
	add_popularity = {
		ideology = syndicalist
		popularity = var:CHI_size_var
	}
	if = {
		limit = { has_any_power_balance = yes }
		CHI_LCS_mechanic_event_warning_effect = yes
	}
}
CHI_LCS_small_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_small_var }
	CHI_add_LCS_effect = yes
}
CHI_LCS_medium_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_medium_var }
	CHI_add_LCS_effect = yes
}
CHI_LCS_large_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_large_var }
	CHI_add_LCS_effect = yes
}
CHI_LCS_mega_effect = {
	set_temp_variable = { CHI_size_var = CHI_size_mega_var }
	CHI_add_LCS_effect = yes
}
#CHI_LCS_giga_effect = {
#	set_temp_variable = { CHI_size_var = CHI_size_giga_var }
#	CHI_add_LCS_effect = yes
#}
CHI_LCS_clear_flags_effect = {
	if = {
		limit = { has_country_flag = CHI_LCS_ORT_dom_flag }
		clr_country_flag = CHI_LCS_ORT_dom_flag
	}
	if = {
		limit = { has_country_flag = CHI_LCS_RAD_dom_flag }
		clr_country_flag = CHI_LCS_RAD_dom_flag
	}
	if = {
		limit = { has_country_flag = CHI_LCS_WRD_dom_flag }
		clr_country_flag = CHI_LCS_WRD_dom_flag
	}
}
CHI_LCS_shatter_flag_effect = {
	if = {
		limit = { NOT = { has_country_flag = LCS_shattered_flag } }
		set_country_flag = LCS_shattered_flag
	}
}
CHI_LCS_update_percentage_effect = {
	#Get the Total Strength Points of LCS Mechanic
	set_temp_variable = { CHI_LCS_total_strength_temp_var = CHI_CSP_ORT_strength_var }
	add_to_temp_variable = { CHI_LCS_total_strength_temp_var = CHI_CSP_RAD_strength_var }
	add_to_temp_variable = { CHI_LCS_total_strength_temp_var = CHI_WRD_SOC_strength_var }
	#Get the % CSP ORT Dominance
	set_variable = { CHI_CSP_ORT_percentage_var = CHI_CSP_ORT_strength_var }
	divide_variable = { CHI_CSP_ORT_percentage_var = CHI_LCS_total_strength_temp_var }
	#Get the % CSP RAD Dominance
	set_variable = { CHI_CSP_RAD_percentage_var = CHI_CSP_RAD_strength_var }
	divide_variable = { CHI_CSP_RAD_percentage_var = CHI_LCS_total_strength_temp_var }
	#Get the % WRD SOC Dominance
	set_variable = { CHI_WRD_SOC_percentage_var = CHI_WRD_SOC_strength_var }
	divide_variable = { CHI_WRD_SOC_percentage_var = CHI_LCS_total_strength_temp_var }
}
CHI_LCS_mechanic_effect = {
	CHI_LCS_update_percentage_effect = yes
	if = {
		limit = { has_any_power_balance = yes }
		if = {
			limit = {
				check_variable = { CHI_WRD_SOC_strength_var > CHI_CSP_RAD_strength_var }
				check_variable = { CHI_WRD_SOC_strength_var > CHI_CSP_ORT_strength_var }
				NOT = { has_country_flag = CHI_LCS_WRD_dom_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.026 days = 3 } } #The World Society Triumphant
		}
		else_if = {
			limit = {
				check_variable = { CHI_CSP_RAD_strength_var > CHI_WRD_SOC_strength_var }
				check_variable = { CHI_CSP_RAD_strength_var > CHI_CSP_ORT_strength_var }
				NOT = { has_country_flag = CHI_LCS_RAD_dom_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.027 days = 3 } } #The CSP-Radicals Ascendant
		}
		else_if = {
			limit = {
				check_variable = { CHI_CSP_ORT_strength_var > CHI_CSP_RAD_strength_var }
				check_variable = { CHI_CSP_ORT_strength_var > CHI_WRD_SOC_strength_var }
				NOT = { has_country_flag = CHI_LCS_ORT_dom_flag }
			}
			hidden_effect = { country_event = { id = CHI.midgame.028 days = 3 } } #The CSP-Orthodox Reassert Dominance
		}
	}
}
CHI_CSP_ORT_effect = {
	add_to_variable = {
		var = CHI_CSP_ORT_strength_var
		value = 1
		tooltip = CHI_CSP_ORT_tt
	}
	CHI_LCS_mechanic_effect = yes
}
CHI_CSP_RAD_effect = {
	add_to_variable = {
		var = CHI_CSP_RAD_strength_var
		value = 1
		tooltip = CHI_CSP_RAD_tt
	}
	CHI_LCS_mechanic_effect = yes
}
CHI_WRD_SOC_effect = {
	add_to_variable = {
		var = CHI_WRD_SOC_strength_var
		value = 1
		tooltip = CHI_WRD_SOC_tt
	}
	CHI_LCS_mechanic_effect = yes
}

CHI_subject_accceptance_influence_effect = {
	hidden_effect = { country_event = { id = CHI.midgame.851 days = 3 } } #Should be all-encompassing now
}

CHI_subject_rejection_influence_effect = {
	hidden_effect = { country_event = { id = CHI.midgame.852 days = 3 } } #Should be all-encompassing now
}

CHI_warn_of_rkmt_government_effect = {
	if = {
		limit = { china_alignment_right_kuomintang = yes }
		hidden_effect = { CHI = { country_event = { id = CHI.midgame.853 days = 3 } } } #A Rivalry Rekindled
	}
}

########################################
#####- Section 3: Mid Game - ###########
########################################

CHI_improve_legitimacy_effect = {
	if = {
		limit = { has_idea = KR_CHI_popular_support_1 }
		swap_ideas = {
			remove_idea = KR_CHI_popular_support_1
			add_idea = KR_CHI_popular_support_2
		}
	}
	else_if = {
		limit = { has_idea = KR_CHI_popular_support_2 }
		swap_ideas = {
			remove_idea = KR_CHI_popular_support_2
			add_idea = KR_CHI_popular_support_3
		}
	}
	else_if = {
		limit = { has_idea = KR_CHI_popular_support_3 }
		swap_ideas = {
			remove_idea = KR_CHI_popular_support_3
			add_idea = KR_CHI_popular_support_4
		}
	}
	else_if = {
		limit = { has_idea = KR_CHI_popular_support_4 }
		swap_ideas = {
			remove_idea = KR_CHI_popular_support_4
			add_idea = KR_CHI_popular_support_5
		}
	}
	else = {
		set_temp_variable = { ideology_change_var = 0.05 }
		change_ruling_party_popularity = yes
	}
}
CHI_league_war_reconstruction_effect = {
	if = {
		limit = { has_idea = CHI_league_reconstruction_idea1 }
		swap_ideas = {
			remove_idea = CHI_league_reconstruction_idea1
			add_idea = CHI_league_reconstruction_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHI_league_reconstruction_idea2 }
		swap_ideas = {
			remove_idea = CHI_league_reconstruction_idea2
			add_idea = CHI_league_reconstruction_idea3
		}
	}
	else_if = {
		limit = { has_idea = CHI_league_reconstruction_idea3 }
		swap_ideas = {
			remove_idea = CHI_league_reconstruction_idea3
			add_idea = CHI_league_reconstruction_idea4
		}
	}
	else_if = {
		limit = { has_idea = CHI_league_reconstruction_idea4 }
		swap_ideas = {
			remove_idea = CHI_league_reconstruction_idea4
			add_idea = CHI_league_reconstruction_idea5
		}
	}
}

CHI_improve_jiangfu_NRA_effect = {
	if = {
		limit = { has_idea = CHI_nra_idea } #Fallback in case somehow the player made it to phase 4 without taking army tree
		swap_ideas = {
			remove_idea = CHI_nra_idea
			add_idea = CHI_nra_jiangfu_idea1
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_idea2 }
		swap_ideas = {
			remove_idea = CHI_nra_idea2
			add_idea = CHI_nra_jiangfu_idea1
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_jiangfu_idea1 }
		swap_ideas = {
			remove_idea = CHI_nra_jiangfu_idea1
			add_idea = 	CHI_nra_jiangfu_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_jiangfu_idea2 }
		swap_ideas = {
			remove_idea = CHI_nra_jiangfu_idea2
			add_idea = 	CHI_nra_jiangfu_idea3
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_jiangfu_idea3 }
		swap_ideas = {
			remove_idea = CHI_nra_jiangfu_idea3
			add_idea = 	CHI_nra_jiangfu_idea4
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_jiangfu_idea4 }
		swap_ideas = {
			remove_idea = CHI_nra_jiangfu_idea4
			add_idea = 	CHI_nra_jiangfu_idea5
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_jiangfu_idea5 } #Fallback
		every_unit_leader = {
			gain_xp = 200
		}
	}
	else = {
		custom_effect_tooltip = CHI_improve_jiangfu_NRA_tt
	}
	CHI_PAC_large_effect = yes
}

CHI_improve_modern_NRA_effect = {
	if = {
		limit = { has_idea = CHI_nra_idea } #Fallback in case somehow the player made it to phase 4 without taking army tree
		swap_ideas = {
			remove_idea = CHI_nra_idea
			add_idea = CHI_nra_modern_idea1
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_idea2 }
		swap_ideas = {
			remove_idea = CHI_nra_idea2
			add_idea = CHI_nra_modern_idea1
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_modern_idea1 }
		swap_ideas = {
			remove_idea = 	CHI_nra_modern_idea1
			add_idea = 	CHI_nra_modern_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_modern_idea2 }
		swap_ideas = {
			remove_idea = CHI_nra_modern_idea2
			add_idea = 	CHI_nra_modern_idea3
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_modern_idea3 }
		swap_ideas = {
			remove_idea = CHI_nra_modern_idea3
			add_idea = 	CHI_nra_modern_idea4
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_modern_idea4 }
		swap_ideas = {
			remove_idea = CHI_nra_modern_idea4
			add_idea = 	CHI_nra_modern_idea5
		}
	}
	else_if = {
		limit = { has_idea = CHI_nra_modern_idea5 } #Fallback
		every_unit_leader = {
			gain_xp = 200
		}
	}
	else = {
		custom_effect_tooltip = CHI_improve_modern_NRA_tt
	}
	CHI_RCA_large_effect = yes
}

CHI_improve_NRA_effect = {
	if = {
		limit = { has_idea = CHI_nra_idea }
		swap_ideas = {
			remove_idea = CHI_nra_idea
			add_idea = CHI_nra_idea2
		}
	}
	else_if = {
		limit = { has_completed_focus = CHI_legacy_of_jiangfu }
		CHI_improve_jiangfu_NRA_effect = yes
	}
	else_if = {
		limit = { has_completed_focus = CHI_look_to_the_west }
		CHI_improve_modern_NRA_effect = yes
	}
	else_if = {
		limit = { CHI_is_phase_four_trigger = yes } #If the player somehow avoided taking a side until after unification, defaults to mingan
		CHI_improve_jiangfu_NRA_effect = yes
	}
	else = {
		custom_effect_tooltip = CHI_improve_NRA_tt
	}
}
CHI_level_up_chen_gongbo_effect = {
	CHI_chen_gongbo = {
		if = {
			limit = { has_trait = KR_mouthpiece_of_rca_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_mouthpiece_of_rca_sic
			}
			set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_gain_tooltip }
			hidden_effect = {
				remove_trait = {
					character = CHI_chen_gongbo
					slot = second_in_command
					trait = KR_mouthpiece_of_rca_sic
				}
				add_trait = {
					character = CHI_chen_gongbo
					slot = second_in_command
					trait = KR_mouthpiece_of_rca_2_sic
				}
			}
		}
		else_if = {
			limit = { has_trait = KR_mouthpiece_of_rca_2_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_mouthpiece_of_rca_sic
			}
			set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_gain_tooltip }
			hidden_effect = {
				remove_trait = {
					character = CHI_chen_gongbo
					slot = second_in_command
					trait = KR_mouthpiece_of_rca_2_sic
				}
				add_trait = {
					character = CHI_chen_gongbo
					slot = second_in_command
					trait = KR_mouthpiece_of_rca_3_sic
				}
			}
		}
		else_if = {
			limit = { has_trait = KR_mouthpiece_of_rca_3_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_mouthpiece_of_rca_sic
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_gain_tooltip }
				set_temp_variable = { modifier_change_tt = 0.10 tooltip = production_speed_buildings_factor_tooltip }
			}
			hidden_effect = {
				remove_trait = {
					character = CHI_chen_gongbo
					slot = second_in_command
					trait = KR_mouthpiece_of_rca_3_sic
				}
				add_trait = {
					character = CHI_chen_gongbo
					slot = second_in_command
					trait = KR_mouthpiece_of_rca_4_sic
				}
			}
		}
	}
}
CHI_level_up_deng_yanda_effect = {
	CHI_deng_yanda = {
		if = {
			limit = { has_trait = KR_hero_of_the_chinese_revolution_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_hero_of_the_chinese_revolution_sic
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.025 tooltip = army_defence_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.025 tooltip = army_attack_factor_tooltip }
			}
			hidden_effect = {
				remove_trait = {
					character = CHI_deng_yanda
					slot = second_in_command
					trait = KR_hero_of_the_chinese_revolution_sic
				}
				add_trait = {
					character = CHI_deng_yanda
					slot = second_in_command
					trait = KR_hero_of_the_chinese_revolution_2_sic
				}
			}
		}
		else_if = {
			limit = { has_trait = KR_hero_of_the_chinese_revolution_2_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_hero_of_the_chinese_revolution_sic
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = experience_gain_army_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.025 tooltip = army_defence_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.025 tooltip = army_attack_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_gain_tooltip }
			}
			hidden_effect = {
				remove_trait = {
					character = CHI_deng_yanda
					slot = second_in_command
					trait = KR_hero_of_the_chinese_revolution_2_sic
				}
				add_trait = {
					character = CHI_deng_yanda
					slot = second_in_command
					trait = KR_hero_of_the_chinese_revolution_3_sic
				}
			}
		}
		else_if = {
			limit = { has_trait = KR_hero_of_the_chinese_revolution_3_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_hero_of_the_chinese_revolution_sic
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = army_defence_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = army_attack_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_gain_tooltip }
			}
			hidden_effect = {
				remove_trait = {
					character = CHI_deng_yanda
					slot = second_in_command
					trait = KR_hero_of_the_chinese_revolution_3_sic
				}
				add_trait = {
					character = CHI_deng_yanda
					slot = second_in_command
					trait = KR_hero_of_the_chinese_revolution_4_sic
				}
			}
		}
	}
}
CHI_level_up_four_elders_effect = {
	CHI_four_elders = {
		if = {
			limit = { is_second_in_command = yes }
			if = {
				limit = { has_trait = KR_the_pursuit_of_datong_sic }
				custom_effect_tooltip = {
					localization_key = tooltip_modify_character_trait
					ROLE = second_in_command TRAIT = KR_the_pursuit_of_datong_sic
				}
				effect_tooltip = {
					set_temp_variable = { modifier_change_tt = 0.05 tooltip = research_speed_factor_tooltip }
					set_temp_variable = { modifier_change_tt = 0.025 tooltip = industrial_capacity_factory_tooltip }
					set_temp_variable = { modifier_change_tt = 0.05 tooltip = stability_factor_tooltip }
				}
				hidden_effect = {
					remove_trait = {
						character = CHI_four_elders
						slot = second_in_command
						trait = KR_the_pursuit_of_datong_sic
					}
					add_trait = {
						character = CHI_four_elders
						slot = second_in_command
						trait = KR_the_pursuit_of_datong_2_sic
					}
				}
			}
			else_if = {
				limit = { has_trait = KR_the_pursuit_of_datong_2_sic }
				custom_effect_tooltip = {
					localization_key = tooltip_modify_character_trait
					ROLE = second_in_command TRAIT = KR_the_pursuit_of_datong_sic
				}
				effect_tooltip = {
					set_temp_variable = { modifier_change_tt = 0.05 tooltip = industrial_capacity_factory_tooltip }
					set_temp_variable = { modifier_change_tt = -0.05 tooltip = stability_factor_tooltip }
				}
				hidden_effect = {
					remove_trait = {
						character = CHI_four_elders
						slot = second_in_command
						trait = KR_the_pursuit_of_datong_2_sic
					}
					add_trait = {
						character = CHI_four_elders
						slot = second_in_command
						trait = KR_the_pursuit_of_datong_3_sic
					}
				}
			}
		}
	}
}
CHI_level_up_zeng_zhongming_effect = {
	CHI_zeng_zhongming = {
		if = {
			limit = { has_trait = KR_pen_of_the_chairman_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_pen_of_the_chairman_sic
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = stability_factor_tooltip }
			}
			hidden_effect = {
				remove_trait = {
					character = CHI_zeng_zhongming
					slot = second_in_command
					trait = KR_pen_of_the_chairman_sic
				}
				add_trait = {
					character = CHI_zeng_zhongming
					slot = second_in_command
					trait = KR_pen_of_the_chairman_2_sic
				}
			}
		}
		else_if = {
			limit = { has_trait = KR_pen_of_the_chairman_2_sic }
			custom_effect_tooltip = {
				localization_key = tooltip_modify_character_trait
				ROLE = second_in_command TRAIT = KR_pen_of_the_chairman_sic
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_factor_tooltip }
				set_temp_variable = { modifier_change_tt = 0.04 tooltip = compliance_gain_tooltip }
			}
			hidden_effect = {
				remove_trait = {
					character = CHI_zeng_zhongming
					slot = second_in_command
					trait = KR_pen_of_the_chairman_2_sic
				}
				add_trait = {
					character = CHI_zeng_zhongming
					slot = second_in_command
					trait = KR_pen_of_the_chairman_3_sic
				}
			}
		}
	}
}
CHI_level_up_gu_mengyu_effect = {
	CHI_gu_mengyu = {
		if = {
			limit = { has_trait = KR_moderate_reorganisation_sic }
			custom_override_tooltip = {
				tooltip = {
					localization_key = tooltip_modify_character_trait
					ROLE = second_in_command TRAIT = KR_moderate_reorganisation_sic
				}
				remove_trait = {
					character = CHI_gu_mengyu
					slot = second_in_command
					trait = KR_moderate_reorganisation_sic
				}
				add_trait = {
					character = CHI_gu_mengyu
					slot = second_in_command
					trait = KR_moderate_reorganisation_2_sic
				}
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_factor_tooltip }
				set_temp_variable = { modifier_change_tt = -0.05 tooltip = resistance_growth_tooltip }
				set_temp_variable = { modifier_change_tt = -0.05 tooltip = political_advisor_cost_factor_tooltip }
			}
		}
		else_if = {
			limit = { has_trait = KR_moderate_reorganisation_2_sic }
			custom_override_tooltip = {
				tooltip = {
					localization_key = tooltip_replace_character_trait
					ROLE = second_in_command
					OLD_TRAIT = KR_moderate_reorganisation_2_sic
					NEW_TRAIT = KR_democracy_with_chinese_characterstics_sic
				}
				remove_trait = {
					character = CHI_gu_mengyu
					slot = second_in_command
					trait = KR_moderate_reorganisation_2_sic
				}
				add_trait = {
					character = CHI_gu_mengyu
					slot = second_in_command
					trait = KR_democracy_with_chinese_characterstics_sic
				}
			}
			effect_tooltip = {
				set_temp_variable = { modifier_change_tt = 0.05 tooltip = political_power_factor_tooltip }
				set_temp_variable = { modifier_change_tt = -0.05 tooltip = resistance_growth_tooltip }
				set_temp_variable = { modifier_change_tt = -0.05 tooltip = political_advisor_cost_factor_tooltip }
				set_temp_variable = { modifier_change_tt = -0.50 tooltip = trade_laws_cost_factor_tooltip }
			}
		}
	}
}

CHI_mac_effect = {
	if = {
		limit = { has_idea = CHI_mac_idea }
		swap_ideas = {
			remove_idea = CHI_mac_idea
			add_idea = CHI_mac_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHI_mac_idea2 }
		swap_ideas = {
			remove_idea = CHI_mac_idea2
			add_idea = CHI_mac_idea3
		}
	}
	else_if = {
		limit = { has_idea = CHI_mac_idea3 } #Fallback
		army_experience = 50
	}
	else = { custom_effect_tooltip = CHI_mac_effect_tt }
}

CHI_activate_peoples_war_effect = {
	controller = {
		if = {
			limit = {
				NOT = { has_template = "Géming Minbing Lü" }
			}
			division_template = {
				name = "Géming Minbing Lü"    # Represents: local militias for early 2nd NRA
				division_names_group = CHI_MIL_01
				regiments = {
					irregular_infantry = { x = 0 y = 0 }
					irregular_infantry = { x = 0 y = 1 }
					irregular_infantry = { x = 1 y = 0 }
					irregular_infantry = { x = 1 y = 1 }
				}
			}
		}
	}
	create_unit = {
		division = "division_template = \"Géming Minbing Lü\" start_experience_factor = 1.0 start_equipment_factor = 0.9"
		owner = controller
		allow_spawning_on_enemy_provs = yes
	}
	clr_state_flag = CHI_peoples_war_flag
}

########################################
#####- Section 4: Late Game - ##########
########################################
CHI_remove_league_reconstruction_effect = {
	if = {
		limit = {
			OR = {
				has_idea = CHI_league_reconstruction_idea1
				has_idea = CHI_league_reconstruction_idea2
				has_idea = CHI_league_reconstruction_idea3
				has_idea = CHI_league_reconstruction_idea4
				has_idea = CHI_league_reconstruction_idea5
				has_idea = CHI_improvised_rifle_idea #Idea from CHI_revolutionary_arms
			}
		}
		remove_ideas = {
			CHI_league_reconstruction_idea1
			CHI_league_reconstruction_idea2
			CHI_league_reconstruction_idea3
			CHI_league_reconstruction_idea4
			CHI_league_reconstruction_idea5
			CHI_improvised_rifle_idea
		}
	}
}
CHI_demobilised_NRA_idea_effect = {
	if = {
		limit = { has_idea = CHI_demobilised_NRA_idea }
		swap_ideas = {
			remove_idea = CHI_demobilised_NRA_idea
			add_idea = CHI_demobilised_NRA_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHI_demobilised_NRA_idea2 }
		swap_ideas = {
			remove_idea = CHI_demobilised_NRA_idea2
			add_idea = CHI_demobilised_NRA_idea3
		}
	}
	else_if = {
		limit = { has_idea = CHI_demobilised_NRA_idea3 }
		remove_ideas = CHI_demobilised_NRA_idea3
	}
}
CHI_national_economic_recovery_effect = {
	if = {
		limit = { has_idea = CHI_devastated_national_econ_idea }
		swap_ideas = {
			remove_idea = CHI_devastated_national_econ_idea
			add_idea = CHI_devastated_national_econ2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_devastated_national_econ2_idea }
		swap_ideas = {
			remove_idea = CHI_devastated_national_econ2_idea
			add_idea = CHI_devastated_national_econ3_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_devastated_national_econ3_idea }
		swap_ideas = {
			remove_idea = CHI_devastated_national_econ3_idea
			add_idea = CHI_devastated_national_econ4_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_devastated_national_econ4_idea }
		swap_ideas = {
			remove_idea = CHI_devastated_national_econ4_idea
			add_idea = CHI_devastated_national_econ5_idea
		}
	}
}

CHI_liberation_army_template_setup_effect = {
	if = {
		limit = { NOT = { has_template = "Liberation Army Division" } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_create_division_template
				NAME = "Liberation Army Division"
				LINE_1 = { localization_key = line_battalion_tt NAME = infantry ICON = GFX_unit_infantry_icon_small COUNT = 9 }
				SUPPORT_1 = { localization_key = support_battalion_tt NAME = artillery ICON = GFX_unit_artillery_icon_small }
				SUPPORT_2 = { localization_key = support_battalion_tt NAME = assault_battalion ICON = GFX_unit_assault_battalion_icon_small }
				SUPPORT_3 = { localization_key = support_battalion_tt NAME = recon ICON = GFX_unit_recon_icon_small }
			}
			division_template = {
				name = "Liberation Army Division"
				division_names_group = CHI_MIL_01
				is_locked = yes
				force_allow_recruiting = yes
				template_counter = 58
				division_cap = 3
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 1 y = 2 }
					infantry = { x = 2 y = 0 }
					infantry = { x = 2 y = 1 }
					infantry = { x = 2 y = 2 }
				}
				support = {
					artillery = { x = 0 y = 0 }
					assault_battalion = { x = 0 y = 1 }
					recon = { x = 0 y = 2 }
				}
			}
		}
	}
	else = {
		set_division_template_cap = {
			division_template = "Liberation Army Division"
			division_cap = 5
		}
	}
}
CHI_air_reform_effect = {
	if = {
		limit = { has_idea = CHI_republic_of_china_air_force_idea }
		swap_ideas = {
			remove_idea = 	CHI_republic_of_china_air_force_idea
			add_idea = 	CHI_republic_of_china_air_force_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHI_republic_of_china_air_force_idea2 }
		swap_ideas = {
			remove_idea = 	CHI_republic_of_china_air_force_idea2
			add_idea = CHI_republic_of_china_air_force_idea3
		}
	}
}

CHI_betrayal_uprising_effect = {
	china_break_puppet_effect = yes
	set_potential_national_government = yes
	china_enable_alliances_decisions = yes
	china_enable_all_demand_submission_decisions = yes
	if = {
		limit = { can_declare_war_on = CHI }
		create_wargoal = {
			target = CHI
			type = topple_government
		}
	}
	hidden_effect = {
		china_set_government_tag_specific_scripted_effect = yes
		CHI = {
			country_event = CHI.lategame.910 #[FROM.GetAdjectiveCap] Betrayal!
			every_subject_country = {
				limit = {
					OR = {
						has_autonomy_state = associated_governorate
						has_autonomy_state = autonomous_governorate
						has_autonomy_state = governorate
						has_autonomy_state = integrated_governorate
					}
				}
				country_event = { id = CHI.lategame.911 days = 3 random_days = 4 } #[FROM.GetAdjectiveCap] Uprising!
			}
		}
	}
}

CHI_set_up_civil_war_effect = {
	set_politics = {
		ruling_party = social_liberal
		elections_allowed = no
	}
	CHI_purge_RCA_advisors_effect = yes
	CHI_purge_RCA_generals_effect = yes
	CHI_purge_LCS_generals_effect = yes

	#Set Up Initial Strength Values
	set_variable = { CHI_crs_civ_war_var = party_popularity@totalist }
	set_variable = { CHI_lcs_civ_war_var = party_popularity@syndicalist }
	set_variable = { CHI_rca_civ_war_var = party_popularity@radical_socialist }
	set_variable = { CHI_pac_civ_war_var = party_popularity@social_democrat }
	#Gov Value will be set later

	#Multiply by 10 (So they should be a value between 0-10)
	multiply_variable = { CHI_crs_civ_war_var = 10 }
	multiply_variable = { CHI_lcs_civ_war_var = 10 }
	multiply_variable = { CHI_rca_civ_war_var = 10 }
	multiply_variable = { CHI_pac_civ_war_var = 10 }

	#Round All By 10
	round_variable = CHI_crs_civ_war_var
	round_variable = CHI_lcs_civ_war_var
	round_variable = CHI_rca_civ_war_var
	round_variable = CHI_pac_civ_war_var

	#Get the Gov Strength Variable (In theory, all should add up to 10)
	set_variable = { CHI_gov_civ_war_var = 10 }
	subtract_from_variable = { CHI_gov_civ_war_var = CHI_crs_civ_war_var }
	subtract_from_variable = { CHI_gov_civ_war_var = CHI_lcs_civ_war_var }
	subtract_from_variable = { CHI_gov_civ_war_var = CHI_rca_civ_war_var }
	subtract_from_variable = { CHI_gov_civ_war_var = CHI_pac_civ_war_var }

	#Distribute LCS Popularity
	if = {
		limit = {
			OR = {
				has_country_flag = CHI_LCS_RAD_dom_flag
				AND = {
					has_country_flag = CHI_LCS_ORT_dom_flag
					has_country_flag = CHI_rca_lcs_alignment_flag
				}
			}
		}
		add_to_variable = { CHI_rca_civ_war_var = CHI_lcs_civ_war_var }
	}
	else_if = {
		limit = {
			OR = {
				has_country_flag = CHI_LCS_WRD_dom_flag
				AND = {
					has_country_flag = CHI_LCS_ORT_dom_flag
					has_country_flag = CHI_pac_lcs_alignment_flag
				}
			}
		}
		add_to_variable = { CHI_pac_civ_war_var = CHI_lcs_civ_war_var }
	}
}

CHI_rca_civ_war_add_1_effect = {
	add_to_variable = { CHI_rca_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_rca_civ_war_add_tt
	}
}
CHI_rca_civ_war_add_2_effect = {
	add_to_variable = { CHI_rca_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_rca_civ_war_add_tt
	}
}
CHI_rca_civ_war_add_3_effect = {
	add_to_variable = { CHI_rca_civ_war_var = 3 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_rca_civ_war_add_tt
	}
}
CHI_pac_civ_war_add_1_effect = {
	add_to_variable = { CHI_pac_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_pac_civ_war_add_tt
	}
}
CHI_pac_civ_war_add_2_effect = {
	add_to_variable = { CHI_pac_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_pac_civ_war_add_tt
	}
}
CHI_pac_civ_war_add_3_effect = {
	add_to_variable = { CHI_pac_civ_war_var = 3 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_pac_civ_war_add_tt
	}
}
CHI_gov_civ_war_add_1_effect = {
	add_to_variable = { CHI_gov_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_gov_civ_war_add_tt
	}
}
CHI_gov_civ_war_add_2_effect = {
	add_to_variable = { CHI_gov_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_gov_civ_war_add_tt
	}
}
CHI_gov_civ_war_add_3_effect = {
	add_to_variable = { CHI_gov_civ_war_var = 3 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_gov_civ_war_add_tt
	}
}
CHI_crs_civ_war_add_1_effect = {
	add_to_variable = { CHI_crs_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_crs_civ_war_add_tt
	}
}
CHI_crs_civ_war_add_2_effect = {
	add_to_variable = { CHI_crs_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_crs_civ_war_add_tt
	}
}
CHI_crs_civ_war_add_3_effect = {
	add_to_variable = { CHI_crs_civ_war_var = 3 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_crs_civ_war_add_tt
	}
}
CHI_rca_civ_war_subtract_1_effect = {
	subtract_from_variable = { CHI_rca_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_rca_civ_war_subtract_tt
	}
}
CHI_rca_civ_war_subtract_2_effect = {
	subtract_from_variable = { CHI_rca_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_rca_civ_war_subtract_tt
	}
}
CHI_pac_civ_war_subtract_1_effect = {
	subtract_from_variable = { CHI_pac_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_pac_civ_war_subtract_tt
	}
}
CHI_pac_civ_war_subtract_2_effect = {
	subtract_from_variable = { CHI_pac_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_pac_civ_war_subtract_tt
	}
}
CHI_gov_civ_war_subtract_1_effect = {
	subtract_from_variable = { CHI_gov_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_gov_civ_war_subtract_tt
	}
}
CHI_gov_civ_war_subtract_2_effect = {
	subtract_from_variable = { CHI_gov_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_gov_civ_war_subtract_tt
	}
}
CHI_crs_civ_war_subtract_1_effect = {
	subtract_from_variable = { CHI_crs_civ_war_var = 1 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_crs_civ_war_subtract_tt
	}
}
CHI_crs_civ_war_subtract_2_effect = {
	subtract_from_variable = { CHI_crs_civ_war_var = 2 }
	if = {
		limit = { has_country_flag = CHI_civ_war_guide_flag }
		custom_effect_tooltip = CHI_crs_civ_war_subtract_tt
	}
}
CHI_purge_RCA_generals_effect = {
	every_character = {
		limit = {
			has_character_flag = CHI_RCA_military_loyalist_flag
		}
		retire = yes
	}
}
CHI_purge_PAC_generals_effect = {
	every_character = {
		limit = {
			has_character_flag = CHI_PAC_military_loyalist_flag
		}
		retire = yes
	}
}
CHI_purge_RCF_generals_effect = {
	every_character = {
		limit = {
			has_character_flag = CHI_RCF_military_loyalist_flag
		}
		retire = yes
	}
}
CHI_purge_LCS_generals_effect = {
	every_character = {
		limit = {
			has_character_flag = CHI_LCS_military_loyalist_flag
		}
		retire = yes
	}
}
CHI_purge_CRS_generals_effect = {
	every_character = {
		limit = {
			has_character_flag = CHI_CRS_military_loyalist_flag
		}
		retire = yes
	}
}
#Special Flag for Song Ziwen because he's a countryleader
CHI_recruit_song_ziwen_effect = {
	if = {
		limit = { NOT = { has_country_flag = CHI_song_ziwen_available_flag } }
		set_country_flag = CHI_song_ziwen_available_flag
		effect_tooltip = { CHI_song_ziwen = { set_nationality = CHI } }
	}
}
CHI_recruit_RCA_generals_effect = {
	CHI_zhang_zhizhong = { CHN_recruit_character_effect = yes }
	CHI_zhou_enlai = { CHN_recruit_character_effect = yes }
	CHI_chen_geng = { CHN_recruit_character_effect = yes }
	CHI_nie_rongzhen = { CHN_recruit_character_effect = yes }
	CHI_chen_changzu = { CHN_recruit_character_effect = yes }
	CHI_bai_wenwei = { CHN_recruit_character_effect = yes }
}
CHI_recruit_PAC_generals_effect = {
	CHI_deng_yanda = { CHN_recruit_character_effect = yes }
	CHI_ye_ting = { CHN_recruit_character_effect = yes }
	CHI_huang_qixiang = { CHN_recruit_character_effect = yes }
	CHI_xu_xiangqian = { CHN_recruit_character_effect = yes }
	CHI_wang_yaowu = { CHN_recruit_character_effect = yes }
	CHI_su_yu = { CHN_recruit_character_effect = yes }
	CHI_zhang_yunyi = { CHN_recruit_character_effect = yes }
	CHI_du_yuming = { CHN_recruit_character_effect = yes }
	CHI_zhou_zhirou = { CHN_recruit_character_effect = yes }
	if = {
		limit = {
			HNN = {
				OR = {
					NOT = { has_character = HNN_tang_shengzhi }
					exists = no
				}
			}
		}
		HNN_tang_shengzhi = { CHN_recruit_character_effect = yes }
		HNN_he_long = { CHN_recruit_character_effect = yes }
		HNN_peng_dehuai = { CHN_recruit_character_effect = yes }
		HNN_li_pinxian = { CHN_recruit_character_effect = yes }
	}
}
CHI_recruit_RCF_generals_effect = {
	if = {
		limit = { NOT = { has_idea = CHI_nation_in_disarray_idea } }
		CHI_li_jishen = { CHN_recruit_character_effect = yes }
	}
	CHI_zhang_fakui = { CHN_recruit_character_effect = yes }
	CHI_xue_yue = { CHN_recruit_character_effect = yes }
	if = {
		limit = {
			HNN = {
				OR = {
					NOT = { has_character = HNN_cheng_qian }
					exists = no
				}
			}
		}
		HNN_cheng_qian = { CHN_recruit_character_effect = yes }
		HNN_song_xilian = { CHN_recruit_character_effect = yes }
		HNN_yang_jie = { CHN_recruit_character_effect = yes }
	}
	if = {
		limit = {
			ANQ_sun_liren = { has_character_flag = CHI_RCF_military_loyalist_flag }
		}
		ANQ_sun_liren = { CHN_recruit_character_effect = yes }
	}
}
CHI_recruit_LCS_generals_effect = {
	CHI_li_zhilong = { CHN_recruit_character_effect = yes }
	CHI_xiao_jinguang = { CHN_recruit_character_effect = yes }
}
CHI_recruit_CRS_generals_effect = {
	CHI_hu_zongnan = { CHN_recruit_character_effect = yes }
	CHI_he_zhonghan = { CHN_recruit_character_effect = yes }
	CHI_lin_biao = { CHN_recruit_character_effect = yes }
	CHI_deng_wenyi = { CHN_recruit_character_effect = yes }
	CHI_dai_anlan = { CHN_recruit_character_effect = yes }
	CHI_chiang_wei_kuo = { CHN_recruit_character_effect = yes }
	CHI_mao_bangchu = { CHN_recruit_character_effect = yes }
}

CHI_recruit_RCA_endgame_advisors_effect = {
	CHI_gu_mengyu = { CHN_recruit_character_effect = yes }
	CHI_shi_cuntong = { CHN_recruit_character_effect = yes }
	CHI_wang_faqin = { CHN_recruit_character_effect = yes }
	CHI_chen_bijun = { CHN_recruit_character_effect = yes }
	CHI_chu_minyi = { CHN_recruit_character_effect = yes }
	CHI_li_shiqun = { CHN_recruit_character_effect = yes }
	CHI_gu_zhenggang = { CHN_recruit_character_effect = yes }
	CHI_guo_chuntao = { CHN_recruit_character_effect = yes }
	CHI_zeng_xing = { CHN_recruit_character_effect = yes }
	CHI_zhou_fohai = { CHN_recruit_character_effect = yes }
}
CHI_recruit_PAC_endgame_advisors_effect = {
	CHI_chen_youren = { CHN_recruit_character_effect = yes }
	CHI_zhang_bojun = { CHN_recruit_character_effect = yes }
	CHI_he_xiangning = { CHN_recruit_character_effect = yes }
	CHI_peng_zexiang = { CHN_recruit_character_effect = yes }
	CHI_zhang_yunchuan = { CHN_recruit_character_effect = yes }
	CHI_recruit_song_ziwen_effect = yes
}
CHI_recruit_CRS_endgame_advisors_effect = {
	CHI_liu_butong = { CHN_recruit_character_effect = yes }
	CHI_dai_chunfeng = { CHN_recruit_character_effect = yes }
	CHI_mao_renfeng = { CHN_recruit_character_effect = yes }
	CHI_xiao_zanyu = { CHN_recruit_character_effect = yes }
	CHI_chiang_ching_kuo = { CHN_recruit_character_effect = yes }
}
CHI_recruit_LCS_advisors_effect = {
	CHI_chen_duxiu = { CHN_recruit_character_effect = yes }
	CHI_li_lisan = { CHN_recruit_character_effect = yes }
	CHI_dong_biwu = { CHN_recruit_character_effect = yes }
	CHI_qin_bangxian = { CHN_recruit_character_effect = yes }
	CHI_liu_shaoqi = { CHN_recruit_character_effect = yes }
}

CHI_purge_advisors_effect = {
	if = {
		limit = { CHI = { has_character = PREV } }
		retire = yes
	}
}

CHI_purge_RCA_advisors_effect = {
	CHI_gu_mengyu = { CHI_purge_advisors_effect = yes }
	CHI_shi_cuntong = { CHI_purge_advisors_effect = yes }
	CHI_wang_faqin = { CHI_purge_advisors_effect = yes }
	CHI_chen_bijun = { CHI_purge_advisors_effect = yes }
	CHI_chu_minyi = { CHI_purge_advisors_effect = yes }
	CHI_li_shiqun = { CHI_purge_advisors_effect = yes }
	CHI_gu_zhenggang = { CHI_purge_advisors_effect = yes }
	CHI_guo_chuntao = { CHI_purge_advisors_effect = yes }
	CHI_zhou_fohai = { CHI_purge_advisors_effect = yes }
	CHI_zeng_xing = { CHI_purge_advisors_effect = yes }
}

CHI_purge_PAC_advisors_effect = {
	CHI_chen_youren = { CHI_purge_advisors_effect = yes }
	CHI_zhang_bojun = { CHI_purge_advisors_effect = yes }
	CHI_he_xiangning = { CHI_purge_advisors_effect = yes }
	CHI_peng_zexiang = { CHI_purge_advisors_effect = yes }
	CHI_zhang_yunchuan = { CHI_purge_advisors_effect = yes }
	#Special Flag for Song Ziwen because he's a countryleader
	if = {
		limit = { has_country_flag = CHI_song_ziwen_available_flag }
		effect_tooltip = { CHI_song_ziwen = { CHI_purge_advisors_effect = yes } }
		hidden_effect = { clr_country_flag = CHI_song_ziwen_available_flag }
	}
}

CHI_purge_CRS_advisors_effect = {
	CHI_liu_butong = { CHI_purge_advisors_effect = yes }
	CHI_dai_chunfeng = { CHI_purge_advisors_effect = yes }
	CHI_mao_renfeng = { CHI_purge_advisors_effect = yes }
	CHI_xiao_zanyu = { CHI_purge_advisors_effect = yes }
	CHI_chiang_ching_kuo = { CHI_purge_advisors_effect = yes }
}

CHI_purge_CSP_advisors_effect = {
	CHI_li_lisan = { CHI_purge_advisors_effect = yes }
	CHI_dong_biwu = { CHI_purge_advisors_effect = yes }
	CHI_qin_bangxian = { CHI_purge_advisors_effect = yes }
	CHI_liu_shaoqi = { CHI_purge_advisors_effect = yes }
}

CHI_exile_sun_fo_effect = {
	set_country_flag = CHI_sun_fo_exiled_flag
	custom_effect_tooltip = CHI_exile_sun_fo_tt
}

########################################
#####- Section 5: End Game - ###########
########################################

CHI_liberation_war_PREV_effect = {
	ROOT = {
		activate_targeted_decision = { target = PREV decision = KMT_liberation_war_decision }
	}
}

CHI_invest_in_third_world_setup_effect = {
	PREV = { #Should be the original tags
		activate_targeted_decision = { target = PREV decision = KMT_invest_in_third_world_decision }
	}
}

CHI_invest_in_third_world_activation_effect = {
	for_each_scope_loop = {
		array = global.asian_tags_array
		if = {
			limit = {
				NOT = {
					tag = ROOT
					num_of_controlled_factories > 20
				}
			}
			CHI_invest_in_third_world_setup_effect = yes
		}
	}
	for_each_scope_loop = {
		array = global.indian_tags_array
		if = {
			limit = {
				NOT = {
					tag = ROOT
					num_of_controlled_factories > 20
				}
			}
			CHI_invest_in_third_world_setup_effect = yes
		}
	}
	for_each_scope_loop = {
		array = global.african_tags_array
		if = {
			limit = {
				NOT = {
					tag = ROOT
					num_of_controlled_factories > 20
				}
			}
			CHI_invest_in_third_world_setup_effect = yes
		}
	}
	for_each_scope_loop = {
		array = global.middle_eastern_tags_array
		if = {
			limit = {
				NOT = {
					tag = ROOT
					num_of_controlled_factories > 20
				}
			}
			CHI_invest_in_third_world_setup_effect = yes
		}
	}
	for_each_scope_loop = {
		array = global.north_african_tags_array
		if = {
			limit = {
				NOT = {
					tag = ROOT
					num_of_controlled_factories > 20
				}
			}
			CHI_invest_in_third_world_setup_effect = yes
		}
	}
	for_each_scope_loop = {
		array = global.oceania_tags_array
		if = {
			limit = {
				NOT = {
					tag = ROOT
					num_of_controlled_factories > 20
				}
			}
			CHI_invest_in_third_world_setup_effect = yes
		}
	}
	set_variable = { CHI_invest_in_third_world_cost_var = 50 }
}

CHI_four_basic_rights_nanjing_effect = {
	613 = { #Nanjing
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = industrial_complex
			level = 2
			instant_build = yes
		}
	}
}
CHI_four_basic_rights_guangzhou_effect = {
	592 = { #Guangzhou
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = industrial_complex
			level = 2
			instant_build = yes
		}
	}
}
CHI_four_basic_rights_wuhan_effect = {
	1048 = { #Wuhan
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = industrial_complex
			level = 2
			instant_build = yes
		}
	}
}
CHI_four_basic_rights_beijing_effect = {
	608 = { #Beijing
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = industrial_complex
			level = 2
			instant_build = yes
		}
	}
}

CHI_four_basic_rights_effect = {
	custom_effect_tooltip = CHI_ensure_the_four_basic_rights_tt
	set_temp_variable = { CHI_basic_rights_temp_var = party_popularity@social_democrat }
	add_to_temp_variable = { CHI_basic_rights_temp_var = party_popularity@social_liberal }
	add_to_temp_variable = { CHI_basic_rights_temp_var = party_popularity@market_liberal }
	add_to_temp_variable = { CHI_basic_rights_temp_var = party_popularity@social_conservative }
	add_to_temp_Variable = { CHI_basic_rights_temp_var = party_popularity@authoritarian_democrat }
	multiply_temp_variable = { CHI_basic_rights_temp_var = 10 } #Party Pop ranges from 0-1. Multiply it by ten so range is 0-10
	clamp_temp_variable = {
		var = CHI_basic_rights_temp_var
		min = 0
		max = 10
	}
	round_temp_variable = CHI_basic_rights_temp_var
	if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 2 } }
		613 = { #Nanjing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 3 } }
		CHI_four_basic_rights_nanjing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 4 } }
		CHI_four_basic_rights_nanjing_effect = yes
		592 = { #Guangzhou
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 5 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 6 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		1048 = { #Wuhan
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 7 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 8 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		608 = { #Beijing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 9 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 10 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_basic_rights_temp_var < 11 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 2
			add_building_construction = {
				type = industrial_complex
				level = 2
				instant_build = yes
			}
		}
	}
}
CHI_disloyal_army_effect = {
	if = {
		limit = { has_idea = CHI_disloyal_army_idea }
		swap_ideas = {
			remove_idea = 	CHI_disloyal_army_idea
			add_idea = CHI_disloyal_army_2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_disloyal_army_2_idea }
		remove_ideas = CHI_disloyal_army_2_idea
	}
}
CHI_unfulfilled_promises_effect = {
	if = {
		limit = { has_idea = CHI_unfulfilled_promises_idea }
		swap_ideas = {
			remove_idea = CHI_unfulfilled_promises_idea
			add_idea = 	CHI_unfulfilled_promises_2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_unfulfilled_promises_2_idea }
		remove_ideas = CHI_unfulfilled_promises_2_idea
	}
}
CHI_devastated_nation_effect = {
	if = {
		limit = { has_idea = CHI_devastated_nation_idea }
		swap_ideas = {
			remove_idea = CHI_devastated_nation_idea
			add_idea = CHI_devastated_nation_2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_devastated_nation_2_idea }
		remove_ideas = CHI_devastated_nation_2_idea
	}
}
CHI_socialist_cooperatives_effect = {
	custom_effect_tooltip = CHI_socialist_cooperatives_effect_tt
	set_temp_variable = { CHI_socialist_cooperatives_var = party_popularity@totalist }
	add_to_temp_variable = { CHI_socialist_cooperatives_var = party_popularity@syndicalist }
	multiply_temp_variable = { CHI_socialist_cooperatives_var = 10 } #Party Pop ranges from 0-1. Multiply it by ten so range is 0-10
	clamp_temp_variable = {
		var = CHI_socialist_cooperatives_var
		min = 0
		max = 10
	}
	round_temp_variable = CHI_socialist_cooperatives_var
	if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 2 } }
		613 = { #Nanjing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 3 } }
		CHI_four_basic_rights_nanjing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 4 } }
		CHI_four_basic_rights_nanjing_effect = yes
		592 = { #Guangzhou
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 5 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 6 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		1048 = { #Wuhan
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 7 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 8 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		608 = { #Beijing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 9 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 10 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_socialist_cooperatives_var < 11 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 2
			add_building_construction = {
				type = industrial_complex
				level = 2
				instant_build = yes
			}
		}
	}
}

CHI_remove_the_rump_government_effect = {
	if = {
		limit = { has_idea = CHI_the_rump_government_idea }
		swap_ideas = {
			remove_idea = CHI_the_rump_government_idea
			add_idea = CHI_the_rump_government_2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_the_rump_government_2_idea }
		remove_ideas = CHI_the_rump_government_2_idea
	}
}
CHI_remove_ongoing_resistance_effect = {
	if = {
		limit = { has_idea = CHI_ongoing_resistance_idea }
		swap_ideas = {
			remove_idea = CHI_ongoing_resistance_idea
			add_idea = CHI_ongoing_resistance_2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_ongoing_resistance_2_idea }
		remove_ideas = CHI_ongoing_resistance_2_idea
	}
}
CHI_militarisation_of_society_nanjing_effect = {
	613 = { #Nanjing
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
	}
}
CHI_militarisation_of_society_guangzhou_effect = {
	592 = { #Guangzhou
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
	}
}
CHI_militarisation_of_society_wuhan_effect = {
	1048 = { #Wuhan
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
	}
}
CHI_militarisation_of_society_beijing_effect = {
	608 = { #Beijing
		add_extra_state_shared_building_slots = 2
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
	}
}
CHI_militarisation_of_society_effect = {
	custom_effect_tooltip = CHI_militarisation_of_society_effect_tt
	set_temp_variable = { CHI_militarisation_of_society_var = party_popularity@totalist }
	multiply_temp_variable = { CHI_militarisation_of_society_var = 10 } #Party Pop ranges from 0-1. Multiply it by ten so range is 0-10
	clamp_temp_variable = {
		var = CHI_militarisation_of_society_var
		min = 0
		max = 10
	}
	round_temp_variable = CHI_militarisation_of_society_var
	if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 2 } }
		613 = { #Nanjing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 3 } }
		CHI_militarisation_of_society_nanjing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 4 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		592 = { #Guangzhou
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 5 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 6 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
		1048 = { #Wuhan
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 7 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
		CHI_militarisation_of_society_wuhan_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 8 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
		CHI_militarisation_of_society_wuhan_effect = yes
		608 = { #Beijing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 9 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
		CHI_militarisation_of_society_wuhan_effect = yes
		CHI_militarisation_of_society_beijing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 10 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
		CHI_militarisation_of_society_wuhan_effect = yes
		CHI_militarisation_of_society_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = arms_factory
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_militarisation_of_society_var < 11 } }
		CHI_militarisation_of_society_nanjing_effect = yes
		CHI_militarisation_of_society_guangzhou_effect = yes
		CHI_militarisation_of_society_wuhan_effect = yes
		CHI_militarisation_of_society_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 2
			add_building_construction = {
				type = arms_factory
				level = 2
				instant_build = yes
			}
		}
	}
}
CHI_syndicalist_communes_effect = {
	custom_effect_tooltip = CHI_syndicalist_communes_effect_tt
	set_temp_variable = { CHI_syndicalist_communes_var = party_popularity@syndicalist }
	multiply_temp_variable = { CHI_syndicalist_communes_var = 10 } #Party Pop ranges from 0-1. Multiply it by ten so range is 0-10
	clamp_temp_variable = {
		var = CHI_syndicalist_communes_var
		min = 0
		max = 10
	}
	round_temp_variable = CHI_syndicalist_communes_var
	if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 2 } }
		613 = { #Nanjing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 3 } }
		CHI_four_basic_rights_nanjing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 4 } }
		CHI_four_basic_rights_nanjing_effect = yes
		592 = { #Guangzhou
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 5 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 6 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		1048 = { #Wuhan
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 7 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 8 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		608 = { #Beijing
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 9 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 10 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 1
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	else_if = {
		limit = { check_variable = { CHI_syndicalist_communes_var < 11 } }
		CHI_four_basic_rights_nanjing_effect = yes
		CHI_four_basic_rights_guangzhou_effect = yes
		CHI_four_basic_rights_wuhan_effect = yes
		CHI_four_basic_rights_beijing_effect = yes
		602 = { #Changsha
			add_extra_state_shared_building_slots = 2
			add_building_construction = {
				type = industrial_complex
				level = 2
				instant_build = yes
			}
		}
	}
}

CHI_reset_legitimacy_ideas_effect = {
	if = {
		limit = {
			OR = {
				has_idea = CHI_popular_support_proletarian_future_idea
				has_idea = KR_CHI_popular_support_radical_idea
				has_idea = KR_CHI_popular_support_residence_idea
				has_idea = KR_CHI_popular_support_moderate_idea
				has_idea = KR_CHI_popular_support_federalist_idea
				has_idea = CHI_true_love_idea
				has_idea = CHI_towards_the_social_revolution_idea
				has_idea = CHI_realising_the_dream_of_sun_yat_sen_idea
				has_idea = CHI_popular_support_chen_revolution_idea
				has_idea = CHI_chairmans_will_popular_support_idea
				has_idea = CHI_total_abnegation_popular_support_idea
				has_idea = CHI_the_lingxiu_popular_support_idea
			}
		}
		remove_ideas = {
			CHI_popular_support_proletarian_future_idea
			KR_CHI_popular_support_radical_idea
			KR_CHI_popular_support_residence_idea
			KR_CHI_popular_support_moderate_idea
			KR_CHI_popular_support_federalist_idea
			CHI_true_love_idea
			CHI_towards_the_social_revolution_idea
			CHI_realising_the_dream_of_sun_yat_sen_idea
			CHI_popular_support_chen_revolution_idea
			CHI_chairmans_will_popular_support_idea
			CHI_total_abnegation_popular_support_idea
			CHI_the_lingxiu_popular_support_idea
		}
		add_ideas = KR_CHI_popular_support_5
	}
}

CHI_remove_phase_1_ideas_effect = {
	remove_ideas = {
		CHI_army_discipline_idea
		CHI_last_stand_of_kmt_idea
		CHI_collapsed_NRA_idea
		CHI_final_push_of_kmt_idea
	}
	if = {
		limit = { has_idea = CHI_insurgent_army_idea_1 }
		swap_ideas = {
			remove_idea = CHI_insurgent_army_idea_1
			add_idea = CHI_nra_idea
		}
	}
	else_if = {
		limit = { has_idea = CHI_insurgent_army_idea_2 }
		swap_ideas = {
			remove_idea = CHI_insurgent_army_idea_2
			add_idea = CHI_nra_idea
		}
	}
	if = {
		limit = {
			NOT = {
				has_idea = CHI_mac_idea
				has_idea = CHI_mac_idea2
				has_idea = CHI_mac_idea3
			}
		}
		add_ideas = CHI_mac_idea
	}
}

CHI_remove_phase_2_ideas_effect = {
	remove_ideas = {
		CHI_improvised_rifle_idea
		CHI_commissars_idea
		CHI_dare_to_die_idea
		CHI_tender_to_masses_zhang_idea
		CHI_tender_to_masses_shi_idea
		CHI_tender_to_masses_zhang_and_shi_idea
		CHI_women_in_workforce_idea
		CHI_empowering_urban_workers_idea
		CHI_empowering_rural_peasants_idea
		CHI_balance_peasant_workers_idea
		CHI_banks_and_bureaucracy_idea
		CHI_industrialising_nation_idea
		CHI_modernising_army_idea
	}
	CHI_remove_league_reconstruction_effect = yes
}

CHI_remove_phase_4_ideas_effect = {
	remove_ideas = {
		CHI_intellectual_opposition_idea
		CHI_popular_protests_idea
		CHI_fracturing_party_idea
		CHI_empower_rural_cooperatives_idea
		CHI_exalt_the_proletarian_struggle_idea
		CHI_workplace_democracy_idea

		CHI_foster_class_collaboration_idea
		CHI_nationalist_youth_orgs_idea
		CHI_third_stage_of_revolution_idea

		CHI_loyalist_infighting_idea
		CHI_mass_disillusionment_idea
		CHI_demoralised_army_idea
		CHI_technocratic_administration_idea
		CHI_no_reconstruction_without_peace_idea

		CHI_unfulfilled_promises_idea
		CHI_unfulfilled_promises_2_idea
		CHI_devastated_nation_idea
		CHI_devastated_nation_2_idea
		CHI_disloyal_army_idea
		CHI_disloyal_army_2_idea
		CHI_expel_the_landlords_idea

		CHI_ongoing_resistance_idea
		CHI_ongoing_resistance_2_idea
		CHI_the_rump_government_idea
		CHI_the_rump_government_2_idea
		CHI_eliminate_unnecessary_bureaucracy_idea
		CHI_concept_of_productivity_idea
		CHI_chinese_autarky_idea
		CHI_chinese_autarky_2a_idea
		CHI_chinese_autarky_2b_idea
		CHI_deploy_the_blueshirts_idea
		KMT_never_another_humiliation_idea

		CHI_broken_military_remnants_idea_1
		CHI_broken_military_remnants_idea_2
		CHI_csp_economic_chaos_idea_1
		CHI_csp_economic_chaos_idea_2
		CHI_shattered_political_order_idea_1
		CHI_shattered_political_order_idea_2

		KMT_lead_the_liberation_of_asia_idea
		KMT_lead_the_liberation_of_asia_wang_idea
		KMT_lead_the_liberation_of_asia_2_idea
		CHI_chinese_revanchism_idea
		CHI_xenophobic_isolation_idea
		CHI_mmic_nra_cooperation_idea
		CHI_champion_of_developing_world_idea
		CHI_industrial_volunteers_idea
		CHI_invite_foreign_investment_idea
	}
}

CHI_remove_dynamic_modifiers_effect = {
	remove_dynamic_modifier = { modifier = KMT_state_capitalism_plan }
	remove_dynamic_modifier = { modifier = CHI_red_napoleon_effect }
	remove_dynamic_modifier = { modifier = CHI_realising_datong_effect }
	remove_dynamic_modifier = { modifier = CHI_iron_necked_liberal_effect }
	remove_dynamic_modifier = { modifier = CHI_realising_minquan }
}

CHI_setup_puppet_ideas_effect = {
	CHI_remove_phase_1_ideas_effect = yes
	CHI_remove_phase_2_ideas_effect = yes
	CHI_remove_phase_4_ideas_effect = yes
	CHI_reset_legitimacy_ideas_effect = yes
	CHI_remove_dynamic_modifiers_effect = yes
}

CHI_reset_endgame_trees_effect = {
	if = {
		limit = { has_completed_focus = CHI_heir_to_the_revolution }
		uncomplete_national_focus = {
			focus = CHI_heir_to_the_revolution
			uncomplete_children = yes
		}
	}
	if = {
		limit = { has_completed_focus = CHI_action_now }
		uncomplete_national_focus = {
			focus = CHI_action_now
			uncomplete_children = yes
		}
	}
	if = {
		limit = { has_completed_focus = CHI_the_second_reorganisation }
		uncomplete_national_focus = {
			focus = CHI_the_second_reorganisation
			uncomplete_children = yes
		}
	}
	if = {
		limit = { has_completed_focus = CHI_the_second_national_revolution }
		uncomplete_national_focus = {
			focus = CHI_the_second_national_revolution
			uncomplete_children = yes
		}
	}
	if = {
		limit = { has_completed_focus = CHI_new_way_ancient_civ }
		uncomplete_national_focus = {
			focus = CHI_new_way_ancient_civ
			uncomplete_children = yes
		}
	}
}

CHI_puppet_setup_gov_effect = {
	hidden_effect = {
		#Baseline party names
		set_party_name = {
			ideology = totalist
			name = CHI_crs_party
			long_name = CHI_crs_party_long
		}
		set_party_name = {
			ideology = syndicalist
			name = CHI_LCS_party
			long_name = CHI_LCS_party_long
		}
		set_party_name = {
			ideology = radical_socialist
			name = CHI_rca_party
			long_name = CHI_rca_party_long
		}
		set_party_name = {
			ideology = social_democrat
			name = CHI_pac_party
			long_name = CHI_pac_party_long
		}
		set_party_name = {
			ideology = social_liberal
			name = CHI_RCF_party
			long_name = CHI_RCF_party_long
		}
	}
	if = {
		limit = { ROOT = { has_government = syndicalist } }
		CHI_chen_duxiu = { set_nationality = CHI }
		CHI_li_lisan = { set_nationality = CHI }
		CHI_chen_duxiu = { promote_character = syndicalist_subtype }
		activate_advisor = CHI_li_lisan_sic
		complete_national_focus = CHI_new_way_ancient_civ
		hidden_effect = {
			set_party_name = {
				ideology = totalist
				name = CHI_csp_rad_party
				long_name = CHI_csp_rad_party_long
			}
			CHI_chen_shaoyu = { promote_character = totalist_subtype }
			set_party_name = {
				ideology = syndicalist
				name = CHI_csp_ort_party
				long_name = CHI_csp_ort_party_long
			}
			set_party_name = {
				ideology = social_conservative
				name = CHI_wrd_soc_party
				long_name = CHI_wrd_soc_party_long
			}
			set_popularities = {
				totalist = 5
				radical_socialist = 7
				syndicalist = 8
				social_democrat = 5
				social_liberal = 3
				market_liberal = 20
				social_conservative = 2
				authoritarian_democrat = 20
				paternal_autocrat = 25
				national_populist = 5
			}
		}
	}
	else_if = {
		limit = { ROOT = { has_government = totalist } }
		hidden_effect = {
			set_party_name = {
				ideology = totalist
				long_name = CHI_crs_party_long
				name = CHI_crs_party
			}
			set_popularities = {
				totalist = 8
				radical_socialist = 7
				syndicalist = 5
				social_democrat = 5
				social_liberal = 3
				market_liberal = 20
				social_conservative = 2
				authoritarian_democrat = 20
				paternal_autocrat = 25
				national_populist = 5
			}
		}

		if = {
			limit = { CHI_hu_zongnan = { is_dead = no } }
			CHI_hu_zongnan = { set_nationality = CHI }
			CHI_dai_chunfeng = { set_nationality = CHI }
			CHI_lixingshe = { set_nationality = CHI }
			CHI_hu_zongnan = { promote_character = totalist_subtype }
			hidden_effect = {
				CHI_hu_zongnan = { promote_character = national_populist_subtype }
				CHI_dai_chunfeng = { promote_character = authoritarian_democrat_subtype }
				CHI_lixingshe = { promote_character = paternal_autocrat_subtype }
			}
		}

		else = {
			CHI_lin_biao = { set_nationality = CHI }
			#If Hu dies, Dai always is dead
			CHI_lixingshe = { set_nationality = CHI }
			CHI_lin_biao = {
				promote_to_field_marshal = yes
				promote_character = totalist_subtype
			}
			hidden_effect = {
				CHI_lixingshe = { promote_character = paternal_autocrat_subtype }
				CHI_lixingshe = { promote_character = national_populist_subtype }
			}
		}
		activate_advisor = CHI_lixingshe_sic
		complete_national_focus = CHI_the_second_national_revolution
	}
	else = {
		if = {
			limit = { CHI_wang_jingwei = { is_dead = no } }
			CHI_wang_jingwei = { set_nationality = CHI }
			CHI_chen_gongbo = { set_nationality = CHI }
			CHI_wang_jingwei = { promote_character = radical_socialist_subtype }
			activate_advisor = CHI_chen_gongbo_sic
			complete_national_focus = CHI_heir_to_the_revolution
			hidden_effect = {
				set_party_name = {
					ideology = totalist
					long_name = CHI_rca_radical_party_long
					name = CHI_rca_radical_party
				}
				CHI_chen_gongbo = { promote_character = totalist_subtype }
				CHI_gu_mengyu = { promote_character = social_democrat_subtype }
				set_party_name = {
					ideology = radical_socialist
					long_name = CHI_residence_faction_party_long
					name = CHI_residence_faction_party
				}
				set_party_name = {
					ideology = social_democrat
					long_name = CHI_rca_moderate_party_long
					name = CHI_rca_moderate_party
				}
				set_popularities = {
					totalist = 5
					radical_socialist = 10
					syndicalist = 5
					social_democrat = 5
					social_liberal = 3
					market_liberal = 20
					social_conservative = 2
					authoritarian_democrat = 20
					paternal_autocrat = 25
					national_populist = 5
				}
			}
		}
		else = {
			CHI_song_qingling = { set_nationality = CHI }
			CHI_deng_yanda = { set_nationality = CHI }
			CHI_song_qingling = { promote_character = radical_socialist_subtype }
			activate_advisor = CHI_deng_yanda_sic
			complete_national_focus = CHI_action_now
			hidden_effect = {
				set_party_name = {
					ideology = radical_socialist
					long_name = CHI_revolutionary_committee_party_long
					name = CHI_revolutionary_committee_party
				}
				set_party_name = {
					ideology = social_democrat
					long_name = CHI_rca_moderate_party_long
					name = CHI_rca_moderate_party
				}
				set_popularities = {
					totalist = 5
					radical_socialist = 8
					syndicalist = 5
					social_democrat = 7
					social_liberal = 3
					market_liberal = 20
					social_conservative = 2
					authoritarian_democrat = 20
					paternal_autocrat = 25
					national_populist = 5
				}
			}
		}
		#In case INC or other KMT aligned soc-dems release them
		hidden_effect = { CHI = { set_politics = { ruling_party = radical_socialist } } }
	}
}

CHI_puppet_setup_effect = {
	CHI_reset_endgame_trees_effect = yes
	hidden_effect = { CHI_setup_puppet_ideas_effect = yes }
	CHI_puppet_setup_gov_effect = yes
	set_country_flag = CHI_phase_four_begins_flag
	mark_focus_tree_layout_dirty = yes
	if = {
		limit = { owns_state = 1048 } #Wuhan
		china_merges_wuhan = yes
		add_state_core = 1048
		set_capital = { state = 1048 remember_old_capital = no }
	}
	else_if = {
		limit = { owns_state = 613 } #Nanjing
		add_state_core = 613
		set_capital = { state = 613 remember_old_capital = no }
	}
	else_if = {
		limit = { owns_state = 592 } #Canton
		add_state_core = 592
		set_capital = { state = 592 remember_old_capital = no }
	}
	else_if = {
		limit = { owns_state = 608 } #Beijing
		add_state_core = 608
		set_capital = { state = 608 remember_old_capital = no }
	}
}
#CSP scripted effects
CHI_csp_economic_chaos_effect = {
	if = {
		limit = { has_idea = CHI_csp_economic_chaos_idea_1 }
		swap_ideas = {
			remove_idea = CHI_csp_economic_chaos_idea_1
			add_idea = 	CHI_csp_economic_chaos_idea_2
		}
	}
	else_if = {
		limit = { has_idea = CHI_csp_economic_chaos_idea_2 }
		remove_ideas = 	CHI_csp_economic_chaos_idea_2
	}
}
CHI_broken_military_remnants_effect = {
	if = {
		limit = { has_idea = CHI_broken_military_remnants_idea_1 }
		swap_ideas = {
			remove_idea = 	CHI_broken_military_remnants_idea_1
			add_idea = 	CHI_broken_military_remnants_idea_2
		}
	}
	else_if = {
		limit = { has_idea = CHI_broken_military_remnants_idea_2 }
		remove_ideas = 	CHI_broken_military_remnants_idea_2
	}
}
CHI_shattered_political_order_effect = {
	if = {
		limit = { has_idea = CHI_shattered_political_order_idea_1 }
		swap_ideas = {
			remove_idea = 	CHI_shattered_political_order_idea_1
			add_idea = 	CHI_shattered_political_order_idea_2
		}
	}
	else_if = {
		limit = { has_idea = CHI_shattered_political_order_idea_2 }
		remove_ideas = 	CHI_shattered_political_order_idea_2
	}
}

#Uniform Change Effects

CHI_recruit_li_zongren_effect = {
	GXC = {
		GXC_li_zongren = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_character_flag = CHI_RCF_military_loyalist_flag
		}
	}
}

CHI_recruit_sun_liren_effect = {
	ANQ = {
		ANQ_sun_liren = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_character_flag = CHI_RCF_military_loyalist_flag
			set_portraits = {
				army = {
					small = GFX_portrait_ANQ_sun_liren_army_small_kuomintang
					large = GFX_portrait_ANQ_sun_liren_army_large_kuomintang
				}
			}
		}
	}
}
CHI_recruit_zhu_peide_effect = {
	YUN = {
		YUN_zhu_peide = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_character_flag = CHI_RCF_military_loyalist_flag
		}
	}
}
CHI_recruit_jin_handing_effect = {
	YUN = {
		YUN_jin_handing = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_character_flag = CHI_RCF_military_loyalist_flag
		}
	}
}
CHI_recruit_he_yingqin_effect = {
	YUN = {
		YUN_he_yingqin = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_character_flag = CHI_RCF_military_loyalist_flag
		}
	}
}
CHI_recruit_chen_jiongming_effect = {
	GXC = {
		GXC_chen_jiongming = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_portraits = {
				army = { large = GFX_portrait_GXC_chen_jiongming_army_large_kuomintang }
			}
		}
	}
}
CHI_recruit_jiang_guangnai_effect = {
	GXC = {
		GXC_jiang_guangnai = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}
CHI_recruit_chen_jitang_effect = {
	GXC = {
		GXC_chen_jitang = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}
CHI_recruit_shang_zhen_effect = {
	SHX = {
		SHX_shang_zhen = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_character_flag = CHI_RCF_military_loyalist_flag
			set_portraits = {
				army = {
					large = GFX_portrait_SHX_shang_zhen_army_large_kuomintang
					small = GFX_portrait_SHX_shang_zhen_army_small_kuomintang
				}
			}
		}
	}
}
CHI_recruit_fu_zuoyi_effect = {
	SHX = {
		SHX_fu_zuoyi = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_portraits = {
				army = { large = GFX_portrait_SHX_fu_zuoyi_army_large_kuomintang }
			}
		}
	}
}
CHI_recruit_tang_enbo_effect = {
	LEP = {
		LEP_tang_enbo = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			set_portraits = {
				army = {
					large = GFX_portrait_LEP_tang_enbo_army_large_kuomintang
					small = GFX_portrait_LEP_tang_enbo_army_small_kuomintang
				}
			}
		}
	}
}
CHI_recruit_peng_xuefeng_effect = {
	ANQ = {
		CHI_peng_xuefeng = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
			add_corps_commander_role = {
				desc = CHI_peng_xuefeng_high_command_desc
				traits = { harsh_leader commando trait_reckless irregulars_officer }
				skill = 1
				attack_skill = 1
				defense_skill = 1
				planning_skill = 1
				logistics_skill = 1
			}
			remove_country_leader_role = { ideology = totalist_subtype }
			remove_country_leader_role = { ideology = syndicalist_subtype }
			remove_country_leader_role = { ideology = radical_socialist_subtype }
		}
	}
}
CHI_recruit_fan_shisheng_effect = {
	YUN = {
		YUN_fan_shisheng = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}
CHI_recruit_cai_tingkai_effect = {
	GXC = {
		GXC_cai_tingkai = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}
CHI_recruit_chen_mingshu_effect = {
	GXC = {
		GXC_chen_mingshu = {
			#NOTE: MUST RECRUIT FIRST, THEN DO PORTRAIT SWAP - OTHERWISE WILL NOT WORK
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}
CHI_recruit_zhu_de_effect = {
	YUN = {
		YUN_zhu_de = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}
CHI_recruit_chen_yi_effect = {
	YUN = {
		YUN_chen_yi = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}

CHI_recruit_chen_cheng_effect = {
	YUN = {
		YUN_chen_cheng = {
			CHN_recruit_character_effect = yes
			remove_second_in_command_role = yes
		}
	}
}

#Make sure this is at the bottom
CHI_recruit_rkmt_generals_from_THIS = {
	if = {
		limit = { original_tag = ANQ }
		CHI_recruit_sun_liren_effect = yes
	}
	if = {
		limit = { tag = GXC }
		CHI_recruit_li_zongren_effect = yes
		CHI_recruit_chen_jitang_effect = yes
	}
	else_if = {
		limit = { original_tag = YUN }
		CHI_recruit_zhu_peide_effect = yes
		CHI_recruit_he_yingqin_effect = yes
		CHI_recruit_fan_shisheng_effect = yes
		CHI_recruit_jin_handing_effect = yes
		CHI_recruit_chen_cheng_effect = yes
	}
}

CHI_recruit_yun_socialist_generals_from_THIS = {
	if = {
		limit = { has_character = YUN_zhu_de }
		CHI_recruit_zhu_de_effect = yes
	}
	if = {
		limit = { has_character = YUN_chen_yi }
		CHI_recruit_chen_yi_effect = yes
	}
}
CHI_recruit_ppp_generals_from_THIS = {
	if = {
		limit = { has_character = GXC_chen_mingshu }
		CHI_recruit_chen_mingshu_effect = yes
		CHI_recruit_cai_tingkai_effect = yes
		CHI_recruit_jiang_guangnai_effect = yes
	}
}
CHI_recruit_federalist_generals_from_THIS = {
	if = {
		limit = {
			tag = GXC
			has_character = GXC_chen_jiongming
		}
		CHI_recruit_chen_jiongming_effect = yes
		CHI_recruit_jiang_guangnai_effect = yes
		CHI_recruit_chen_jitang_effect = yes
	}
	else_if = {
		limit = { has_character = GXC_chen_jiongming }
		CHI_recruit_chen_jiongming_effect = yes
	}
}
CHI_recruit_SHX_generals_from_THIS = {
	if = {
		limit = { has_character = SHX_shang_zhen }
		CHI_recruit_shang_zhen_effect = yes
	}
	if = {
		limit = { has_character = SHX_fu_zuoyi }
		CHI_recruit_fu_zuoyi_effect = yes
	}
}
CHI_recruit_GXC_syndie_generals_from_THIS = {
	#PLACEHOLDER
}

CHI_recruit_all_generals_from_THIS = {
	CHI_recruit_rkmt_generals_from_THIS = yes #Uniform swaps for KMT - RKMT
	CHI_recruit_federalist_generals_from_THIS = yes #Uniform swaps for KMT - Federalists
	CHI_recruit_SHX_generals_from_THIS = yes #Uniform swaps for KMT - Shanxi
	CHI_recruit_GXC_syndie_generals_from_THIS = yes #Uniform swaps for KMT - Syndie GXC generals
	CHI_recruit_ppp_generals_from_THIS = yes #Uniform swaps for PPP in GXC generals
	CHI_recruit_yun_socialist_generals_from_THIS = yes
}

