# AI scripted effects
# By Rylock and Alpinia

FROM_send_volunteers_to_ROOT = {
	FROM = {
		if = {
			limit = {
				NOT = {
					has_country_flag = sent_volunteers_@ROOT
					has_country_flag = imminent_war
					any_claim = yes #is justifying/being justified against
					check_variable = { modifier@cannot_receive_volunteers > 0 }
				}
			}

			#unlock volunteers diplo action
			set_rule = { can_send_volunteers = yes }

			#update count
			add_to_variable = { send_volunteers_count = 1 }

			#add spare unit factor if necessary
			if = {
				limit = {
					num_divisions < 32
					num_divisions > 24
					is_actual_major = no
				}
				log = "[THIS.GetName]: increased spare unit factor by 12"
				set_country_flag = AI_increased_spare_factor_12
				add_ai_strategy = {
					type = spare_unit_factor
					value = 12
				}
			}
			else_if = {
				limit = {
					num_divisions < 24
					num_divisions > 12
					is_actual_major = no
				}
				log = "[THIS.GetName]: increased spare unit factor by 6"
				set_country_flag = AI_increased_spare_factor_6
				add_ai_strategy = {
					type = spare_unit_factor
					value = 6
				}
			}
			else_if = {
				limit = {
					num_divisions < 12
					num_divisions > 6
					is_actual_major = no
				}
				log = "[THIS.GetName]: increased spare unit factor by 3"
				set_country_flag = AI_increased_spare_factor_3
				add_ai_strategy = {
					type = spare_unit_factor
					value = 3
				}
			}

			#add strategies
			log = "[THIS.GetName]: increased volunteer desire to [ROOT.GetName]"
			add_ai_strategy = {
				type = send_volunteers_desire
				id = ROOT
				value = 10000
			}
			add_ai_strategy = {
				type = send_lend_lease_desire
				id = ROOT
				value = 200
			}
			add_ai_strategy = {
				type = support
				id = ROOT
				value = 200
			}

			#set flag
			set_country_flag = sent_volunteers_@ROOT
		}
	}
}

send_volunteers_to_TARGET = {
	if = {
		limit = {
			NOT = {
				has_country_flag = sent_volunteers_@event_target:volunteer_target
				has_country_flag = imminent_war
				any_claim = yes #is justifying/being justified against
				check_variable = { event_target:volunteer_target.modifier@cannot_receive_volunteers > 0 }
			}
		}

		#unlock volunteers diplo action
		set_rule = { can_send_volunteers = yes }

		#update count
		add_to_variable = { send_volunteers_count = 1 }

		#add spare unit factor if necessary
		if = {
			limit = {
				num_divisions < 32
				num_divisions > 24
				is_actual_major = no
			}
			log = "[THIS.GetName]: increased spare unit factor by 12"
			set_country_flag = AI_increased_spare_factor_12
			add_ai_strategy = {
				type = spare_unit_factor
				value = 12
			}
		}
		else_if = {
			limit = {
				num_divisions < 24
				num_divisions > 12
				is_actual_major = no
			}
			log = "[THIS.GetName]: increased spare unit factor by 6"
			set_country_flag = AI_increased_spare_factor_6
			add_ai_strategy = {
				type = spare_unit_factor
				value = 6
			}
		}
		else_if = {
			limit = {
				num_divisions < 12
				num_divisions > 6
				is_actual_major = no
			}
			log = "[THIS.GetName]: increased spare unit factor by 3"
			set_country_flag = AI_increased_spare_factor_3
			add_ai_strategy = {
				type = spare_unit_factor
				value = 3
			}
		}

		#add strategies
		log = "[THIS.GetName]: increased volunteer desire to [volunteer_target.GetName]"
		add_ai_strategy = {
			type = send_volunteers_desire
			id = event_target:volunteer_target
			value = 10000
		}
		add_ai_strategy = {
			type = send_lend_lease_desire
			id = event_target:volunteer_target
			value = 200
		}
		add_ai_strategy = {
			type = support
			id = event_target:volunteer_target
			value = 200
		}

		#set flag
		set_country_flag = sent_volunteers_@event_target:volunteer_target
	}
}

clear_volunteers_to_TARGET = {
	if = {
		limit = { has_country_flag = sent_volunteers_@event_target:volunteer_target }
		#lock volunteers diplo action if no other volunteers
		subtract_from_variable = { send_volunteers_count = 1 }
		if = {
			limit = {
				is_ai = yes
				check_variable = { send_volunteers_count < 1 }
			}
			set_rule = { can_send_volunteers = no }
			log = "[THIS.GetName]: locked AI volunteers"
		}

		#remove spare unit factor
		if = {
			limit = {
				has_country_flag = AI_increased_spare_factor_12
			}
			log = "[THIS.GetName]: reduced spare unit factor by 12"
			clr_country_flag = AI_increased_spare_factor_12
			add_ai_strategy = {
				type = spare_unit_factor
				value = -12
			}
		}
		else_if = {
			limit = {
				has_country_flag = AI_increased_spare_factor_6
			}
			log = "[THIS.GetName]: reduced spare unit factor by 6"
			clr_country_flag = AI_increased_spare_factor_6
			add_ai_strategy = {
				type = spare_unit_factor
				value = -6
			}
		}
		else_if = {
			limit = {
				has_country_flag = AI_increased_spare_factor_3
			}
			log = "[THIS.GetName]: reduced spare unit factor by 3"
			clr_country_flag = AI_increased_spare_factor_3
			add_ai_strategy = {
				type = spare_unit_factor
				value = -3
			}
		}

		#remove strategies
		log = "[THIS.GetName]: removed volunteer desire to [volunteer_target.GetName]"
		add_ai_strategy = {
			type = send_volunteers_desire
			id = event_target:volunteer_target
			value = -10000
		}
		add_ai_strategy = {
			type = send_lend_lease_desire
			id = event_target:volunteer_target
			value = -200
		}
		add_ai_strategy = {
			type = support
			id = event_target:volunteer_target
			value = -200
		}

		#clear flag
		clr_country_flag = sent_volunteers_@event_target:volunteer_target
	}
}

clear_volunteers_to_PREV = {
	if = {
		limit = { has_country_flag = sent_volunteers_@PREV }
		#lock volunteers diplo action if no other volunteers
		subtract_from_variable = { send_volunteers_count = 1 }
		if = {
			limit = {
				is_ai = yes
				check_variable = { send_volunteers_count < 1 }
			}
			set_rule = { can_send_volunteers = no }
			log = "[THIS.GetName]: locked AI volunteers"
		}

		#remove spare unit factor
		if = {
			limit = {
				has_country_flag = AI_increased_spare_factor_12
			}
			log = "[THIS.GetName]: reduced spare unit factor by 12"
			clr_country_flag = AI_increased_spare_factor_12
			add_ai_strategy = {
				type = spare_unit_factor
				value = -12
			}
		}
		else_if = {
			limit = {
				has_country_flag = AI_increased_spare_factor_6
			}
			log = "[THIS.GetName]: reduced spare unit factor by 6"
			clr_country_flag = AI_increased_spare_factor_6
			add_ai_strategy = {
				type = spare_unit_factor
				value = -6
			}
		}
		else_if = {
			limit = {
				has_country_flag = AI_increased_spare_factor_3
			}
			log = "[THIS.GetName]: reduced spare unit factor by 3"
			clr_country_flag = AI_increased_spare_factor_3
			add_ai_strategy = {
				type = spare_unit_factor
				value = -3
			}
		}

		#remove strategies
		log = "[THIS.GetName]: removed volunteer desire to [PREV.GetName]"
		add_ai_strategy = {
			type = send_volunteers_desire
			id = PREV
			value = -10000
		}
		add_ai_strategy = {
			type = send_lend_lease_desire
			id = PREV
			value = -200
		}
		add_ai_strategy = {
			type = support
			id = PREV
			value = -200
		}

		#clear flag
		clr_country_flag = sent_volunteers_@PREV
	}
}

clear_all_volunteers = {
	every_country = {
		limit = {
			OR = {
				ROOT = { has_volunteers_amount_from = { tag = PREV count > 0 } }
				has_country_flag = sent_volunteers_@PREV
			}
		}
		recall_volunteers_from = PREV
		clear_volunteers_to_PREV = yes
	}
}

clear_all_sent_volunteers = {
	every_country = {
		limit = {
			OR = {
				has_volunteers_amount_from = { tag = ROOT count > 0 }
				ROOT = { has_country_flag = sent_volunteers_@PREV }
			}
		}
		ROOT = {
			recall_volunteers_from = PREV
			clear_volunteers_to_PREV = yes
		}
	}
}

### For use in decisions ###
setup_decision_attack_AI = {
	hidden_effect = {
		add_ai_strategy = {
			type = prepare_for_war
			id = FROM
			value = 1000
		}
		FROM = {
			add_ai_strategy = {
				type = prepare_for_war
				id = ROOT
				value = 1000
			}
			if = {
				limit = { is_in_faction = yes }
				faction_leader = {
					set_variable = { ROOT.ai_strategy_target_@FROM = THIS }
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 1000
					}
				}
			}
			else_if = {
				limit = { is_subject = yes }
				overlord = {
					set_variable = { ROOT.ai_strategy_target_@FROM = THIS }
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = 1000
					}
				}
			}
		}
	}
}

clear_decision_attack_AI = {
	hidden_effect = {
		add_ai_strategy = {
			type = prepare_for_war
			id = FROM
			value = -1000
		}
		FROM = {
			add_ai_strategy = {
				type = prepare_for_war
				id = ROOT
				value = -1000
			}
			if = {
				limit = { has_variable = ROOT.ai_strategy_target_@FROM }
				var:ROOT.ai_strategy_target_@FROM = {
					add_ai_strategy = {
						type = prepare_for_war
						id = ROOT
						value = -1000
					}
				}
				clear_variable = ROOT.ai_strategy_target_@FROM
			}
		}
	}
}

### Fengtian vs Japan
set_JAP_FNG_hostile_AI = {
	if = {
		limit = {
			NOT = { has_country_flag = JAP_FNG_AI_setup }
		}
		set_country_flag = JAP_FNG_AI_setup
		add_ai_strategy = {
			type = dont_defend_ally_borders
			id = "FNG"
			value = 1000
		}
		add_ai_strategy = {
			type = prepare_for_war
			id = "FNG"
			value = 1000
		}
		add_ai_strategy = {
			type = antagonize
			id = "FNG"
			value = 1000
		}
	}
}

clear_JAP_FNG_hostile_AI = {
	if = {
		limit = { has_country_flag = JAP_FNG_AI_setup }
		clr_country_flag = JAP_FNG_AI_setup
		add_ai_strategy = {
			type = dont_defend_ally_borders
			id = "FNG"
			value = -1000
		}
		add_ai_strategy = {
			type = prepare_for_war
			id = "FNG"
			value = -1000
		}
		add_ai_strategy = {
			type = antagonize
			id = "FNG"
			value = -1000
		}
	}
}

