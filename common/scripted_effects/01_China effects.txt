###China Scripted Effects File###
NZH_set_leader_effect = {
	#Northern Zhili
	custom_effect_tooltip = NZH_set_leader_tt
	save_global_event_target_as = NZH_leader
}

SZH_set_leader_effect = {
	#Southern Zhili
	custom_effect_tooltip = SZH_set_leader_tt
	save_global_event_target_as = SZH_leader
}

MCU_set_leader_effect = {
	#Manchu
	custom_effect_tooltip = MCU_set_leader_tt
	save_global_event_target_as = MCU_leader
}

AGJ_set_leader_effect = {
	#Anguojun/Fengtian
	custom_effect_tooltip = AGJ_set_leader_tt
	save_global_event_target_as = AGJ_leader
}

UPC_set_leader_effect = {
	#Federalists
	custom_effect_tooltip = UPC_set_leader_tt
	save_global_event_target_as = UPC_leader

	#Set Up the alliances
	add_to_array = { china_possible_allies_array = SZC }
	add_to_array = { china_possible_allies_array = YUN }
	add_to_array = { china_possible_allies_array = HNN }
	add_to_array = { china_possible_allies_array = GXC }
	add_to_array = { china_possible_allies_array = SHX }
	add_to_array = { china_possible_allies_array_northwest = XSM }
	add_to_array = { china_possible_allies_array_northwest = SIK }

	#This is super annoying because set_power_balance doesnt accept variables for the set_value = <decimal>.
	hidden_effect = {
		if = { #PLACEHOLDER FOR FUTURE DEVELOPERS - Hunan and Sichuan Non-Exiles don't have UPC content thus they should not see or have the power balance
			limit = {
				NOT = {
					tag = HNN
					AND = {
						tag = SZC
						SZC_federalists_in_exile = no
					}
				}
			}
			if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var = 1.0 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 1.0 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = 1.0
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.89 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.9 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = 0.8
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.79 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.8 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = 0.6
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.69 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.7 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = 0.4
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.59 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.6 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = 0.2
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.49 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.5 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = 0.0
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.39 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.4 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = -0.2
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.29 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.3 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = -0.4
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.19 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.2 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = -0.6
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else_if = {
				limit = { check_variable = { global.UPC_democratic_enthusiasm_var > 0.09 } }
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.1 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = -0.8
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
			else = {
				set_variable = { global.UPC_democratic_enthusiasm_var = 0.05 }
				set_power_balance = {
					id = UPC_power_balance
					set_value = -0.9
					left_side = UPC_low_enthusiasm_side
					right_side = UPC_high_enthusiasm_side
				}
			}
		}
	}
}

KMT_kuomintang_enable_alliance_decisions = {
	add_to_array = { china_possible_allies_array = SZC }
	add_to_array = { china_possible_allies_array = YUN }
	add_to_array = { china_possible_allies_array = HNN }
	add_to_array = { china_possible_allies_array = GXC }
	add_to_array = { china_possible_allies_array = SHX }
	add_to_array = { china_possible_allies_array_northwest = XSM }
	add_to_array = { china_possible_allies_array_northwest = SIK }
}

LKT_set_leader_effect = {
	#Left Kuomintang
	custom_effect_tooltip = LKT_set_leader_tt
	save_global_event_target_as = LKT_leader
	KMT_kuomintang_enable_alliance_decisions = yes
}

RKT_set_leader_effect = {
	#Right Kuomintang
	custom_effect_tooltip = RKT_set_leader_tt
	save_global_event_target_as = RKT_leader
	KMT_kuomintang_enable_alliance_decisions = yes
	#This is super annoying because set_power_balance doesnt accept variables for the set_value = <decimal>.
	hidden_effect = {
		if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var = 1.0 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 1.0 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = 1.0
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.89 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.9 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = 0.8
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.79 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.8 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = 0.6
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.69 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.7 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = 0.4
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.59 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.6 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = 0.2
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.49 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.5 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = 0.0
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.39 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.4 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = -0.2
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.29 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.3 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = -0.4
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.19 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.2 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = -0.6
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else_if = {
			limit = { check_variable = { global.RKT_revolutionary_zeal_var > 0.09 } }
			set_variable = { global.RKT_revolutionary_zeal_var = 0.1 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = -0.8
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
		else = {
			set_variable = { global.RKT_revolutionary_zeal_var = 0.05 }
			set_power_balance = {
				id = RKT_power_balance
				set_value = -0.9
				left_side = RKT_low_zeal_side
				right_side = RKT_high_zeal_side
			}
		}
	}
}
RGC_set_leader_effect = {
	#GEACPS
	custom_effect_tooltip = RGC_set_leader_tt
	save_global_event_target_as = RGC_leader
}

set_potential_national_government = {
	#DEV NOTE - MAKE SURE YOU DO NOT USE THIS EFFECT WITHOUT CHECKING IF CHN_no_aligned_unifier_exists_trigger is TRUE FIRST, OTHERWISE WILL DOUBLE UP TAG ALIASES

	if = {
		limit = { NOT = { has_country_flag = china_is_potential_government } }
		set_country_flag = china_is_potential_government

		if = {
			limit = {
				china_alignment_northern_zhili = yes
				NOT = { has_country_leader = { character = SHD_zhang_tianran } } #Zhang Tianran will not be zhili aligned if they are able to make a government
			}
			NZH_set_leader_effect = yes
		}
		else_if = {
			limit = {
				china_alignment_southern_zhili = yes
			}
			SZH_set_leader_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					china_alignment_manchu_qing = yes
					has_country_leader = { character = SHD_zhang_tianran } #This is here to show a player if they make a government as Zhang Tianran they will be the Manchu leader
				}
			}
			MCU_set_leader_effect = yes
		}
		else_if = {
			limit = { china_alignment_fengtian = yes }
			AGJ_set_leader_effect = yes
		}
		else_if = {
			limit = { china_alignment_federalists = yes }
			UPC_set_leader_effect = yes
		}
		else_if = {
			limit = { china_alignment_right_kuomintang = yes }
			RKT_set_leader_effect = yes
		}
		else_if = {
			limit = { china_alignment_left_kuomintang = yes }
			LKT_set_leader_effect = yes
		}

		if = {
			limit = {
				NOT = { tag = NPA } #NPA already has a government name
				#is_subject = yes # For releasing a puppet china - deactivating this back again since we're releasing puppets now as provisional govs
			}
			china_set_government_tag_specific_scripted_effect = yes
		}

		every_state = {
			limit = {
				is_core_china = yes
				NOT = {
					owner = {
						is_subject_of = PREV.PREV
						china_is_governorate = yes
					}
				}
			}
			if = {
				limit = { is_claim_or_core_of_PREV = no }
				add_to_array = { PREV.china_government_claims = THIS }
				add_claim_by = PREV
			}
			if = {
				limit = { NOT = { has_variable = ambition_area_@PREV } }
				add_to_array = { PREV.china_government_ambitions = THIS }
				set_variable = { ambition_area_@PREV = 1 }
			}
		}
		hidden_effect = {
			every_state = {
				limit = {
					is_china_claim_area = yes
					is_claim_or_core_of_PREV = no
					NOT = { has_variable = ambition_area_@PREV }
				}
				add_to_array = { PREV.china_government_ambitions = THIS }
				set_variable = { ambition_area_@PREV = 1 }
			}
			CHI_warn_of_rkmt_government_effect = yes #If its a RKMT leader, effect will fire an event for CHI
			if = {
				limit = {
					OR = {
						tag = GXC
						tag = YUN
						tag = HNN
					}
				}
				activate_targeted_decision = { target = ROOT decision = china_provisional_capital }
			}
		}
	}
}

clear_potential_national_government = {
	hidden_effect = {
		if = {
			limit = { has_country_flag = china_is_potential_government }
			clr_country_flag = china_is_potential_government

			if = {
				limit = { has_cosmetic_tag = KUM_government_zhongying }
				set_cosmetic_tag = KUM_zhongying
			}
			else_if = {
				limit = { has_cosmetic_tag = KUM_government_yaonan }
				set_cosmetic_tag = KUM_xinjiang
			}
			else = {
				drop_cosmetic_tag = yes
			}

			for_each_scope_loop = {
				array = china_government_claims
				remove_claim_by = PREV
			}
			for_each_scope_loop = {
				array = china_government_ambitions
				remove_claim_by = PREV
				clear_variable = ambition_area_@PREV
			}
			clear_array = china_government_claims
			clear_array = china_government_ambitions

			for_each_loop = {
				array = china_possible_allies_array
				remove_targeted_decision = { decision = china_offer_alliance target = var:v }
			}
			clear_array = china_possible_allies_array

			for_each_loop = {
				array = china_possible_allies_array
				remove_targeted_decision = { decision = china_offer_alliance_northwest target = var:v }
			}
			clear_array = china_possible_allies_array_northwest
		}
	}
}

china_add_poor_army = {
	add_ideas = china_poor_army_3_officers
	set_country_flag = china_has_poor_army #enables china_army_reform_ai AI strategy plan
}

transfer_all_unit_leaders_to_FROM = {
	every_unit_leader = {
		limit = { has_character_flag = CHN_original_unit_leader }
		hidden_effect = {
			remove_second_in_command_role = yes
			demote_to_general = yes
			remove_trait = { trait = recently_promoted }
		}
		set_nationality = FROM
	}
}

find_next_chinese_target = {
	get_highest_scored_country = {
		scorer = china_target_scorer
		var = global.china_target_tag
	}
	if = {
		limit = { NOT = { country_exists = CHN } }
		set_variable = { global.china_target_tag = FNG }
	}
	CHN = {
		country_event = china_events.51 #[ROOT.Capital.GetCapitalVictoryPointName]'s Growing Renown
	}
}

#####################################
# LEP Collapse Effects
#####################################

LEP_league_war_find_victor = {
	if = {
		limit = {
			NOT = {
				country_exists = SHD
				country_exists = LEP
				country_exists = CHI
				country_exists = ANQ
			}
		}
		set_variable = { LEP.LEP_league_war_victor = -1 }
	}
	else_if = {
		limit = {
			country_exists = SHD
			NOT = {
				SHD = { has_government = authoritarian_democrat }
				country_exists = LEP
				country_exists = CHI
				country_exists = ANQ
			}
		}
		set_variable = { LEP.LEP_league_war_victor = SHD }
		SHD = {
			country_event = { id = shandong_events.500 days = 2 }
		}
	}
	else_if = {
		limit = {
			country_exists = LEP
			NOT = {
				country_exists = CHI
				country_exists = ANQ
			}
			OR = {
				NOT = { country_exists = SHD }
				SHD = { is_subject = yes }
				has_global_flag = LEP_collapse_SHD_out
			}
		}
		set_variable = { LEP.LEP_league_war_victor = LEP }
		LEP = {
			country_event = { id = league_events.100 days = 2 }
		}
	}
	else_if = {
		limit = {
			country_exists = CHI
			NOT = {
				country_exists = LEP
				country_exists = ANQ
			}
			OR = {
				NOT = { country_exists = SHD }
				has_global_flag = LEP_collapse_SHD_out
			}
		}
		set_variable = { LEP.LEP_league_war_victor = CHI }
		CHI = {
			country_event = { id = CHI.midgame.000 days = 2 }
			country_event = { id = CHI.earlygame.005 days = 100 } #Friends on the Other Side
		}
	}
	else_if = {
		limit = {
			country_exists = ANQ
			NOT = {
				country_exists = LEP
				country_exists = CHI
			}
			OR = {
				NOT = { country_exists = SHD }
				has_global_flag = LEP_collapse_SHD_out
			}
		}
		set_variable = { LEP.LEP_league_war_victor = ANQ }
		ANQ = {
			set_country_flag = ANQ_feng_aid_undecided
			country_event = { id = anqing_events.64 days = 2 }
		}
	}
	if = {
		limit = { has_variable = LEP.LEP_league_war_victor }
		set_global_flag = LEP_league_war_over
		clr_global_flag = LEP_war
		ANQ = {
			LEP_remove_collapse_dm = yes
		}
		SHD = {
			LEP_remove_collapse_dm = yes
		}
		CHI = {
			LEP_remove_collapse_dm = yes
		}
		LEP = {
			LEP_remove_collapse_dm = yes
		}
		if = {
			limit = { has_global_flag = LEP_wuxi_vp_increased }
			clr_global_flag = LEP_wuxi_vp_increased
			add_victory_points = { province = 10076 value = -5 }
		}
		#### Cleanup of LEP war decisions - ANQ
		ANQ = {
			remove_targeted_decision = { target = 606 decision = ANQ_Yangtze_River_Line }
			remove_targeted_decision = { target = 1050 decision = ANQ_Huai_River_Line }
			remove_targeted_decision = { target = 1047 decision = ANQ_Xuzhou_Rail_Line }
			remove_targeted_decision = { target = 1044 decision = ANQ_Nanchang_Rail_Line }
			remove_targeted_decision = { target = 597 decision = ANQ_Jinan_Rail_Line }
			remove_targeted_decision = { target = 1075 decision = ANQ_Nantong_Port_Line }
			remove_targeted_decision = { target = 803 decision = ANQ_Wenzhou_Port_Line }
			remove_targeted_decision = { target = 1066 decision = ANQ_Quanzhou_Port_Line }
			remove_targeted_decision = { target = 596 decision = ANQ_Hangzhou_Port_Line }
		}
	}
}

LEP_add_collapse_dm = {
	randomize_temp_variable = {
		var = days_to_fire_temp
		distribution = uniform
		min = 25
		max = 40
	}
	set_variable = { china_morale_collapse_rate = 0 }
	if = {
		limit = { tag = ANQ }
		if = {
			limit = { QIE = { has_country_flag = wu_intervenes_proANQ } }
			set_variable = { china_league_war_morale = 70 }
		}
		else = {
			set_variable = { china_league_war_morale = 45 }
		}

		add_ideas = league_collapse_ANQ

		set_variable = { LEP_dead_factor = 1 }
	}
	else_if = {
		limit = { tag = SHD }
		set_variable = { china_league_war_morale = 50 }

		add_ideas = league_collapse_SHD

		set_variable = { LEP_dead_factor = 1 }
	}
	else_if = {
		limit = { tag = CHI }
		set_variable = { china_league_war_morale = 90 }

		add_ideas = league_collapse_CHI

		set_variable = { LEP_dead_factor = 1 }
	}
	else_if = {
		limit = { tag = LEP }
		if = {
			limit = { QIE = { has_country_flag = wu_intervenes_proLEP } }
			set_variable = { china_league_war_morale = 65 }
		}
		else = {
			set_variable = { china_league_war_morale = 40 }
		}

		set_variable = { LEP_dead_factor = 1 }

		add_ideas = league_collapse_LEP
		add_ideas = defend_nanjing_LEP
	}
	hidden_effect = {
		china_update_morale = yes
		country_event = { id = league_war.2 days = 34 }
	}
}

LEP_create_militia_template = {
	if = {
		limit = { NOT = { has_template = "League War Militia" } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_create_division_template
				NAME = "League War Militia"
				LINE_1 = { localization_key = line_battalion_tt NAME = irregular_infantry ICON = GFX_unit_irregular_infantry_icon_small COUNT = 5 }
			}
			division_template = {
				name = "League War Militia"
				division_names_group = CHYN_INF_01
				regiments = {
					irregular_infantry = { x = 0 y = 0 }
					irregular_infantry = { x = 0 y = 1 }
					irregular_infantry = { x = 0 y = 2 }
					irregular_infantry = { x = 0 y = 3 }
					irregular_infantry = { x = 1 y = 0 }
				}
			}
		}
	}
}

LEP_remove_collapse_dm = {
	if = {
		limit = { has_idea = league_collapse_ANQ }

		remove_ideas = league_collapse_ANQ
		set_variable = { LEP_dead_factor = 2 }
	}
	else_if = {
		limit = { has_idea = league_collapse_SHD }

		remove_ideas = league_collapse_SHD
		set_variable = { LEP_dead_factor = 2 }
	}
	else_if = {
		limit = { has_idea = league_collapse_CHI }

		remove_ideas = league_collapse_CHI
		set_variable = { LEP_dead_factor = 2 }
	}
	else_if = {
		limit = { has_idea = league_collapse_LEP }

		remove_ideas = league_collapse_LEP
		set_variable = { LEP_dead_factor = 2 }
	}
	if = {
		limit = { has_idea = china_anti_stalemate_idea_2 }
		remove_ideas = china_anti_stalemate_idea_2
	}
	if = {
		limit = { has_idea = defend_nanjing_ANQ }
		remove_ideas = defend_nanjing_ANQ
	}
	else_if = {
		limit = { has_idea = defend_nanjing_CHI }
		remove_ideas = defend_nanjing_CHI
	}
	else_if = {
		limit = { has_idea = defend_nanjing_LEP }
		remove_ideas = defend_nanjing_LEP
	}
	else_if = {
		limit = { has_idea = defend_nanjing_SHD }
		remove_ideas = defend_nanjing_SHD
	}
	if = {
		limit = { has_idea = defend_nanjing_ANQ }
		remove_ideas = defend_nanjing_ANQ
	}
	else_if = {
		limit = { has_idea = defend_nanjing_CHI }
		remove_ideas = defend_nanjing_CHI
	}
	else_if = {
		limit = { has_idea = defend_nanjing_LEP }
		remove_ideas = defend_nanjing_LEP
	}
	else_if = {
		limit = { has_idea = defend_nanjing_SHD }
		remove_ideas = defend_nanjing_SHD
	}
	if = {
		limit = { has_template = "League War Militia" }
		delete_unit_template_and_units = { division_template = "League War Militia" }
	}
	if = {
		limit = { has_template = "Chinese Nationalist Militia" }
		delete_unit_template_and_units = { division_template = "Chinese Nationalist Militia" }
	}
	delete_unit = { id = 1911 }
}

china_update_morale = {
	if = {
		limit = {
			any_enemy_country = {
				has_dynamic_modifier = { modifier = china_morale_dm }
				is_neighbor_of = ROOT
			}
		}
		add_to_variable = { china_league_war_morale = change_league_war_morale_by }
		custom_effect_tooltip = china_morale_will_change_by

		clamp_variable = {
			var = china_league_war_morale
			min = 0
			max = 100
		}
		if = {
			limit = { check_variable = { china_league_war_morale > 60 } }
			set_variable = { china_league_war_flame_frame_var = 3 }
		}
		if = {
			limit = { check_variable = { china_league_war_morale > 30 } }
			set_variable = { china_league_war_flame_frame_var = 2 }
		}
		else = {
			set_variable = { china_league_war_flame_frame_var = 1 }
		}

		# Calculate Political Power Gain
		set_variable = { china_morale_dm_political_power_gain = china_league_war_morale }
		add_to_variable = { china_morale_dm_political_power_gain = -50 }
		multiply_variable = { china_morale_dm_political_power_gain = 0.5 }
		multiply_variable = { china_morale_dm_political_power_gain = 0.01 }

		# Calculate War Support
		set_variable = { china_morale_dm_war_support_factor = china_league_war_morale }
		add_to_variable = { china_morale_dm_war_support_factor = -50 }
		multiply_variable = { china_morale_dm_war_support_factor = 0.3 }
		multiply_variable = { china_morale_dm_war_support_factor = 0.01 }

		# Calculate Surrender Limit
		set_variable = { china_morale_dm_surrender_limit = china_league_war_morale }
		multiply_variable = { china_morale_dm_surrender_limit = 0.4 }
		add_to_variable = { china_morale_dm_surrender_limit = -30 }
		multiply_variable = { china_morale_dm_surrender_limit = 0.01 }

		# Calculate Breakthrough Factor
		set_variable = { china_morale_dm_breakthrough_factor = china_league_war_morale }
		multiply_variable = { china_morale_dm_breakthrough_factor = 0.25 }
		multiply_variable = { china_morale_dm_breakthrough_factor = 0.01 }

		hidden_effect = {
			if = {
				limit = { check_variable = { china_league_war_morale < 30 }}
				activate_mission = china_collapsing_morale
			}
		}
	}
}

#####################################
# China resources decisions setup - initialized on startup
#####################################

china_setup_resources_decisions = {
	hidden_effect = {
		for_each_scope_loop = {
			array = global.china_tags_array
			#### Decisions that are not activated by focus ####
			activate_targeted_decision = { target = 1050 decision = ANQ_develop_huainan_steel_decision }
			activate_targeted_decision = { target = 613 decision = ANQ_develop_nanjing_steel_decision }
			activate_targeted_decision = { target = 597 decision = ANQ_develop_jinan_steel_decision }
			activate_targeted_decision = { target = 602 decision = ANQ_develop_changsa_steel_decision }

			#### The decisions that are also unlocked by focuses and thus are not available by default for some tags ####
			if = {
				limit = { NOT = { tag = FNG tag = MAN } }
				activate_targeted_decision = { target = 716 decision = FNG_Expand_the_Anshan_Mines }
				activate_targeted_decision = { target = 716 decision = MAN_Aluminium_Extraction }
			}
			if = {
				limit = { NOT = { tag = LEP } }
				activate_targeted_decision = { target = 1012 decision = LEP_improved_tungsten_extraction }
			}
			if = {
				limit = { NOT = { tag = LEC } }
				activate_targeted_decision = { target = 609 decision = LEC_to_the_coal_fields }
			}
			if = {
				limit = { NOT = { tag = GXC } }
				activate_targeted_decision = { target = 800 decision = GXC_Fuguo_Coal_Mine }
			}
			if = {
				limit = { NOT = { tag = QIE tag = SZC } }
				activate_targeted_decision = { target = 614 decision = QIE_develop_tangshan_steel_decision }
				activate_targeted_decision = { target = 1060 decision = QIE_develop_zhili_steel_decision }
			}
			if = {
				limit = { NOT = { tag = SHD } }
				activate_targeted_decision = { target = 1044 decision = SHD_develop_jiangxi_tungsten_decision }
				activate_targeted_decision = { target = 1046 decision = SHD_develop_fujian_aluminium_decision }
			}
			if = {
				limit = { NOT = { tag = SHX } }
				activate_targeted_decision = { target = 1072 decision = SHX_expand_coal_mines1_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_expand_coal_mines2_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_improve_metal_refining1_decision }
				activate_targeted_decision = { target = 622 decision = SHX_improve_metal_refining2_decision }
				activate_targeted_decision = { target = 622 decision = SHX_improve_metal_refining3_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_further_resource_extraction1_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_further_resource_extraction2_decision }
			}
			if = {
				limit = { NOT = { tag = SZC } }
				activate_targeted_decision = { target = 661 decision = SZC_Jialing_Coal_Fields }
				activate_targeted_decision = { target = 601 decision = SZC_The_Riches_Of_Xikang }
				activate_targeted_decision = { target = 661 decision = SZC_Extract_Natural_Gas_decision }
				activate_targeted_decision = { target = 650 decision = SZC_Extract_Natural_Gas_decision }
				activate_targeted_decision = { target = 605 decision = SZC_Extract_Natural_Gas_decision }
			}
			if = {
				limit = { NOT = { tag = SIK } }
				activate_targeted_decision = { target = 617 decision = SIK_mineral_expedition }
				activate_targeted_decision = { target = 287 decision = SIK_open_mineral_mining }
				activate_targeted_decision = { target = 618 decision = SIK_northern_gold }
			}
			if = {
				limit = { NOT = { tag = YUN } }
				activate_targeted_decision = { target = 816 decision = YUN_mining1_decision }
				activate_targeted_decision = { target = 325 decision = YUN_mining2_decision }
				activate_targeted_decision = { target = 816 decision = YUN_mining3_decision }
				activate_targeted_decision = { target = 816 decision = YUN_mining4_decision }
			}
		}
	}
}

CHN_hand_over_manchurian_territory_to_TARGET_effect = {
	#Need to set event target for tag_to_release
	every_owned_state = {
		limit = {
			is_manchuria = yes
			is_valid_annexation_state = yes
		}
		transfer_state_and_notify = yes
	}
}

CHN_hand_over_non_LEC_territory_to_TARGET_effect = {
	#Need to set event target for tag_to_release
	if = {
		limit = { 743 = { is_valid_annexation_state = yes } } #Shanghai
		every_owned_state = {
			limit = {
				is_china_proper = yes
				is_possible_legation_cities_state = no
				is_valid_annexation_state = yes
			}
			transfer_state_and_notify = yes
		}
	}
	else = {
		every_owned_state = {
			limit = {
				is_china_proper = yes
				is_valid_annexation_state = yes
			}
			transfer_state_and_notify = yes
		}
	}
}

#CKS Note: Can be deleted now - gonna comment out for now just in case we need it
# GXC is the fallback
#china_puppet_setup = {
#	hidden_effect = { clear_potential_national_government = yes }
#	if = {
#		limit = { tag = CHI }
#		set_cosmetic_tag = LKMT_united_china_cosmetic
#		CHI = {
#			CHI_puppet_setup_effect = yes
#		}
#	}
#	else_if = {
#		limit = { tag = LEP }
#		set_cosmetic_tag = united_china
#		set_politics = {
#			ruling_party = paternal_autocrat
#			elections_allowed = no
#		}
#		set_political_party = {
#			ideology = paternal_autocrat
#			popularity = 20
#		}
#		set_political_party = {
#			ideology = market_liberal
#			popularity = 60
#		}
#		set_temp_variable = { coalition_partner_var = token:market_liberal }
#		add_to_coalition = yes
#		###GEA gets back its AOG bonus if it or GER released it
#		if = {
#			limit = {
#				ROOT = {
#					OR = {
#						tag = GER
#						tag = GEA
#					}
#				}
#			}
#			GEA = { country_event = german_east_asia_events.214 }
#		}
#	}
#	else_if = {
#		limit = { tag = QIE }
#		if = {
#			limit = {
#				ROOT = {
#					OR = {
#						AND = {
#							is_russian_tag = yes
#							is_monarchy = yes
#						}
#						has_country_leader = { character = RUS_pyotr_wrangel }
#						has_country_leader = { character = MON_roman_ungern_sternberg }
#					}
#				}
#			}
#			set_cosmetic_tag = united_china_qing
#			set_politics = {
#				ruling_party = social_conservative
#				elections_allowed = no
#			}
#			set_political_party = {
#				ideology = social_conservative
#				popularity = 60
#			}
#			QIE_aisin_gioro_puyi = {
#				set_nationality = PREV
#				for_each_loop = {
#					array = global.ideology_groups
#					meta_effect = {
#						text = {
#							if = {
#								limit = { has_ideology = [IDEOLOGY] }
#								promote_character = { ideology = [IDEOLOGY] }
#							}
#						}
#						TRAIT = "[?trait_token.GetTokenKey]"
#						IDEOLOGY = "[?v.GetTokenKey]_subtype"
#					}
#				}
#			}
#			QIE_enable_manchu_qing_alignment = yes
#		}
#		else = {
#			set_cosmetic_tag = united_china
#			set_politics = {
#				ruling_party = authoritarian_democrat
#				elections_allowed = no
#			}
#			set_political_party = {
#				ideology = authoritarian_democrat
#				popularity = 60
#			}
#			hidden_effect = {
#				QIE_aisin_gioro_puyi = { retire = yes }
#				if = {
#					limit = { has_character = QIE_gao_lingwei }
#					QIE_gao_lingwei = { promote_character = authoritarian_democrat_subtype }
#				}
#				else = {
#					random_list = {
#						1 = {
#							QIE_wellington_koo = {
#								set_nationality = PREV
#								promote_character = yes
#							}
#						}
#						1 = {
#							QIE_hu_shih = {
#								set_nationality = PREV
#								promote_character = yes
#							}
#						}
#					}
#				}
#			}
#		}
#	}
#	else_if = {
#		limit = { tag = FNG }
#		set_cosmetic_tag = FNG_JAP
#		clear_global_event_target = AGJ_leader
#		save_global_event_target_as = RGC_leader
#		set_global_flag = FNG_projapan
#		if = {
#			limit = { has_character = FNG_zhang_zuolin }
#			retire_character = FNG_zhang_zuolin
#		}
#		if = {
#			limit = { has_character = FNG_zhang_xueliang }
#			retire_character = FNG_zhang_xueliang
#		}
#		if = {
#			limit = { has_character = FNG_wu_junsheng }
#			retire_character = FNG_wu_junsheng
#		}
#		FNG_tang_shaoyi = {
#			if = {
#				limit = { has_ideology = paternal_autocrat_subtype }
#				promote_character = paternal_autocrat_subtype
#			}
#			else = {
#				add_country_leader_role = {
#					country_leader = {
#						desc = FNG_tang_shaoyi_leader_desc
#						ideology = paternal_autocrat_subtype
#						traits = { CHN_geacps_aligned FNG_unwilling_participant }
#					}
#					promote_leader = yes
#				}
#			}
#		}
#		set_party_name = {
#			ideology = paternal_autocrat
#			name = FNG_new_peoples_society
#			long_name = FNG_new_peoples_society_tt
#		}
#		set_politics = {
#			ruling_party = paternal_autocrat
#			elections_allowed = no
#		}
#		add_popularity = {
#			ideology = paternal_autocrat
#			popularity = 0.2
#		}
#		add_popularity = {
#			ideology = social_conservative
#			popularity = 0.2
#		}
#		add_popularity = {
#			ideology = authoritarian_democrat
#			popularity = 0.2
#		}
#		activate_advisor = FNG_wang_yitang_sic
#		set_temp_variable = { coalition_partner_var = token:authoritarian_democrat }
#		add_to_coalition = yes
#		set_temp_variable = { coalition_partner_var = token:social_conservative }
#		add_to_coalition = yes
#		hidden_effect = {
#			set_party_name = {
#				ideology = paternal_autocrat
#				name = FNG_new_peoples_society
#				long_name = FNG_new_peoples_society_long
#			}
#			set_popularities = {
#				totalist = 1
#				radical_socialist = 5
#				syndicalist = 1
#				social_democrat = 5
#				social_liberal = 8
#				market_liberal = 10
#				social_conservative = 20
#				authoritarian_democrat = 20
#				paternal_autocrat = 20
#				national_populist = 10
#			}
#			set_party_name = {
#				ideology = social_liberal
#				long_name = CHN_republicans_party_long
#				name = CHN_republicans_party
#			}
#			set_party_name = {
#				ideology = social_democrat
#				long_name = CHN_FCDP_party_long
#				name = CHN_FCDP_party
#			}
#			set_party_name = {
#				ideology = market_liberal
#				long_name = CHN_CCP_party_long
#				name = CHN_CCP_party
#			}
#			promote_character = {
#				character = FNG_assorted_leaders
#				ideology = social_democrat_subtype
#			}
#			promote_character = {
#				character = FNG_assorted_leaders
#				ideology = market_liberal_subtype
#			}
#			remove_ideas = {
#				FNG_Disastrous_Governance
#				FNG_Plutocratic_Exploitation
#				FNG_Expel_the_Japanese_Bandits
#			}
#			add_ideas = {
#				FNG_an_army_of_traitors
#				FNG_hollowed_out_economy
#				FNG_collaboration_the_great_evil
#			}
#			# FNG_grand_marshals_favor_category
#			remove_targeted_decision = { target = THIS decision = FNG_favor_shikan_clique }
#			remove_targeted_decision = { target = THIS decision = FNG_favor_communications_clique }
#			remove_targeted_decision = { target = THIS decision = FNG_favor_recovery_league }
#			remove_targeted_decision = { target = THIS decision = FNG_favor_zhang_clique }
#			# FNG_fixing_the_economy_category
#			remove_targeted_decision = { target = THIS decision = FNG_Centralise_the_Banks }
#			remove_targeted_decision = { target = THIS decision = FNG_Re_Introduce_the_Fengtian_Dollar }
#			remove_targeted_decision = { target = THIS decision = FNG_Fill_the_Silver_Reserve }
#			remove_targeted_decision = { target = THIS decision = FNG_Encourage_Japanese_Investment }
#			remove_targeted_decision = { target = THIS decision = FNG_Encourage_Chinese_Investment }
#			# china_army_decisions
#			remove_targeted_decision = { target = THIS decision = FNG_Revise_our_Position_on_Looting }
#			remove_targeted_decision = { target = THIS decision = FNG_Rebuild_the_Second_Army }
#			remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Dezhou }
#			remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Kaifeng }
#			remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Ruyang }
#			remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Guanzhong }
#			remove_targeted_decision = { target = THIS decision = FNG_Raise_the_Baoding_Cadet_Corps }
#			# FNG_Preparing_For_The_Princes_Visit
#			remove_targeted_decision = { target = THIS decision = FNG_increase_security_in_shenyang }
#			remove_targeted_decision = { target = THIS decision = FNG_investigate_the_junior_officer_corps }
#			remove_targeted_decision = { target = THIS decision = FNG_reinforce_soldierly_discipline }
#			remove_targeted_decision = { target = THIS decision = FNG_present_chinese_modernity }
#			remove_targeted_decision = { target = THIS decision = FNG_Fortress_Manchuria }
#			# FNG_railways
#			remove_targeted_decision = { target = THIS decision = FNG_The_Jinhan_Railway }
#			remove_targeted_decision = { target = THIS decision = FNG_The_Jinpu_Railway }
#			remove_targeted_decision = { target = THIS decision = FNG_The_Yuehan_Railway }
#			remove_targeted_decision = { target = THIS decision = FNG_Railway_Construction_Jilin_Shenyang }
#			remove_targeted_decision = { target = THIS decision = FNG_Railway_Construction_Pingqi }
#			remove_targeted_decision = { target = THIS decision = FNG_Railway_Construction_Shenyang_Chengde }
#			# FNG_foreign_policy
#			remove_targeted_decision = { target = QIE decision = FNG_Denounce_Qing_Monarchism }
#			remove_targeted_decision = { target = GER decision = FNG_Denounce_German_Imperialism }
#			remove_targeted_decision = { target = THIS decision = FNG_National_Irredentism }
#			remove_targeted_decision = { target = THIS decision = FNG_Wu_Wang_Zai_Ju }
#			remove_targeted_decision = { target = THIS decision = FNG_Escalate_the_Propaganda_War }
#			remove_targeted_decision = { target = THIS decision = FNG_The_Yanshan_Plan }
#			remove_targeted_decision = { target = THIS decision = FNG_Shanhaiguan_Infiltration }
#			remove_targeted_decision = { target = SHD decision = FNG_Annex_Shandong_Anqing_Puppet }
#			# FNG_Commission_Japanese_Ships
#			remove_targeted_decision = { target = JAP decision = FNG_JAP_destroyers }
#			remove_targeted_decision = { target = JAP decision = FNG_JAP_subs }
#			remove_targeted_decision = { target = JAP decision = FNG_JAP_cruisers }
#			remove_targeted_decision = { target = JAP decision = FNG_JAP_convoys }
#		}
#	}
#	#PLACEHOLDER - Should release RKMT d4b6486
#	#PLACEHOLDER release UPC 57e0a1e
#	hidden_effect = { set_potential_national_government = yes }
#}

china_integrate_ally_effect = {
	hidden_effect = {
		if = {
			limit = { FROM = { tag = CHI } }
			CHI_recruit_all_generals_from_THIS = yes
		}
	}
	transfer_all_unit_leaders_to_FROM = yes
	every_subject_country = {
		get_current_government_type = yes
		FROM = {
			set_autonomy = {
				target = PREV
				autonomy_state = integrated_puppet
				end_wars = no
			}
		}
		restore_previous_government_type = yes
	}
	every_owned_state = {
		limit = {
			is_core_china = yes
			is_claim_or_core_of_FROM = no
		}
		add_claim_by = FROM
	}
	FROM = {
		annex_country = {
			target = ROOT
			transfer_troops = yes
		}
	}
	if = {
		limit = { is_ai = no }
		FROM = { change_tag_from = ROOT }
	}
}

china_integrate_TARGET_effect = {
	set_temp_variable = { integrator = THIS }
	event_target:target = {
		hidden_effect = {
			if = {
				limit = { var:integrator = { tag = CHI } }
				CHI_recruit_all_generals_from_THIS = yes
			}
		}
		every_unit_leader = {
			limit = { has_character_flag = CHN_original_unit_leader }
			hidden_effect = {
				remove_second_in_command_role = yes
				demote_to_general = yes
				remove_trait = { trait = recently_promoted }
			}
			set_nationality = var:integrator
		}
		every_subject_country = {
			custom_effect_tooltip = tooltip_white_line
			get_current_government_type = yes
			var:integrator = {
				puppet = {
					target = PREV
					end_wars = no
					end_civil_wars = no
				}
			}
			restore_previous_government_type = yes
		}
		custom_effect_tooltip = tooltip_white_line
		if = {
			limit = { any_core_state = { has_variable = can_integrate_@var:integrator } }
			every_core_state = {
				limit = {
					has_variable = can_integrate_@var:integrator
					NOT = { is_core_of = var:integrator }
				}
				hidden_effect = { remove_claim_by = var:integrator }
				add_core_of = var:integrator
			}
			every_core_state = {
				limit = {
					is_china_claim_area = yes
					NOT = { is_core_of = var:integrator }
					NOT = { has_variable = can_integrate_@var:integrator }
				}
				add_claim_by = var:integrator
			}
			hidden_effect = { clear_cores_of_tag_if_possible = yes }
		}
		else = {
			every_core_state = {
				limit = {
					is_china_claim_area = yes
					NOT = { is_core_of = var:integrator }
				}
				add_claim_by = var:integrator
			}
		}
	}
	custom_effect_tooltip = tooltip_white_line
	annex_country = {
		target = event_target:target
		transfer_troops = yes
	}
	if = {
		limit = { event_target:target = { is_ai = no } }
		change_tag_from = event_target:target
	}
}

## Lategame Civil War Effects
CHN_add_to_civil_war_preparation_effect = {
	if = {
		limit = { is_chinese_or_potential_chinese_tag = yes }
		if = {
			limit = { CHN_has_civil_war_prep_trigger = yes }
			add_to_variable = {
				var = CHN_civil_war_preparation_var
				value = 1
				tooltip = CHN_add_to_civil_war_preparation_tt
			}
		}
		else = {
			add_to_variable = {
				var = CHN_civil_war_preparation_var
				value = 1
				tooltip = CHN_begin_civil_war_preparation_tt
			}
			ROOT.overlord = {
				country_event = { id = china_events.62 days = 3 }
			}
		}
		#The formula should be 1 via generic decision + 1 via overlord's event chain + 2 via satellite content. 5 and up should be due to unplanend stuff.
	}
}

CHN_add_revolt_preparation_effect = {
	set_variable = { global.CHN_revolt_target = former_overlord }
	if = {
		limit = { check_variable = { CHN_civil_war_preparation_var > 4 } }
		effect_tooltip = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea_fake days = 720 }
		}
		hidden_effect = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea days = 720 }
		}
	}
	else_if = {
		limit = { check_variable = { CHN_civil_war_preparation_var > 3 } }
		effect_tooltip = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea_fake days = 360 }
		}
		hidden_effect = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea days = 360 }
		}
	}
	else_if = {
		limit = { check_variable = { CHN_civil_war_preparation_var > 2 } }
		effect_tooltip = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea_fake days = 270 }
		}
		hidden_effect = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea days = 270 }
		}
	}
	else_if = {
		limit = { check_variable = { CHN_civil_war_preparation_var > 1 } }
		effect_tooltip = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea_fake days = 180 }
		}
		hidden_effect = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea days = 180 }
		}
	}
	else_if = {
		limit = { check_variable = { CHN_civil_war_preparation_var > 0 } }
		effect_tooltip = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea_fake days = 90 }
		}
		hidden_effect = {
			add_timed_idea = { idea = CHN_revolt_against_bonus_idea days = 90 }
		}
	}
}

china_kmt_set_cosmetic_effect = {
	if = {
		limit = {
			var:new_overlord = {
				OR = {
					china_alignment_left_kuomintang = yes
					china_alignment_right_kuomintang = yes
				}
			}
		}
		#In Alphabetical Order for ease of search
		if = {
			limit = {
				original_tag = GXC
				has_cosmetic_tag = GXC_SCPC_NPA
			}
			set_cosmetic_tag = GXC_SCPC_KMT
		}
		else_if = {
			limit = {
				original_tag = SHX
				has_cosmetic_tag = SHX_NCPC
			}
			set_cosmetic_tag = SHX_NCPC_KMT
		}
		else_if = {
			limit = {
				original_tag = YUN
				has_cosmetic_tag = YUN_SCPC_UPC
			}
			set_cosmetic_tag = YUN_SCPC_KMT
		}
		else = {
			# GXC_KMT, HNN_KMT, KUM_KMT, SHX_KMT, SIK_KMT, SZC_KMT, XSM_KMT, YUN_KMT
			meta_effect = {
				text = {
					set_cosmetic_tag = [CURRENT_TAG]_KMT
				}
				CURRENT_TAG = "[THIS.GetTag]"
			}
		}
	}
}

china_submission_mandatory_loyalty_timer_effect = {
	set_country_flag = {
		flag = china_submission_mandatory_loyalty_timer_flag
		days = 365
		value = 1 #Has to be 1 or else will break
	}
}

SHX_log_puppet_outcome_effect = {
	if = {
		limit = {
			FROM = {
				tag = SHX
				NOT = { has_country_flag = SHX_game_progression_recorded_flag }
			}
		}
		if = {
			limit = {
				has_country_leader = { character = SHX_yan_xishan ruling_only = yes }
				has_country_flag = SHX_renewed_alliance_outcome_flag
			}
			if = {
				limit = { var:new_overlord = { tag = QIE } }
				log = "KR_Event_Logging;SHX Game Progression - Yan Xishan, Renewed Alliance, Subjected by QIE"
				set_country_flag = SHX_game_progression_recorded_flag
			}
			else = {
				log = "KR_Event_Logging;SHX Game Progression - Yan Xishan, Renewed Alliance, Subjected by Others"
				set_country_flag = SHX_game_progression_recorded_flag
			}
		}
		else_if = {
			limit = {
				has_country_leader = { character = SHX_yan_xishan ruling_only = yes }
				NOT = { has_country_flag = SHX_renewed_alliance_outcome_flag }
			}
			if = {
				limit = { var:new_overlord = { tag = QIE } }
				log = "KR_Event_Logging;SHX Game Progression - Yan Xishan, Standard Path, Subjected by QIE"
				set_country_flag = SHX_game_progression_recorded_flag
			}
			else = {
				log = "KR_Event_Logging;SHX Game Progression - Yan Xishan, Standard Path, Subjected by Others"
				set_country_flag = SHX_game_progression_recorded_flag
			}
		}
		else_if = {
			limit = {
				has_country_leader = { character = SHX_feng_yuxiang ruling_only = yes }
				has_country_flag = SHX_feng_manchu_coup_outcome_flag
			}
			log = "KR_Event_Logging;SHX Game Progression - Feng Yuxiang, Manchu Coup, Subjected by Others"
			set_country_flag = SHX_game_progression_recorded_flag
		}
		else_if = {
			limit = {
				has_country_leader = { character = SHX_feng_yuxiang ruling_only = yes }
				NOT = { has_country_flag = SHX_feng_manchu_coup_outcome_flag }
			}
			log = "KR_Event_Logging;SHX Game Progression - Feng Yuxiang, Standard Path, Subjected by Others"
			set_country_flag = SHX_game_progression_recorded_flag
		}
	}
}

china_puppet_ROOT_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		ROOT = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
				SHX_log_puppet_outcome_effect = yes
				china_submission_mandatory_loyalty_timer_effect = yes
			}
		}
	}
	set_autonomy = {
		target = ROOT
		autonomy_state = associated_governorate
		end_wars = no
	}
	hidden_effect = {
		if = {
			limit = { has_wargoal_against = ROOT }
			remove_wargoal = { target = ROOT type = all }
		}
		ROOT = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = {
					is_core_china = no
				}
				remove_claim_by = PREV
			}
			if = {
				limit = { has_wargoal_against = PREV }
				remove_wargoal = { target = PREV type = all }
			}
			china_kmt_set_cosmetic_effect = yes
			SHX_log_puppet_outcome_effect = yes
			china_submission_mandatory_loyalty_timer_effect = yes
		}

		#Sets up Satellite Content
		if = {
			limit = {
				var:new_overlord = { tag = CHI }
				ROOT = {
					tag = GXC
					china_is_aligned_with_right_kmt = yes
				}
				#Rig it so Chen Mingshu will win the Clash for Canton if you have the game rules up.
				OR = {
					has_game_rule = { rule = GXC_KMT_path option = GXC_KMT_PATH_RADSOC }
					has_game_rule = { rule = GXC_KMT_path option = GXC_KMT_PATH_RADSOC }
					has_game_rule = { rule = GXC_KMT_path option = GXC_KMT_PATH_SOCDEM }
				}
			}
			ROOT = { country_event = GXC.earlygame.462 } #New Fourth Army Coup
		}
		else_if = {
			limit = {
				var:new_overlord = { tag = CHI }
				ROOT = {
					tag = GXC
					china_is_aligned_with_right_kmt = yes
				}
			}
			ROOT = { country_event = { id = GXC.midgame.560 days = 1 } } #A Change in Partners
			var:new_overlord = { country_event = { id = GXC.midgame.560 days = 3 } } #A Change in Partners
		}
		else_if = {
			limit = {
				ROOT = {
					tag = GXC
					china_is_unaligned = yes
				}
			}
			ROOT = { country_event = { id = GXC.midgame.860 days = 1 } } #The South Submits to $Overlord$
		}
		else_if = {
			limit = {
				ROOT = {
					tag = YUN
					china_is_aligned_with_kmt = yes
				}
			}
			ROOT = { country_event = { id = YUN.midgame.500 days = 1 } } #Zhu Peide Purges Long Yun
		}
		else_if = {
			limit = {
				ROOT = {
					tag = YUN
					china_is_aligned_with_federalists = yes
				}
			}
			ROOT = { country_event = { id = YUN.midgame.300 days = 1 } } #The Southern Confederation
		}
	}
}

china_puppet_PREV_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		PREV = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
				SHX_log_puppet_outcome_effect = yes
				china_submission_mandatory_loyalty_timer_effect = yes
			}
		}
	}
	set_autonomy = {
		target = PREV
		autonomy_state = associated_governorate
		end_wars = no
	}
	hidden_effect = {
		if = {
			limit = { has_wargoal_against = PREV }
			remove_wargoal = { target = PREV type = all }
		}
		PREV = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
			if = {
				limit = { has_wargoal_against = PREV }
				remove_wargoal = { target = PREV type = all }
			}
			china_kmt_set_cosmetic_effect = yes
			SHX_log_puppet_outcome_effect = yes
			china_submission_mandatory_loyalty_timer_effect = yes
		}
		#Set Up Satellite Content
		if = {
			limit = {
				var:new_overlord = { tag = CHI }
				PREV = {
					tag = GXC
					china_is_aligned_with_right_kmt = yes
				}
			}
			PREV = { country_event = { id = GXC.midgame.560 days = 1 } } #A Change in Partners
			var:new_overlord = { country_event = { id = GXC.midgame.560 days = 3 } } #A Change in Partners
		}
		else_if = {
			limit = {
				PREV = {
					tag = GXC
					china_is_unaligned = yes
				}
			}
			PREV = { country_event = { id = GXC.midgame.860 days = 1 } } #The South Submits to $Overlord$
		}
		else_if = {
			limit = {
				PREV = {
					tag = YUN
					china_is_aligned_with_kmt = yes
				}
			}
			PREV = { country_event = { id = YUN.midgame.500 days = 1 } } #Zhu Peide Purges Long Yun
		}
		else_if = {
			limit = {
				PREV = {
					tag = YUN
					china_is_aligned_with_federalists = yes
				}
			}
			PREV = { country_event = { id = YUN.midgame.300 days = 1 } } #The Southern Confederation
		}
	}
}

china_puppet_FROM_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		FROM = {
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
				SHX_log_puppet_outcome_effect = yes
				china_submission_mandatory_loyalty_timer_effect = yes
			}
			get_current_government_type = yes
		}
	}
	set_autonomy = {
		target = FROM
		autonomy_state = associated_governorate
		end_wars = no
	}
	hidden_effect = {
		FROM = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
			china_kmt_set_cosmetic_effect = yes
			SHX_log_puppet_outcome_effect = yes
			china_submission_mandatory_loyalty_timer_effect = yes
		}
		#Set Up Satellite Content
		if = {
			limit = {
				var:new_overlord = { tag = CHI }
				FROM = {
					tag = GXC
					china_is_aligned_with_right_kmt = yes
				}
			}
			FROM = { country_event = { id = GXC.midgame.560 days = 1 } } #A Change in Partners
			var:new_overlord = { country_event = { id = GXC.midgame.560 days = 3 } } #A Change in Partners
		}
		else_if = {
			limit = {
				FROM = {
					tag = GXC
					china_is_unaligned = yes
				}
			}
			FROM = { country_event = { id = GXC.midgame.860 days = 1 } } #The South Submits to $Overlord$
		}
		else_if = {
			limit = {
				FROM = {
					tag = YUN
					china_is_aligned_with_kmt = yes
				}
			}
			FROM = { country_event = { id = YUN.midgame.500 days = 1 } } #Zhu Peide Purges Long Yun
		}
		else_if = {
			limit = {
				FROM = {
					tag = YUN
					china_is_aligned_with_federalists = yes
				}
			}
			FROM = { country_event = { id = YUN.midgame.300 days = 1 } } #The Southern Confederation
		}
	}
}

china_puppet_TARGET_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		var:target = {
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
				SHX_log_puppet_outcome_effect = yes
				china_submission_mandatory_loyalty_timer_effect = yes
			}
			get_current_government_type = yes
		}
	}
	hidden_effect = { var:target = { get_current_government_type = yes } }
	set_autonomy = {
		target = var:target
		autonomy_state = associated_governorate
		end_wars = no
	}
	hidden_effect = {
		var:target = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
			china_kmt_set_cosmetic_effect = yes
			SHX_log_puppet_outcome_effect = yes
			china_submission_mandatory_loyalty_timer_effect = yes
		}
		#Set Up Satellite Content
		if = {
			limit = {
				var:new_overlord = { tag = CHI }
				var:target = {
					tag = GXC
					china_is_aligned_with_right_kmt = yes
				}
			}
			var:target = { country_event = { id = GXC.midgame.560 days = 1 } } #A Change in Partners
			var:new_overlord = { country_event = { id = GXC.midgame.560 days = 3 } } #A Change in Partners
		}
		else_if = {
			limit = {
				var:target = {
					tag = GXC
					china_is_unaligned = yes
				}
			}
			var:target = { country_event = { id = GXC.midgame.860 days = 1 } } #The South Submits to $Overlord$
		}
		else_if = {
			limit = {
				var:target = {
					tag = YUN
					china_is_aligned_with_kmt = yes
				}
			}
			var:target = { country_event = { id = YUN.midgame.500 days = 1 } } #Zhu Peide Purges Long Yun
		}
		else_if = {
			limit = {
				var:target = {
					tag = YUN
					china_is_aligned_with_federalists = yes
				}
			}
			var:target = { country_event = { id = YUN.midgame.300 days = 1 } } #The Southern Confederation
		}
	}
}

china_break_puppet_effect = {
	if = {
		limit = { china_is_governorate = yes }
		leave_faction = yes
		overlord = {
			set_temp_variable = { former_overlord = THIS }
			set_autonomy = {
				target = PREV
				autonomy_state = autonomy_free
			}
		}
		set_country_flag = { flag = CHN_has_revolted_flag days = 90 value = 1 }
		CHN_add_revolt_preparation_effect = yes
		peace_out_non_neighbours_after_leaving_faction = yes
		every_owned_state = {
			limit = {
				is_core_china = yes
				NOT = { is_core_of = var:former_overlord }
			}
			add_claim_by = var:former_overlord
		}
		if = {
			limit = { has_cosmetic_tag = SHX_NCPC_KMT }
			set_cosmetic_tag = SHX_NCPC
		}
		else_if = {
			limit = {
				# GXC_KMT, HNN_KMT, KUM_KMT, SHX_KMT, SIK_KMT, SZC_KMT, XSM_KMT, YUN_KMT
				meta_trigger = {
					text = {
						has_cosmetic_tag = [CURRENT_TAG]_KMT
					}
					CURRENT_TAG = "[THIS.GetTag]"
				}
				NOT = {
					china_alignment_right_kuomintang = yes
					china_alignment_left_kuomintang = yes
				}
			}
			drop_cosmetic_tag = yes
		}
	}
}

china_set_government_tag_specific_scripted_effect = {
	#Do Government Alignment Flags First
	if = {
		limit = { china_alignment_left_kuomintang = yes }
		if = {
			limit = {
				OR = {
					original_tag = CHI #Wang Jingwei
					owns_state = 613 #Nanjing
				}
			}
			set_capital = { state = 613 remember_old_capital = no } #Nanjing
			set_cosmetic_tag = LKT_government_nanjing_cosmetic #Nanjing Nationalist Government
			if = {
				limit = {
					original_tag = CHI
				}
				set_country_flag = CHI_phase_two_begins_flag
				if = {
					limit = {
						NOT = { has_completed_focus = CHI_first_congress_focus }
					}
					complete_national_focus = CHI_first_congress_focus
				}
			}
		}
		else_if = {
			limit = {
				OR = {
					original_tag = GXC #Chen Minghsu
					owns_state = 592 #Guangzhou
				}
			}
			set_capital = { state = 592 remember_old_capital = no } #Guangzhou
			set_cosmetic_tag = LKT_government_guangzhou_cosmetic #Guangzhou Nationalist Government
		}
		else_if = {
			limit = {
				original_tag = HNN #Tang Shengzhi
			}
			set_cosmetic_tag = LKT_government_changsha_cosmetic #Changsha Nationalist Government
		}
		else_if = {
			limit = {
				original_tag = YUN #Zhu De
			}
			set_cosmetic_tag = LKT_government_kunming_cosmetic #Kunming Nationalist Government
		}
	}
	else_if = {
		limit = { china_alignment_right_kuomintang = yes }
		set_cosmetic_tag = RKT_government_cosmetic #Guangzhou Nationalist Government
	}
	else_if = {
		limit = { china_alignment_federalists = yes }
		if = {
			limit = {
				tag = GXC #Chen Jiongming
			}
			set_cosmetic_tag = UPC_government_cosmetic #Guangzhou Federalist Government
		}
		else_if = {
			limit = {
				original_tag = SZC #Chen Jiongming in Exile and Xiong Kewu
			}
			if = {
				limit = {
					NOT = { capital_scope = { state = 650 } } #Chongqing
				}
				set_capital = { state = 650 remember_old_capital = no } #Chongqing
			}
			set_cosmetic_tag = UPC_government_exile_cosmetic #Chongqing Federalist Government
		}
		else_if = {
			limit = {
				original_tag = YUN #Tang Jiyao
			}
			if = {
				limit = { #Guangzhou (For if Tang Jiyao conquers Guangzhou)
					owns_state = 592
					controls_state = 592
				}
				add_state_core = 592 #Guangzhou
				set_capital = { state = 592 remember_old_capital = no } #Guangzhou
				set_cosmetic_tag = UPC_government_cosmetic #Guangzhou Federalist Government
			}
			else = {
				set_cosmetic_tag = UPC_government_kunming_cosmetic #Kunming Federalist Government
			}
		}
		else_if = {
			limit = {
				original_tag = HNN #Zhao Hengti
			}
			if = {
				limit = { #Guangzhou (For if Zhao Hengti conquers Guangzhou)
					owns_state = 592
					controls_state = 592
				}
				add_state_core = 592 #Guangzhou
				set_capital = { state = 592 remember_old_capital = no } #Guangzhou
				set_cosmetic_tag = UPC_government_cosmetic #Guangzhou Federalist Government
			}
			else = {
				set_cosmetic_tag = UPC_government_changsha_cosmetic #Changsha Federalist Government
			}
		}
		else = {
			set_cosmetic_tag = UPC_government_cosmetic #Guangzhou Federalist Government (Fallback just to be safe)
		}
	}
	else_if = {
		limit = {
			china_alignment_northern_zhili = yes
			NOT = { original_tag = QIE } #QIE already is a government at the start and doesn't need a cosmetic
			NOT = { has_country_leader = { character = SHD_zhang_tianran } } #Zhang Tianran will not be zhili aligned if independent
		}
		if = {
			limit = {
				original_tag = SZC #Zhili Exile, Yang Sen, and Liu Cunhou
			}
			set_cosmetic_tag = ZHL_government_exile_cosmetic #Chengdu Provisional Government
		}
		else_if = {
			limit = {
				original_tag = ANQ #Chen Tiaoyuan
			}
			set_capital = { state = 613 remember_old_capital = no } #Nanjing
			set_cosmetic_tag = ZHL_government_nanjing_cosmetic #Nanjing Provisional Government
		}
		else_if = {
			limit = {
				original_tag = HNN #Tang Xiangming
			}
			if = {
				limit = { #Guangzhou (For if Hunan conquers Guangzhou)
					owns_state = 592
					controls_state = 592
				}
				add_state_core = 592 #Guangzhou
				set_capital = { state = 592 remember_old_capital = no } #Guangzhou
				set_cosmetic_tag = ZHL_government_guangzhou_cosmetic #Guangzhou Provisional Government
			}
			else = {
				set_cosmetic_tag = ZHL_government_changsha_cosmetic #Changsha Provisional Government
			}
		}
		else_if = {
			limit = {
				original_tag = SHD #Qu Yingguang (He starts as northern zhili aligned and stays that way if the Manchu Coup fails and he's not the coup backer)
			}
			set_cosmetic_tag = ZHL_government_jinan_cosmetic #Jinan Provisional Government
		}
		#else_if = {
		#	limit = {
		#		original_tag = XSM #Ma Hongkui
		#	}
		#	set_cosmetic_tag = ZHL_government_lanzhou_cosmetic #Lanzhou Provisional Government
		#}
		#else_if = {
		#	limit = {
		#		original_tag = KUM #Fan Yaonan
		#	}
		#	set_cosmetic_tag = ZHL_government_dihua_cosmetic #Dihua Provisional Government
		#}
		else = {
			set_cosmetic_tag = ZHL_government_guangzhou_cosmetic #Guangzhou Provisional Government, fallback just in case
		}
	}
	else_if = {
		limit = {
			china_alignment_southern_zhili = yes
		}
		if = {
			limit = {
				original_tag = LEP #Qi Xieyuan
			}
			set_cosmetic_tag = SZH_government_nanjing_cosmetic #Nanjing Provisional Government (Southern Zhili)
		}
		else_if = {
			limit = {
				original_tag = YUN #Hu Ruoyu
			}
			if = {
				limit = { #Guangzhou (For if Hu Ruoyu conquers Guangzhou)
					owns_state = 592
					controls_state = 592
				}
				add_state_core = 592 #Guangzhou
				set_capital = { state = 592 remember_old_capital = no } #Guangzhou
				set_cosmetic_tag = SZH_government_guangzhou_cosmetic #Guangzhou Provisional Government
			}
			else = {
				set_cosmetic_tag = SZH_government_kunming_cosmetic #Kunming Provisional Government
			}
		}
		else = { #Fallback
			set_cosmetic_tag = SZH_government_nanning_cosmetic #Nanning Provisional Government (Southern Zhili)
		}
	}
	else_if = {
		limit = {
			china_alignment_fengtian = yes
			NOT = { original_tag = FNG } #FNG already is a government at the start and doesn't need a cosmetic
		}
		if = {
			limit = {
				OR = {
					original_tag = SHD #Zhang Zongchang
					original_tag = ANQ #Chen Tiaoyuan
				}
			}
			set_cosmetic_tag = AGJ_government_NPG_cosmetic #National Pacification Government
		}
		else = { #Chen Lianbo, also doubles as a fallback just in case
			set_cosmetic_tag = AGJ_government_guangzhou_cosmetic #Guangzhou Provisional Government
		}
	}
	#After Government alignments are done, do non aligned and chinese_southern_republican alignment tags and other special cases
	else_if = { #Chen Tiaoyuan can go non aligned if Anqing breaks with Fengtian
		limit = { original_tag = ANQ }
		set_capital = { state = 613 remember_old_capital = no }
		set_cosmetic_tag = ANQ_government_nanjing
	}
	else_if = { #Lu Yuguang
		limit = { tag = GXC }
		save_global_event_target_as = npa_leader
		set_cosmetic_tag = national_protection_alliance
	}
	else_if = { #Long Yun, Hu Ruoyu (when rebel), and Lu Han
		limit = { tag = YUN }
		save_global_event_target_as = npa_leader
		set_cosmetic_tag = national_protection_alliance
	}
	else_if = { #Ma Zhonying and Fan Yaonan
		limit = { original_tag = KUM }
		if = {
			limit = {
				has_country_leader = { character = XSM_ma_zhongying }
			}
			set_cosmetic_tag = KUM_government_zhongying
		}
		else_if = {
			limit = {
				has_country_leader = { character = SIK_fan_yaonan }
			}
			set_cosmetic_tag = KUM_government_yaonan
		}
	}
	else_if = { #Yan Xishan and Feng Yuxiang
		limit = { original_tag = SHX }
		set_cosmetic_tag = SHX_zhongyuan_gov
	}
	else_if = { #Jin Shuren and Ma Shaowu
		limit = { original_tag = SIK }
		set_cosmetic_tag = SIK_government
	}
	else_if = { #Zhang Tianran (always will be Manchu Qing aligned if he can make a government), Qu Yingguang (can go Manchu Qing aligned), Zhang Zongchang (can go non aligned)
		limit = { original_tag = SHD }
		if = {
			limit = { has_country_leader = { character = SHD_zhang_tianran } }
			add_state_core = 608
			set_capital = { state = 608 remember_old_capital = no }
			set_cosmetic_tag = QIE_government_manchu
			QIE = {
				QIE_aisin_gioro_puyi = {
					hidden_effect = {
						set_nationality = ROOT
						remove_all_country_leader_roles = yes
					}
					set_portraits = {
						character = QIE_aisin_gioro_puyi
						civilian = { large = GFX_portrait_QIE_aisin_gioro_puyi_civilian_large_uniform }
					}
					add_country_leader_role = {
						country_leader = {
							desc = QIE_aisin_gioro_puyi_leader_desc
							ideology = national_populist_subtype
							traits = { CHN_restorationist_aligned SHD_imprisoned_emperor }
						}
						promote_leader = yes
					}
				}
			}
			SHD_zhang_tianran = {
				hidden_effect = { remove_second_in_command_role = yes }
				add_advisor_role = {
					advisor = {
						slot = second_in_command
						idea_token = SHD_zhang_tianran_sic
						desc = SHD_zhang_tianran_leader_desc
						traits = { QIE_chief_executive_bideyuan }
						cost = 0
						can_be_fired = no
					}
					activate = yes
				}
			}
		}
		else_if = {
			limit = {
				has_country_leader = { character = SHD_qu_yingguang }
				china_is_aligned_with_manchu = yes
			}
			add_state_core = 608
			set_capital = { state = 608 remember_old_capital = no }
			set_cosmetic_tag = QIE_government_manchu
			QIE = {
				QIE_aisin_gioro_puyi = {
					hidden_effect = {
						set_nationality = ROOT
						remove_all_country_leader_roles = yes
					}
					set_portraits = {
						character = QIE_aisin_gioro_puyi
						civilian = { large = GFX_portrait_QIE_aisin_gioro_puyi_civilian_large_uniform }
					}
					add_country_leader_role = {
						country_leader = {
							desc = QIE_aisin_gioro_puyi_manchu_leader_desc
							ideology = authoritarian_democrat_subtype
							traits = { CHN_restorationist_aligned SHD_restored_benevolence }
						}
						promote_leader = yes
					}
				}
				QIE_zheng_xiaoxu = { hidden_effect = { set_nationality = ROOT } }
				activate_advisor = QIE_zheng_xiaoxu_sic
				QIE_aisin_gioro_pujie = {
					hidden_effect = {
						set_nationality = ROOT
						remove_all_country_leader_roles = yes
					}
				}
			}
			SHD_qu_yingguang = {
				add_advisor_role = {
					advisor = {
						slot = political_advisor
						idea_token = SHD_qu_yingguang_advisor
						traits = { QIE_secretary_general }
						cost = 0
						can_be_fired = no
					}
					activate = yes
				}
			}
		}
		else_if = { #Zhang Zongchang can go non aligned so they still need this for now
			limit = { china_is_unaligned = yes }
			set_cosmetic_tag = SHD_government_nanjing
			set_capital = { state = 613 remember_old_capital = no } #Nanjing
		}
	}
	else_if = { #Liu Xiang, Liu Wenhui, Deng Xihou, and Lu Chao
		limit = { original_tag = SZC }
		if = {
			limit = { capital_scope = { state = 605 } } #Chengdu
			set_cosmetic_tag = SZC_government_chengdu
		}
		else = {
			set_cosmetic_tag = SZC_government_chongqing
		}
	}
	else_if = { #Ma Bufang, Ma Lin, Ma Hongkui, and Ma Hongbin
		limit = { original_tag = XSM }
		if = {
			limit = { XSM = { capital_scope = { state = 1120 } } }
			set_cosmetic_tag = XSM_government_yinchuan
		}
		else = {
			set_cosmetic_tag = XSM_government_lanzhou
		}
	}
}

china_autonomy_level_up = {
	hidden_effect = { get_current_government_type = yes }
	if = {
		limit = { has_autonomy_state = integrated_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = autonomous_governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = autonomous_governorate }
		FROM = {
			set_autonomy = {
				target = PREV
				autonomy_state = associated_governorate
				end_wars = no
			}
		}
	}
	hidden_effect = { restore_previous_government_type = yes }
}

china_autonomy_level_down = {
	hidden_effect = { get_current_government_type = yes }
	if = {
		limit = { has_autonomy_state = associated_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = autonomous_governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = autonomous_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = integrated_governorate
				end_wars = no
			}
		}
	}
	hidden_effect = { restore_previous_government_type = yes }
}

china_generate_chinese_theorists = {
	### make sure that the below are exactly the same as in history/general/china_advisors
	generate_character = {
		token_base = china_northern_school
		advisor = {
			name = china_northern_school
			slot = theorist
			desc = china_northern_school_desc
			ledger = army
			traits = { KR_northern_school }
			cost = 100
		}
		portraits = {
			army = { small = GFX_idea_doctrinal_orthodoxy_spirit }
		}
	}
	generate_character = {
		token_base = china_southern_school
		advisor = {
			name = china_southern_school
			slot = theorist
			desc = china_southern_school_desc
			ledger = army
			traits = { KR_southern_school }
			cost = 100
		}
		portraits = {
			army = { small = GFX_idea_upbeat_command_spirit }
		}
	}
	generate_character = {
		token_base = china_green_forest_school
		advisor = {
			name = china_green_forest_school
			slot = theorist
			desc = china_green_forest_school_desc
			ledger = army
			traits = { KR_green_forest_school }
			cost = 100
		}
		portraits = {
			army = { small = GFX_idea_traditionalism_academy_spirit }
		}
	}
}

china_enable_non_main_government_demand_submission_decisions = { #Main governments being defined as QIE, FNG, LKT (CHI, GXC, HNN or YUN), RKT (GXC, HNN, YUN) and UPC (GXC, HNN, YUN, and SZC)
	effect_tooltip = {
		if = {
			limit = {
				can_declare_war_on = ANQ
				OR = {
					ANQ = { china_is_aligned_with_republicans = no }
					ANQ = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					ANQ = { china_compatible_alignment_to_PREV = no }
					ANQ = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = ANQ }
		}
		if = {
			limit = {
				can_declare_war_on = GXC
				OR = {
					GXC = { china_is_aligned_with_republicans = no }
					GXC = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					GXC = { china_compatible_alignment_to_PREV = no }
					GXC = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = GXC }
		}
		if = {
			limit = {
				can_declare_war_on = HNN
				OR = {
					HNN = { china_is_aligned_with_republicans = no }
					HNN = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					HNN = { china_compatible_alignment_to_PREV = no }
					HNN = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = HNN }
		}
		if = {
			limit = {
				can_declare_war_on = LEP
				OR = {
					LEP = { china_is_aligned_with_republicans = no }
					LEP = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					LEP = { china_compatible_alignment_to_PREV = no }
					LEP = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = LEP }
		}
		if = {
			limit = {
				can_declare_war_on = SHD
				OR = {
					SHD = { china_is_aligned_with_republicans = no }
					SHD = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					SHD = { china_compatible_alignment_to_PREV = no }
					SHD = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = SHD }
		}
		if = {
			limit = {
				can_declare_war_on = SHX
				OR = {
					SHX = { china_is_aligned_with_republicans = no }
					SHX = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					SHX = { china_compatible_alignment_to_PREV = no }
					SHX = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = SHX }
		}
		if = {
			limit = {
				can_declare_war_on = SZC
				OR = {
					SZC = { china_is_aligned_with_republicans = no }
					SZC = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					SZC = { china_compatible_alignment_to_PREV = no }
					SZC = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = SZC }
		}
		if = {
			limit = {
				can_declare_war_on = YUN
				OR = {
					YUN = { china_is_aligned_with_republicans = no }
					YUN = { china_alignment_chinese_southern_republican = yes }
				}
				OR = {
					YUN = { china_compatible_alignment_to_PREV = no }
					YUN = { china_is_potential_government = yes }
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = YUN }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				OR = {
					china_is_aligned_with_republicans = no
					china_alignment_chinese_southern_republican = yes
				}
				NOT = { original_tag = QIE } #Main Government
				NOT = { original_tag = FNG } #Main Government
				NOT = { original_tag = CHI } #Main Government
				NOT = { original_tag = XSM } #Dealt with post unification
				NOT = { original_tag = KUM } #Dealt with post unification
				NOT = { original_tag = SIK } #Dealt with post unification
			}
			add_to_array = { ROOT.china_possible_targets_array = THIS }
		}
	}
}

china_enable_independent_warlord_demand_submission_decisions = { #Independent warlords being someone not currently aligned with a government and who is not a government themselves
	effect_tooltip = {
		if = {
			limit = {
				can_declare_war_on = ANQ
				ANQ = { china_is_potential_government = no }
				NOT = { ANQ = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = ANQ }
		}
		if = {
			limit = {
				can_declare_war_on = GXC
				if = {
					limit = {
						NOT = { original_tag = CHI } #CHI can attack GXC even if they're a government
					}
					GXC = { china_is_potential_government = no }
				}
				NOT = { GXC = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = GXC }
		}
		if = {
			limit = {
				can_declare_war_on = HNN
				HNN = { china_is_potential_government = no }
				NOT = { HNN = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = HNN }
		}
		if = {
			limit = {
				can_declare_war_on = LEP
				LEP = { china_is_potential_government = no }
				NOT = { LEP = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = LEP }
		}
		if = {
			limit = {
				can_declare_war_on = SHD
				SHD = { china_is_potential_government = no }
				NOT = { SHD = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = SHD }
		}
		if = {
			limit = {
				can_declare_war_on = SHX
				SHX = { china_is_potential_government = no }
				NOT = { SHX = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = SHX }
		}
		if = {
			limit = {
				can_declare_war_on = SZC
				SZC = { china_is_potential_government = no }
				NOT = { SZC = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = SZC }
		}
		if = {
			limit = {
				can_declare_war_on = YUN
				YUN = { china_is_potential_government = no }
				NOT = { YUN = { china_compatible_alignment_to_PREV = yes } }
			}
			activate_targeted_decision = { decision = china_demand_submission target = YUN }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				china_is_potential_government = no
				NOT = { original_tag = QIE } #Always Government
				NOT = { original_tag = FNG } #Always Government
				NOT = { original_tag = CHI } #Always Government
				NOT = { original_tag = XSM } #Dealt with post unification
				NOT = { original_tag = KUM } #Dealt with post unification
				NOT = { original_tag = SIK } #Dealt with post unification
			}
			add_to_array = { ROOT.china_possible_targets_array = THIS }
		}
	}
}

china_enable_all_demand_submission_decisions = {
	effect_tooltip = {
		if = {
			limit = { can_declare_war_on = QIE }
			activate_targeted_decision = { decision = china_demand_submission target = QIE }
		}
		if = {
			limit = { can_declare_war_on = FNG }
			activate_targeted_decision = { decision = china_demand_submission target = FNG }
		}
		if = {
			limit = { can_declare_war_on = SHX }
			activate_targeted_decision = { decision = china_demand_submission target = SHX }
		}
		if = {
			limit = { can_declare_war_on = GXC }
			activate_targeted_decision = { decision = china_demand_submission target = GXC }
		}
		if = {
			limit = { can_declare_war_on = YUN }
			activate_targeted_decision = { decision = china_demand_submission target = YUN }
		}
		if = {
			limit = { can_declare_war_on = HNN }
			activate_targeted_decision = { decision = china_demand_submission target = HNN }
		}
		if = {
			limit = { can_declare_war_on = SZC }
			activate_targeted_decision = { decision = china_demand_submission target = SZC }
		}
		if = {
			limit = { can_declare_war_on = LEP }
			activate_targeted_decision = { decision = china_demand_submission target = LEP }
		}
		if = {
			limit = { can_declare_war_on = ANQ }
			activate_targeted_decision = { decision = china_demand_submission target = ANQ }
		}
		if = {
			limit = { can_declare_war_on = CHI }
			activate_targeted_decision = { decision = china_demand_submission target = CHI }
		}
		if = {
			limit = { can_declare_war_on = SHD }
			activate_targeted_decision = { decision = china_demand_submission target = SHD }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				NOT = { original_tag = XSM }
				NOT = { original_tag = KUM }
				NOT = { original_tag = SIK }
			}
			add_to_array = { ROOT.china_possible_targets_array = THIS }
		}
	}
}

china_enable_all_attack_decisions = {
	effect_tooltip = {
		if = {
			limit = { can_declare_war_on = QIE }
			activate_targeted_decision = { decision = china_attack_decision target = QIE }
		}
		if = {
			limit = { can_declare_war_on = FNG }
			activate_targeted_decision = { decision = china_attack_decision target = FNG }
		}
		if = {
			limit = { can_declare_war_on = SHX }
			activate_targeted_decision = { decision = china_attack_decision target = SHX }
		}
		if = {
			limit = { can_declare_war_on = GXC }
			activate_targeted_decision = { decision = china_attack_decision target = GXC }
		}
		if = {
			limit = { can_declare_war_on = YUN }
			activate_targeted_decision = { decision = china_attack_decision target = YUN }
		}
		if = {
			limit = { can_declare_war_on = HNN }
			activate_targeted_decision = { decision = china_attack_decision target = HNN }
		}
		if = {
			limit = { can_declare_war_on = LEP }
			activate_targeted_decision = { decision = china_attack_decision target = LEP }
		}
		if = {
			limit = { can_declare_war_on = ANQ }
			activate_targeted_decision = { decision = china_attack_decision target = ANQ }
		}
		if = {
			limit = { can_declare_war_on = CHI }
			activate_targeted_decision = { decision = china_attack_decision target = CHI }
		}
		if = {
			limit = { can_declare_war_on = SHD }
			activate_targeted_decision = { decision = china_attack_decision target = SHD }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				NOT = { original_tag = XSM }
				NOT = { original_tag = KUM }
				NOT = { original_tag = SIK }
			}
			ROOT = { activate_targeted_decision = { decision = china_attack_decision target = PREV } }
		}
	}
}

china_enable_outskirts_decisions = {
	if = {
		limit = { country_exists = XSM }
		add_to_array = { ROOT.china_possible_targets_array = XSM }
		effect_tooltip = { activate_targeted_decision = { target = XSM decision = china_demand_submission } }
	}
	if = {
		limit = { country_exists = MON }
		activate_targeted_decision = { decision = china_demand_annexation target = MON }
	}
	if = {
		limit = { country_exists = TIB }
		activate_targeted_decision = { decision = china_demand_annexation target = TIB }
	}
	if = {
		limit = { country_exists = SIK }
		add_to_array = { ROOT.china_possible_targets_array = SIK }
		effect_tooltip = { activate_targeted_decision = { target = SIK decision = china_demand_submission } }
	}
	if = {
		limit = { country_exists = KUM }
		if = {
			limit = {
				OR = {
					AND = {
						KUM = { china_is_aligned_with_zhili = yes }
						ROOT = { china_is_aligned_with_zhili = yes }
					}
					AND = {
						KUM = { china_is_aligned_with_manchu = yes }
						ROOT = { china_is_aligned_with_manchu = yes }
					}
				}
			}
			add_to_array = { ROOT.china_possible_targets_array = KUM }
			add_to_array = { china_possible_allies_array_northwest = KUM }
			effect_tooltip = { activate_targeted_decision = { target = KUM decision = china_demand_submission } }
		}
		else_if = {
			limit = { KUM = { has_country_flag = KUM_is_chinese_tag } }
			add_to_array = { ROOT.china_possible_targets_array = KUM }
			effect_tooltip = { activate_targeted_decision = { target = KUM decision = china_demand_submission } }
		}
		else = {
			activate_targeted_decision = { decision = china_demand_annexation target = KUM }
		}
	}
	if = {
		limit = { country_exists = ETS }
		activate_targeted_decision = { decision = china_demand_annexation target = ETS }
	}
	hidden_effect = {
		#Decisions to replace leaders of autonomies that can't be annexed into China
		activate_targeted_decision = { target = TIB decision = china_orchestrate_sinophile_coup }
		activate_targeted_decision = { target = MON decision = china_orchestrate_sinophile_coup }
		activate_targeted_decision = { target = ETS decision = china_orchestrate_sinophile_coup }
		activate_targeted_decision = { target = KUM decision = china_orchestrate_sinophile_coup }
	}
}

china_enable_alliances_decisions = {
	effect_tooltip = {
		if = {
			limit = {
				country_exists = ANQ
				ANQ = { china_compatible_alignment_to_PREV = yes }
				ANQ = { china_is_potential_government = no }
				ANQ = { is_subject = no }
				NOT = {
					original_tag = FNG
					original_tag = QIE
				}
			}
			activate_targeted_decision = { decision = china_offer_alliance target = ANQ }
		}
		if = {
			limit = {
				country_exists = GXC
				GXC = { china_compatible_alignment_to_PREV = yes }
				GXC = { china_is_potential_government = no }
				GXC = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = GXC }
		}
		if = {
			limit = {
				country_exists = HNN
				HNN = { china_compatible_alignment_to_PREV = yes }
				HNN = { china_is_potential_government = no }
				HNN = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = HNN }
		}
		if = {
			limit = {
				country_exists = LEP
				LEP = { china_compatible_alignment_to_PREV = yes }
				LEP = { china_is_potential_government = no }
				LEP = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = LEP }
		}
		if = {
			limit = {
				country_exists = SHX
				SHX = { china_compatible_alignment_to_PREV = yes }
				SHX = { china_is_potential_government = no }
				SHX = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = SHX }
		}
		if = {
			limit = {
				country_exists = SHD
				SHD = { china_compatible_alignment_to_PREV = yes }
				SHD = { china_is_potential_government = no }
				SHD = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = SHD }
		}
		if = {
			limit = {
				country_exists = SZC
				SZC = { china_compatible_alignment_to_PREV = yes }
				SZC = { china_is_potential_government = no }
				SZC = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = SZC }
		}
		if = {
			limit = {
				country_exists = YUN
				YUN = { china_compatible_alignment_to_PREV = yes }
				YUN = { china_is_potential_government = no }
				YUN = { is_subject = no }
			}
			activate_targeted_decision = { decision = china_offer_alliance target = YUN }
		}
	}
	if = {
		limit = {
			NOT = { original_tag = QIE }
		}
		add_to_array = { china_possible_allies_array = ANQ }
	}
	#add_to_array = { china_possible_allies_array = CHI } - Should always be its own government
	#add_to_array = { china_possible_allies_array = FNG } - Should always be its own government
	add_to_array = { china_possible_allies_array = GXC }
	add_to_array = { china_possible_allies_array = HNN }
	add_to_array = { china_possible_allies_array = LEP }
	#add_to_array = { china_possible_allies_array = QIE } - Should always be its own government
	add_to_array = { china_possible_allies_array = SHX }
	add_to_array = { china_possible_allies_array = SHD }
	add_to_array = { china_possible_allies_array = SZC }
	add_to_array = { china_possible_allies_array = YUN }
}

china_enable_concession_decisions = {
	set_country_flag = china_concession_decisions_unlocked
	effect_tooltip = {
		if = {
			limit = { country_exists = LEC }
			activate_targeted_decision = { decision = china_negotiate_with_legation_cities target = LEC }
		}
		if = {
			limit = { var:326.owner = { is_chinese_tag = no } } #Hong Kong
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 326.owner }
		}
		if = {
			limit = { var:609.owner = { is_chinese_tag = no } } #Tianjin
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 609.owner }
		}
		if = {
			limit = { var:728.owner = { is_chinese_tag = no } } #Guangzhouwan
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 728.owner }
		}
		if = {
			limit = { var:729.owner = { is_chinese_tag = no } } #Macau
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 729.owner }
		}
		if = {
			limit = { var:744.owner = { is_chinese_tag = no } } #Qingdao
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 744.owner }
		}
		if = {
			limit = { var:745.owner = { is_chinese_tag = no } } #Dalian
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 745.owner }
		}
	}
}

china_generic_land_reform_setup = {
	set_variable = { China_land_reform_var = 100 }
	every_state = {
		limit = {
			OR = {
				is_china_claim_area = yes
				is_core_of = MON
			}
			OR = {
				has_state_category = one
				has_state_category = two
				has_state_category = three
			}
		}
		ROOT = {
			activate_targeted_decision = { target = PREV decision = china_generic_land_reform_decision }
		}
	}
}

china_add_research_slots = {
	if = {
		limit = { has_global_flag = china_united }
		add_research_slot_until_five = yes
	}
	else = {
		add_research_slot_until_four = yes
	}
}

china_generic_unification_effect = {
	log = "KR_Event_Logging;CHINA UNITED BY A minor clique"
	if = {
		limit = { #Ma Zhongying needs this exception to make the flag and colour work
			has_country_leader = { character = XSM_ma_zhongying }
		}
		set_cosmetic_tag = united_china_zhongying
	}
	else_if = {
		limit = { #Fan Yaonan needs this exception to make the flag and colour work
			has_country_leader = { character = SIK_fan_yaonan }
		}
		set_cosmetic_tag = united_china_yaonan
	}
	else = {
		set_cosmetic_tag = united_china
	}
	add_ideas = CHS_legitimacy1
	add_ideas = CHS_bureaucracy1
	add_ideas = CHS_military1
	custom_effect_tooltip = enables_new_focus_branches
	activate_targeted_decision = { decision = china_move_capital target = ROOT }
	country_event = { id = china_events.2145 days = 3 } #National Unification and New Troubles
}

china_army_reform_increase_step = {
	if = {
		limit = { has_idea = china_poor_army_3_officers }
		swap_ideas = {
			remove_idea = china_poor_army_3_officers
			add_idea = china_poor_army_2_officers
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_3 }
		swap_ideas = {
			remove_idea = china_poor_army_3
			add_idea = china_poor_army_2
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_2_officers }
		swap_ideas = {
			remove_idea = china_poor_army_2_officers
			add_idea = china_poor_army_1_officers
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_2 }
		swap_ideas = {
			remove_idea = china_poor_army_2
			add_idea = china_poor_army_1
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_1_officers }
		swap_ideas = {
			remove_idea = china_poor_army_1_officers
			add_idea = china_poor_army_0
		}
		clr_country_flag = china_has_poor_army #disables china_army_reform_ai AI strategy plan
	}
	else = {
		remove_ideas = china_poor_army_1
		clr_country_flag = china_has_poor_army #disables china_army_reform_ai AI strategy plan
	}
}

china_army_reform_remove_officer_penalty = {
	if = {
		limit = { has_idea = china_poor_army_3_officers }
		swap_ideas = {
			remove_idea = china_poor_army_3_officers
			add_idea = china_poor_army_3
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_2_officers }
		swap_ideas = {
			remove_idea = china_poor_army_2_officers
			add_idea = china_poor_army_2
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_1_officers }
		swap_ideas = {
			remove_idea = china_poor_army_1_officers
			add_idea = china_poor_army_1
		}
	}
	else = {
		remove_ideas = china_poor_army_0
	}
}

### CHN Military Disarray
CHN_setup_military_disarray_normal_effect = {
	if = {
		limit = { has_country_flag = CHN_setup_military_disarray_early_flag }
		#Downgrade your spirit by 1 level. Can't avoid it entirely.
		if = {
			limit = { has_idea = CHN_military_disarray_idea1 }
			#You get punished for starting reforms early but doing nothing
			custom_effect_tooltip = CHN_activate_military_disarray_no_additional_level_warning_tt
			add_war_support = -0.10
		}
		else_if = {
			limit = { has_idea = CHN_military_disarray_idea2 }
			custom_effect_tooltip = CHN_activate_military_disarray_additional_level_warning_tt
			swap_ideas = {
				remove_idea = CHN_military_disarray_idea2
				add_idea = CHN_military_disarray_idea1
			}
			add_to_variable = { CHN_military_disarray_fixes_needed_var = 1 }
		}
		else_if = {
			limit = { has_idea = CHN_military_disarray_idea3 }
			custom_effect_tooltip = CHN_activate_military_disarray_additional_level_warning_tt
			swap_ideas = {
				remove_idea = CHN_military_disarray_idea3
				add_idea = CHN_military_disarray_idea2
			}
			add_to_variable = { CHN_military_disarray_fixes_needed_var = 1 }
		}
		else = {
			custom_effect_tooltip = CHN_activate_military_disarray_additional_level_warning_tt
			add_ideas = CHN_military_disarray_idea3
			add_to_variable = { CHN_military_disarray_fixes_needed_var = 1 }
		}
	}
	else = {
		custom_effect_tooltip = CHN_activate_military_disarray_normal_tt
		set_country_flag = CHN_setup_military_disarray_normal_flag
		add_ideas = CHN_military_disarray_idea1
		set_variable = { CHN_military_disarray_fixes_needed_var = 3 }
	}
	mark_focus_tree_layout_dirty = yes
}

CHN_setup_military_disarray_early_effect = {
	if = {
		limit = {
			NOT = {
				has_country_flag = CHN_setup_military_disarray_early_flag
				has_country_flag = CHN_setup_military_disarray_normal_flag
			}
		}
		custom_effect_tooltip = CHN_activate_military_disarray_early_warning_tt
		set_country_flag = CHN_setup_military_disarray_early_flag
		add_ideas = CHN_military_disarray_idea1
		set_variable = { CHN_military_disarray_fixes_needed_var = 3 }
		mark_focus_tree_layout_dirty = yes
	}
}

CHN_improve_military_disarray_effect = {
	if = {
		limit = { has_idea = CHN_military_disarray_idea1 }
		swap_ideas = {
			remove_idea = CHN_military_disarray_idea1
			add_idea = CHN_military_disarray_idea2
		}
	}
	else_if = {
		limit = { has_idea = CHN_military_disarray_idea2 }
		swap_ideas = {
			remove_idea = CHN_military_disarray_idea2
			add_idea = CHN_military_disarray_idea3
		}
	}
	else_if = {
		limit = { has_idea = CHN_military_disarray_idea3 }
		remove_ideas = CHN_military_disarray_idea3
		clear_variable = CHN_military_disarray_fixes_needed_var
	}
}

### CHN Econ Devastation
CHN_setup_economic_devastation_normal_effect = {
	if = {
		limit = { has_country_flag = CHN_setup_economic_devastation_early_flag }
		#Downgrade your spirit by 1 level. Can't avoid it entirely.
		if = {
			limit = { has_idea = CHN_devastated_national_econ_idea }
			#You get punished for starting reforms early but doing nothing
			custom_effect_tooltip = CHN_activate_economic_devastation_no_additional_level_warning_tt
			add_stability = -0.1
		}
		else_if = {
			limit = { has_idea = CHN_devastated_national_econ2_idea }
			custom_effect_tooltip = CHN_activate_economic_devastation_additional_level_warning_tt
			swap_ideas = {
				remove_idea = CHN_devastated_national_econ2_idea
				add_idea = 	CHN_devastated_national_econ_idea
			}
		}
		else_if = {
			limit = { has_idea = CHN_devastated_national_econ3_idea }
			custom_effect_tooltip = CHN_activate_economic_devastation_additional_level_warning_tt
			swap_ideas = {
				remove_idea = CHN_devastated_national_econ3_idea
				add_idea = CHN_devastated_national_econ2_idea
			}
		}
		else = {
			custom_effect_tooltip = CHN_activate_economic_devastation_additional_level_warning_tt
			add_ideas = CHN_devastated_national_econ3_idea
		}
	}
	else = {
		custom_effect_tooltip = CHN_activate_economic_devastation_normal_tt
		set_country_flag = CHN_setup_economic_devastation_normal_flag
		add_ideas = CHN_devastated_national_econ_idea
	}
	mark_focus_tree_layout_dirty = yes
}
CHN_setup_economic_devastation_early_effect = {
	if = {
		limit = {
			NOT = {
				has_country_flag = CHN_setup_economic_devastation_early_flag
				has_country_flag = CHN_setup_economic_devastation_normal_flag
			}
		}
		custom_effect_tooltip = CHN_activate_economic_devastation_early_warning_tt
		set_country_flag = CHN_setup_economic_devastation_early_flag
		add_ideas = CHN_devastated_national_econ_idea
	}
	mark_focus_tree_layout_dirty = yes
}
CHN_improve_economic_devastation_effect = {
	if = {
		limit = { has_idea = CHN_devastated_national_econ_idea }
		swap_ideas = {
			remove_idea = CHN_devastated_national_econ_idea
			add_idea = CHN_devastated_national_econ2_idea
		}
	}
	else_if = {
		limit = { has_idea = CHN_devastated_national_econ2_idea }
		swap_ideas = {
			remove_idea = CHN_devastated_national_econ2_idea
			add_idea = CHN_devastated_national_econ3_idea
		}
	}
	else_if = {
		limit = { has_idea = CHN_devastated_national_econ3_idea }
		remove_ideas = CHN_devastated_national_econ3_idea
	}
	else = { add_one_random_civilian_factory = yes }
}

CHN_setup_national_illiteracy_effect = {
	if = {
		limit = { NOT = { has_country_flag = CHN_national_illiteracy_idea_added_flag } }
		set_country_flag = CHN_national_illiteracy_idea_added_flag
		add_ideas = CHN_national_illiteracy1_idea
	}
}

CHN_setup_lategame_debuffs_effect = {
	CHN_setup_economic_devastation_normal_effect = yes
	CHN_setup_military_disarray_normal_effect = yes
	CHN_setup_national_illiteracy_effect = yes
}
# CHN Reconstruction Effects
CHN_add_buildslots_effect = {
	if = {
		limit = { 592 = { is_controlled_by_ROOT_or_subject = yes } } #Canton
		592 = {
			add_extra_state_shared_building_slots = 1
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_extra_state_shared_building_slots = 1
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_extra_state_shared_building_slots = 1
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_extra_state_shared_building_slots = 1
		}
	}
	if = {
		limit = { 602 = { is_controlled_by_ROOT_or_subject = yes } } #Changsha
		602 = {
			add_extra_state_shared_building_slots = 1
		}
	}
	if = {
		limit = { 650 = { is_controlled_by_ROOT_or_subject = yes } } #Chongqing
		650 = {
			add_extra_state_shared_building_slots = 1
		}
	}
	if = {
		limit = { 594 = { is_controlled_by_ROOT_or_subject = yes } } #Nanning
		594 = {
			add_extra_state_shared_building_slots = 1
		}
	}
}
CHN_add_infra_effect = {
	if = {
		limit = { 592 = { is_controlled_by_ROOT_or_subject = yes } } #Canton
		592 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 602 = { is_controlled_by_ROOT_or_subject = yes } } #Changsha
		602 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 650 = { is_controlled_by_ROOT_or_subject = yes } } #Chongqing
		650 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 594 = { is_controlled_by_ROOT_or_subject = yes } } #Nanning
		594 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
}
CHN_add_infra_northerner_effect = {
	if = {
		limit = { 716 = { is_controlled_by_ROOT_or_subject = yes } } #Shenyang
		716 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 597 = { is_controlled_by_ROOT_or_subject = yes } } #Jinan
		597 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1072 = { is_controlled_by_ROOT_or_subject = yes } } #Taiyuan
		1072 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1062 = { is_controlled_by_ROOT_or_subject = yes } } #Baoding
		1062 = {
			add_building_construction = {
				type = infrastructure
				level = 1
				instant_build = yes
			}
		}
	}
}
CHN_add_resource_effects = {
	if = {
		limit = { 592 = { is_controlled_by_ROOT_or_subject = yes } } #Canton
		592 = {
			add_resource = { type = steel amount = 4 }
		}
	}
	if = {
		limit = { 595 = { is_controlled_by_ROOT_or_subject = yes } } #Nanping
		595 = {
			add_resource = { type = tungsten amount = 4 }
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_resource = { type = steel amount = 4 }
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_resource = { type = steel amount = 4 }
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_resource = { type = steel amount = 4 }
		}
	}
}
CHN_add_resource_northerner_effects = {
	if = {
		limit = { 716 = { is_controlled_by_ROOT_or_subject = yes } } #Shenyang
		716 = {
			add_resource = { type = steel amount = 4 }
		}
	}
	if = {
		limit = { 1072 = { is_controlled_by_ROOT_or_subject = yes } } #Taiyuan
		1072 = {
			add_resource = { type = tungsten amount = 4 }
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_resource = { type = steel amount = 4 }
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_resource = { type = steel amount = 4 }
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_resource = { type = steel amount = 4 }
		}
	}
}
CHN_build_military_industry_effect = {
	if = {
		limit = { has_dlc_aat = no }
		custom_effect_tooltip = available_designer
		show_ideas_tooltip = norinco
		if = {
			limit = { NOT = { has_completed_focus = CHI_create_supply_corps } }
			custom_effect_tooltip = tooltip_white_line
			custom_effect_tooltip = available_designer
			show_ideas_tooltip = faw_motors
		}
	}
	else = {
		if = {
			limit = { mio:CHN_artillery_industry_organisation = { is_mio_available = no } }
			custom_effect_tooltip = available_mio_tt
			show_mio_tooltip = CHN_artillery_industry_organisation
		}
		mio:CHN_artillery_industry_organisation = {
			set_mio_flag = CHN_mio_unlocked
			add_mio_size = 3
		}
		if = {
			limit = { mio:CHN_transportation_industry_organisation = { is_mio_available = no } }
			custom_effect_tooltip = tooltip_white_line
			custom_effect_tooltip = available_mio_tt
			show_mio_tooltip = CHN_transportation_industry_organisation
		}
		mio:CHN_transportation_industry_organisation = {
			set_mio_flag = CHN_mio_unlocked
			add_mio_size = 1
		}
	}
	custom_effect_tooltip = tooltip_white_line
	custom_effect_tooltip = CHI_arsenals_tt
	every_owned_state = {
		limit = {
			OR = {
				state = 592 #Guangzhou
				state = 613 #Nanjing
				state = 1048 #Wuhan
				state = 1059 #Kaifeng
			}
			is_controlled_by_ROOT_or_subject = yes
			free_building_slots = { building = arms_factory size > 0 include_locked = yes }
		}
		display_individual_scopes = yes
		add_extra_state_shared_building_slots = 1
		add_building_construction = {
			type = arms_factory
			level = 1
			instant_build = yes
		}
	}
}
CHN_add_civilian_industry_effect = {
	if = {
		limit = { 592 = { is_controlled_by_ROOT_or_subject = yes } } #Canton
		592 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 602 = { is_controlled_by_ROOT_or_subject = yes } } #Changsha
		602 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 650 = { is_controlled_by_ROOT_or_subject = yes } } #Chongqing
		650 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 594 = { is_controlled_by_ROOT_or_subject = yes } } #Nanning
		594 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
}

CHN_add_civilian_industry_northerner_effect = {
	if = {
		limit = { 1062 = { is_controlled_by_ROOT_or_subject = yes } } #Baoding
		1062 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 613 = { is_controlled_by_ROOT_or_subject = yes } } #Nanjing
		613 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1048 = { is_controlled_by_ROOT_or_subject = yes } } #Wuhan
		1048 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 608 = { is_controlled_by_ROOT_or_subject = yes } } #Beijing
		608 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 716 = { is_controlled_by_ROOT_or_subject = yes } } #Shenyang
		716 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 597 = { is_controlled_by_ROOT_or_subject = yes } } #Jinan
		597 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
	if = {
		limit = { 1072 = { is_controlled_by_ROOT_or_subject = yes } } #Taiyuan
		1072 = {
			add_building_construction = {
				type = industrial_complex
				level = 1
				instant_build = yes
			}
		}
	}
}
#Wuhan Effects
china_merges_wuhan = {
	set_victory_points = { province = 4619 value = 40 } #Wuchang/Wuhan
	set_victory_points = { province = 12467 value = 0 } #Hanyang
	set_victory_points = { province = 7167 value = 0 } #Hankou
	1048 = {
		set_state_flag = wuhan_formed
		effect_tooltip = {
			set_province_name = { id = 4619 name = VICTORY_POINTS_4619_WUHAN }
		}
		rename_state_effect = yes
	}
}

china_splits_wuhan = {
	1048 = { clr_state_flag = wuhan_formed }
	set_victory_points = { province = 4619 value = 20 } #Wuchang
	set_victory_points = { province = 12467 value = 10 } #Hanyang
	set_victory_points = { province = 7167 value = 10 } #Hankou
	1048 = {
		effect_tooltip = {
			set_province_name = { id = 4619 name = VICTORY_POINTS_4619 }
		}
		rename_state_effect = yes
	}
}

#MIO Setup Effects
CHN_setup_major_arsenal_decision_effect = {
	if = {
		limit = { NOT = { PREV = { owns_state = PREV } } }
		PREV = { activate_targeted_decision = { target = PREV decision = CHN_integrate_major_arsenal_decision } }
	}
	else = {
		PREV = {
			mio:CHN_small_arms_industry_organisation = {
				add_mio_funds = 250
			}
			mio:CHN_support_equipment_industry_organisation = {
				add_mio_funds = 250
			}
			mio:CHN_artillery_industry_organisation = {
				add_mio_funds = 250
			}
		}
	}
}

CHN_setup_minor_small_arms_arsenal_decision_effect = {
	if = {
		limit = { NOT = { PREV = { owns_state = PREV } } }
		PREV = { activate_targeted_decision = { target = PREV decision = CHN_integrate_minor_small_arms_arsenal_decision } }
	}
	else = {
		PREV = {
			mio:CHN_small_arms_industry_organisation = {
				add_mio_funds = 250
			}
		}
	}
}

CHN_setup_minor_support_equipment_arsenal_decision_effect = {
	if = {
		limit = { NOT = { PREV = { owns_state = PREV } } }
		PREV = { activate_targeted_decision = { target = PREV decision = CHN_integrate_minor_support_equipment_arsenal_decision } }
	}
	else = {
		PREV = {
			mio:CHN_support_equipment_industry_organisation = {
				add_mio_funds = 250
			}
		}
	}
}

CHN_setup_minor_artillery_arsenal_decision_effect = {
	if = {
		limit = { NOT = { PREV = { owns_state = PREV } } }
		PREV = { activate_targeted_decision = { target = PREV decision = CHN_integrate_minor_artillery_arsenal_decision } }
	}
	else = {
		PREV = {
			mio:CHN_artillery_industry_organisation = {
				add_mio_funds = 250
			}
		}
	}
}

CHN_setup_major_dockyards_decision_effect = {
	if = {
		limit = { NOT = { PREV = { owns_state = PREV } } }
		PREV = { activate_targeted_decision = { target = PREV decision = CHN_integrate_major_dockyard_decision } }
	}
	else = {
		PREV = {
			mio:CHN_naval_industry_organisation = {
				add_mio_funds = 250
			}
		}
	}
}
## Inheriting Beiyang Fleet Effect
CHN_inherit_beiyang_fleet_effect = {
	if = {
		limit = { NOT = { has_tech = early_ship_hull_light } }
		set_technology = { early_ship_hull_light = 1 }
	}
	if = {
		limit = { NOT = { has_tech = early_ship_hull_cruiser } }
		set_technology = { early_ship_hull_cruiser = 1 }
	}
	if = {
		limit = { NOT = { has_tech = coastal_defense_ships } }
		set_technology = { coastal_defense_ships = 1 }
	}
	if = {
		limit = { NOT = { has_tech = coastal_defense_ships } }
		set_technology = { coastal_defense_ships = 1 }
	}
	if = {
		limit = { NOT = { has_tech = basic_naval_mines } }
		set_technology = { basic_naval_mines = 1 }
	}
	if = {
		limit = { NOT = { has_tech = basic_battery } }
		set_technology = { basic_battery = 1 }
	}
	if = {
		limit = { NOT = { has_tech = basic_torpedo } }
		set_technology = { basic_torpedo = 1 }
	}
	QIE = {
		custom_effect_tooltip = characters_will_be_recruited
		character_list_tooltip = {
			limit = {
				OR = {
					is_character = QIE_sa_zhenbing
					is_character = QIE_du_xigui
					is_character = QIE_wu_yulin
					is_character = QIE_yang_shuzhuang
				}
			}
		}
		hidden_effect = {
			QIE_sa_zhenbing = { CHN_recruit_character_effect = yes }
			QIE_du_xigui = { CHN_recruit_character_effect = yes }
			QIE_wu_yulin = { CHN_recruit_character_effect = yes }
			QIE_yang_shuzhuang = { CHN_recruit_character_effect = yes }
		}
	}
	if = {
		limit = { china_is_aligned_with_kmt = yes }
		CHI = {
			custom_effect_tooltip = characters_will_be_recruited
			character_list_tooltip = {
				limit = {
					OR = {
						is_character = CHI_chen_shaokuan
						is_character = CHI_chen_jiliang
					}
				}
			}
			hidden_effect = {
				CHI_chen_jiliang = { CHN_recruit_character_effect = yes }
				CHI_chen_shaokuan = { CHN_recruit_character_effect = yes }
			}
		}
		if = {
			limit = { NOT = { country_exists = GXC } }
			GXC = {
				custom_effect_tooltip = characters_will_be_recruited
				character_list_tooltip = {
					limit = { is_character = GXC_chen_ce }
				}
				hidden_effect = {
					GXC_chen_ce = { CHN_recruit_character_effect = yes }
				}
			}
		}
		if = {
			limit = { NOT = { country_exists = YUN } }
			YUN = {
				custom_effect_tooltip = characters_will_be_recruited
				character_list_tooltip = {
					limit = { is_character = YUN_ouyang_ge }
				}
				hidden_effect = {
					YUN_ouyang_ge = { CHN_recruit_character_effect = yes }
				}
			}
		}
	}
	if = {
		limit = { NOT = { country_exists = FNG } }
		FNG = {
			custom_effect_tooltip = characters_will_be_recruited
			character_list_tooltip = {
				limit = { is_character = FNG_shen_honglie }
			}
			hidden_effect = {
				FNG_shen_honglie = { CHN_recruit_character_effect = yes }
			}
		}
	}
	if = {
		limit = { NOT = { country_exists = GXC } }
		GXC = {
			custom_effect_tooltip = characters_will_be_recruited
			character_list_tooltip = {
				limit = {
					is_character = GXC_zhou_tianlu
					is_character = GXC_li_qingwen
					is_character = GXC_tang_tingguang
				}
			}
			hidden_effect = {
				GXC_zhou_tianlu = { CHN_recruit_character_effect = yes }
				GXC_li_qingwen = { CHN_recruit_character_effect = yes }
				GXC_tang_tingguang = { CHN_recruit_character_effect = yes }
			}
		}
	}
	if = {
		limit = { NOT = { country_exists = LEP } }
		LEP = {
			custom_effect_tooltip = characters_will_be_recruited
			character_list_tooltip = {
				limit = {
					is_character = LEP_wu_zhennan
					is_character = LEP_li_shijia
					is_character = LEP_wang_shouting
				}
			}
			hidden_effect = {
				LEP_wu_zhennan = { CHN_recruit_character_effect = yes }
				LEP_li_shijia = { CHN_recruit_character_effect = yes }
				LEP_wang_shouting = { CHN_recruit_character_effect = yes }
			}
		}
	}
	else_if = {
		limit = { QIE = { has_character = LEP_wu_zhennan } }
		QIE = {
			custom_effect_tooltip = characters_will_be_recruited
			character_list_tooltip = {
				limit = { is_character = LEP_wu_zhennan }
			}
			hidden_effect = {
				LEP_wu_zhennan = { CHN_recruit_character_effect = yes }
			}
		}
	}
	else_if = {
		limit = {
			ANQ = { has_character = LEP_wu_zhennan }
			NOT = { country_exists = ANQ }
		}
		ANQ = {
			custom_effect_tooltip = characters_will_be_recruited
			character_list_tooltip = {
				limit = {
					is_character = LEP_wu_zhennan
					is_character = LEP_li_shijia
					is_character = LEP_wang_shouting
				}
			}
			hidden_effect = {
				LEP_wu_zhennan = { CHN_recruit_character_effect = yes }
				LEP_li_shijia = { CHN_recruit_character_effect = yes }
				LEP_wang_shouting = { CHN_recruit_character_effect = yes }
			}
		}
	}
}

################################
### KMT Generic Tree Effects ###
################################
increase_RKMT_popular_support = {
	if = {
		limit = {
			has_idea = KR_RKMT_popular_support_4
		}
		swap_ideas = {
			remove_idea = KR_RKMT_popular_support_4
			add_idea = KR_RKMT_popular_support_5
		}
	}
	if = {
		limit = {
			has_idea = KR_RKMT_popular_support_3
		}
		swap_ideas = {
			remove_idea = KR_RKMT_popular_support_3
			add_idea = KR_RKMT_popular_support_4
		}
	}
	if = {
		limit = {
			has_idea = KR_RKMT_popular_support_2
		}
		swap_ideas = {
			remove_idea = KR_RKMT_popular_support_2
			add_idea = KR_RKMT_popular_support_3
		}
	}
	if = {
		limit = {
			has_idea = KR_RKMT_popular_support_1
		}
		swap_ideas = {
			remove_idea = KR_RKMT_popular_support_1
			add_idea = KR_RKMT_popular_support_2
		}
	}
}
RKMT_economic_recovery = {
	if = {
		limit = { has_idea = GXC_economic_instability }
		swap_ideas = {
			remove_idea = GXC_economic_instability
			add_idea = GXC_economic_instability2
		}
	}
	else_if = {
		limit = { has_idea = GXC_economic_instability2 }
		swap_ideas = {
			remove_idea = 	GXC_economic_instability2
			add_idea = GXC_economic_instability3
		}
	}
	else_if = {
		limit = { has_idea = GXC_economic_instability3 }
		swap_ideas = {
			remove_idea = 	GXC_economic_instability3
			add_idea = GXC_economic_instability4
		}
	}
	else_if = {
		limit = { has_idea = GXC_economic_instability4 }
		swap_ideas = {
			remove_idea = 	GXC_economic_instability4
			add_idea = GXC_economic_instability5
		}
	}
	else_if = {
		limit = { has_idea = GXC_economic_instability5 }
		remove_ideas = GXC_economic_instability5
	}
}

RKMT_literacy_recovery = {
	if = {
		limit = { has_idea = GXC_low_literacy }
		swap_ideas = {
			remove_idea = GXC_low_literacy
			add_idea = GXC_low_literacy2
		}
	}
	else_if = {
		limit = { has_idea = GXC_low_literacy2 }
		swap_ideas = {
			remove_idea = GXC_low_literacy2
			add_idea = GXC_low_literacy3
		}
	}
	else_if = {
		limit = { has_idea = GXC_low_literacy3 }
		swap_ideas = {
			remove_idea = GXC_low_literacy3
			add_idea = GXC_low_literacy4
		}
	}
}
RKMT_chinese_revolution = {
	if = {
		limit = { has_idea = GXC_rkmt_revolution }
		swap_ideas = {
			remove_idea = GXC_rkmt_revolution
			add_idea = GXC_rkmt_revolution2
		}
	}
	if = {
		limit = { has_idea = GXC_rkmt_revolution2 }
		swap_ideas = {
			remove_idea = GXC_rkmt_revolution2
			add_idea = GXC_rkmt_revolution3
		}
	}
}
RKMT_military_recovery = {
	if = {
		limit = { has_idea = GXC_kmt_demobilisation }
		swap_ideas = {
			remove_idea = GXC_kmt_demobilisation
			add_idea = GXC_kmt_demobilisation2
		}
	}
	else_if = {
		limit = { has_idea = GXC_kmt_demobilisation2 }
		swap_ideas = {
			remove_idea = GXC_kmt_demobilisation2
			add_idea = GXC_kmt_demobilisation3
		}
	}
	else_if = {
		limit = { has_idea = GXC_kmt_demobilisation3 }
		swap_ideas = {
			remove_idea = GXC_kmt_demobilisation3
			add_idea = 	GXC_kmt_demobilisation4
		}
	}
	else_if = {
		limit = { has_idea = GXC_kmt_demobilisation4 }
		remove_ideas = GXC_kmt_demobilisation4
	}
}

china_set_character_alignment_northern_zhili = {
	event_target:system = { china_alignment_northern_zhili = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_southern_zhili = {
	event_target:system = { china_alignment_southern_zhili = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_manchu_qing = {
	event_target:system = { china_alignment_manchu_qing = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_fengtian = {
	event_target:system = { china_alignment_fengtian = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_beiyang = {
	event_target:system = { china_alignment_beiyang = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_federalists = {
	event_target:system = { china_alignment_federalists = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_left_kuomintang = {
	event_target:system = { china_alignment_left_kuomintang = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_right_kuomintang = {
	event_target:system = { china_alignment_right_kuomintang = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_chinese_southern_republican = {
	event_target:system = { china_alignment_chinese_southern_republican = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_geacps = {
	event_target:system = { china_alignment_geacps = { set_variable = { PREV.PREV.china_alignment = THIS } } }
}
china_set_character_alignment_unaligned = {
	clear_variable = china_alignment
}

CHN_build_faction_alignment_array = {
	add_to_array = { PREV.china_alignment_leaders = THIS }
	set_temp_variable = { aligned_@THIS = 1 }
	every_subject_country = {
		limit = {
			OR = {
				china_is_governorate = yes
				original_tag = KUM
			}
		}
		add_to_array = { PREV.china_alignment_members = THIS }
		set_temp_variable = { aligned_@THIS = 1 }

		#account for LEP at game start
		every_subject_country = {
			limit = {
				OR = {
					china_is_governorate = yes
					original_tag = KUM
				}
			}
			add_to_array = { PREV.PREV.china_alignment_members = THIS }
			set_temp_variable = { aligned_@THIS = 1 }
		}
	}
}

### China Alignment Scripted GUI Calculation Effects ###
CHN_calculate_china_alignment_gui_effect = {
	CHN_clear_china_alignment_gui = yes

	### Check which factions exist add them to the leader array as well as their alignment token
	if = {
		limit = { country_exists = NZH } #North Zhili
		NZH = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = {
			country_exists = SZH #South Zhili
			SZH = { is_subject = no } #account for LEP joining QIE
		}
		SZH = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = MCU } #Restorationists
		MCU = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = AGJ } #Anguojun
		AGJ = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = UPC } #Federalists
		UPC = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = LKT } #Left Kuomintang
		LKT = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = RKT } #Right Kuomintang
		RKT = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = NPA } #National Protection Alliance
		NPA = { CHN_build_faction_alignment_array = yes }
	}
	if = {
		limit = { country_exists = RGC } #GEACPS (Japan)
		RGC = { CHN_build_faction_alignment_array = yes }

		### To account for MAN being a Japanese puppet ###
		if = {
			limit = { MAN = { is_ally_with = JAP } }
			add_to_array = { RGC.china_alignment_members = THIS }
		}
	}

	### Build non-aligned tag array ###
	for_each_scope_loop = {
		array = global.china_tags_array
		if = {
			limit = {
				exists = yes
				check_variable = { aligned_@THIS < 1 }
			}
			add_to_array = { event_target:system.china_alignment_members = THIS } #Independent Cliques
		}
	}

	### Account for KUM not being a chinese tag ###
	KUM = {
		if = {
			limit = {
				NOT = { has_country_flag = KUM_is_chinese_tag }
				exists = yes
				check_variable = { aligned_@THIS < 1 }
			}
			add_to_array = { event_target:system.china_alignment_members = THIS } #Independent Cliques
		}
	}

	### To account for GXC civil war ###
	every_country_with_original_tag = {
		original_tag_to_check = GXC
		limit = {
			exists = yes
			is_dynamic_country = yes
			has_civil_war = yes
		}
		add_to_array = { event_target:system.china_alignment_members = THIS } #Independent Cliques
	}

	### Check to see if there are any Independent Cliques ###
	if = {
		limit = { check_variable = { event_target:system.china_alignment_members^num > 0 } }
		add_to_array = { PREV.china_alignment_leaders = event_target:system } #Independent Cliques
	}
}

CHN_clear_china_alignment_gui = {
	### Clear all alignment arrays ###
	for_each_scope_loop = {
		array = china_alignment_leaders
		clear_array = china_alignment_members
	}
	clear_array = china_alignment_leaders
}

CHN_update_china_alignment_gui = {
	### Use to update the GUI ###
	set_variable_to_random = china_alignment_gui_update
}

### Scientist Transfer ###
CHN_scientist_transfer_effect = {
	if = {
		limit = { NOT = { has_character = QIE_qian_xuesen } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = QIE_qian_xuesen
			}
			QIE = { QIE_qian_xuesen = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = QIE_wu_dayou } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = QIE_wu_dayou
			}
			QIE = { QIE_wu_dayou = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = QIE_wang_pu } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = QIE_wang_pu
			}
			QIE = { QIE_wang_pu = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = QIE_xing_qixin } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = QIE_xing_qixin
			}
			QIE = { QIE_xing_qixin = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = SHD_wang_ganchang } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = SHD_wang_ganchang
			}
			SHD = { SHD_wang_ganchang = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = LEP_zhu_jiaren } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = LEP_zhu_jiaren
			}
			LEP = { LEP_zhu_jiaren = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = LEP_ye_zaifu } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = LEP_ye_zaifu
			}
			LEP = { LEP_ye_zaifu = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = SHX_zhang_kai } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = SHX_zhang_kai
			}
			SHX = { SHX_zhang_kai = { set_nationality = ROOT } }
		}
	}
	if = {
		limit = { NOT = { has_character = FNG_li_yichun } }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_available_scientist
				CHARACTER = FNG_li_yichun
			}
			FNG = { FNG_li_yichun = { set_nationality = ROOT } }
		}
	}
}

CHN_recruit_character_effect = {
	if = {
		limit = {
			NOT = {
				THIS = { has_character_flag = is_dead }
				ROOT = { has_character = PREV }
			}
		}
		hidden_effect = {
			if = {
				limit = { THIS = { is_army_leader = yes } }
				demote_to_general = yes
				remove_trait = { trait = recently_promoted }
			}
		}
		set_nationality = ROOT
	}
}

china_create_united_front_faction = {
	save_global_event_target_as = china_united_front_leader
	create_faction_from_template = faction_template_chinese_united_front
	scope:faction = { set_variable = { non_ideological_faction = 1 } }
	set_country_flag = was_in_united_front
	set_rule = {
		can_not_declare_war = yes
		desc = china_cannot_declare_war_while_in_united_front
	}
	every_other_country = {
		limit = {
			is_chinese_tag = yes
			is_in_faction = no
		}
		set_country_flag = china_united_front_can_join_factions
		set_rule = { can_join_factions = yes }
	}
	if = {
		limit = {
			has_dlc_lar = yes
			NOT = { has_global_flag = CHN_zheng_pingru_recruited_flag }
			OR = {
				has_war_with = JAP
				has_variable = declared_war_on_JAP
			}
		}
		set_global_flag = CHN_zheng_pingru_recruited_flag
		create_operative_leader = {
			name = CHN_zheng_pingru
			GFX = GFX_portrait_CHN_zheng_pingru_operative
			traits = {
				operative_seducer
				operative_well_groomed
				operative_political_connections
			}
			bypass_recruitment = no
			available_to_spy_master = yes
			female = yes
			nationalities = { JAP LEC QIE FNG CHI LEP ANQ HNN GXC YUN SZC SHX SHD XSM SIK KUM }
		}
	}
}

china_form_SCPC_effect = {
	if = {
		limit = { tag = GXC }
		if = {
			limit = {
				OR = {
					china_is_aligned_with_kmt = yes #If somehow free and can form
					var:new_overlord = {
						OR = {
							china_alignment_left_kuomintang = yes
							china_alignment_right_kuomintang = yes
						}
					}
				}
			}
			set_cosmetic_tag = GXC_SCPC_KMT
		}
		else = {
			set_cosmetic_tag = GXC_SCPC_NPA
		}
	}
	else_if = {
		limit = { tag = YUN }
		if = {
			limit = {
				OR = {
					china_is_aligned_with_kmt = yes #If somehow free and can form
					var:new_overlord = {
						OR = {
							china_alignment_left_kuomintang = yes
							china_alignment_right_kuomintang = yes
						}
					}
				}
			}
			set_cosmetic_tag = YUN_SCPC_KMT
		}
		else = {
			set_cosmetic_tag = YUN_SCPC_UPC
		}
	}
	every_state = {
		limit = {
			NOT = {
				is_core_of = ROOT
				is_claimed_by = ROOT
			}
			OR = {
				has_state_flag = guangxi_province_state
				has_state_flag = guangdong_province_state
				has_state_flag = yunnan_province_state
				has_state_flag = sichuan_province_state
				has_state_flag = hunan_province_state
				has_state_flag = guizhou_province_state
			}
		}
		add_claim_by = ROOT
	}
}
