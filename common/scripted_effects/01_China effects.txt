set_potential_national_government = {
	if = {
		limit = { NOT = { has_country_flag = china_is_potential_government } }
		set_country_flag = china_is_potential_government
		every_state = {
			limit = {
				is_core_china = yes
				is_claim_or_core_of_PREV = no
				NOT = {
					has_variable = ambition_area_@PREV
					owner = {
						is_subject_of = PREV.PREV
						china_is_governorate = yes
					}
				}
			}
			add_claim_by = PREV
			add_to_array = { PREV.china_government_ambitions = THIS }
			set_variable = { ambition_area_@PREV = 1 }
		}
		hidden_effect = {
			every_state = {
				limit = {
					is_china_claim_area = yes
					is_claim_or_core_of_PREV = no
					NOT = { has_variable = ambition_area_@PREV }
				}
				add_to_array = { PREV.china_government_ambitions = THIS }
				set_variable = { ambition_area_@PREV = 1 }
			}
			CHI_warn_of_rkmt_government_effect = yes #If its a RKMT leader, effect will fire an event for CHI
		}
	}
}

clear_potential_national_government = {
	hidden_effect = {
		if = {
			limit = { has_country_flag = china_is_potential_government }
			clr_country_flag = china_is_potential_government

			if = {
				limit = { has_cosmetic_tag = KUM_government_zhongying }
				set_cosmetic_tag = KUM_zhongying
			}
			else = {
				drop_cosmetic_tag = yes
			}

			for_each_scope_loop = {
				array = china_government_ambitions
				remove_claim_by = PREV
				clear_variable = ambition_area_@PREV
			}
			clear_array = china_government_ambitions

			for_each_loop = {
				array = china_possible_allies_array
				remove_targeted_decision = { decision = china_offer_alliance target = var:v }
			}
			clear_array = china_possible_allies_array

			for_each_loop = {
				array = china_possible_allies_array
				remove_targeted_decision = { decision = china_offer_alliance_northwest target = var:v }
			}
			clear_array = china_possible_allies_array_northwest
		}
	}
}

china_add_poor_army = {
	add_ideas = china_poor_army_3_officers
	set_country_flag = china_has_poor_army #enables china_army_reform_ai AI strategy plan
}

transfer_all_unit_leaders_to_ROOT = {
	every_unit_leader = {
		limit = { has_character_flag = CHI_original_unit_leader }
		hidden_effect = {
			remove_second_in_command_role = yes
			demote_to_general = yes
			remove_trait = { trait = recently_promoted }
		}
		set_nationality = ROOT
	}
}

transfer_all_unit_leaders_to_FROM = {
	every_unit_leader = {
		limit = { has_character_flag = CHI_original_unit_leader }
		hidden_effect = {
			remove_second_in_command_role = yes
			demote_to_general = yes
			remove_trait = { trait = recently_promoted }
		}
		set_nationality = FROM
	}
}

find_next_chinese_target = {
	get_highest_scored_country = {
		scorer = china_target_scorer
		var = global.china_target_tag
	}
	if = {
		limit = { NOT = { country_exists = CHN } }
		set_variable = { global.china_target_tag = FNG }
	}
}

#####################################
# LEP Collapse Effects
#####################################

LEP_league_war_find_victor = {
	if = {
		limit = {
			NOT = {
				country_exists = SQI
				country_exists = LEP
				country_exists = CHI
				country_exists = ANQ
			}
		}
		set_variable = { LEP.LEP_league_war_victor = -1 }
	}
	else_if = {
		limit = {
			country_exists = SQI
			NOT = {
				SQI = { has_government = authoritarian_democrat }
				country_exists = LEP
				country_exists = CHI
				country_exists = ANQ
			}
		}
		set_variable = { LEP.LEP_league_war_victor = SQI }
		SQI = {
			country_event = { id = shandong.500 days = 2 }
		}
	}
	else_if = {
		limit = {
			country_exists = LEP
			NOT = {
				country_exists = CHI
				country_exists = ANQ
			}
			OR = {
				NOT = { country_exists = SQI }
				SQI = { is_subject = yes }
				has_global_flag = LEP_collapse_SQI_out
			}
		}
		set_variable = { LEP.LEP_league_war_victor = LEP }
		LEP = {
			country_event = { id = lep.100 days = 2 }
		}
	}
	else_if = {
		limit = {
			country_exists = CHI
			NOT = {
				country_exists = LEP
				country_exists = ANQ
			}
			OR = {
				NOT = { country_exists = SQI }
				has_global_flag = LEP_collapse_SQI_out
			}
		}
		set_variable = { LEP.LEP_league_war_victor = CHI }
		CHI = {
			country_event = { id = CHI.midgame.000 days = 2 }
			country_event = { id = CHI.earlygame.005 days = 100 } #Friends on the Other Side
		}
	}
	else_if = {
		limit = {
			country_exists = ANQ
			NOT = {
				country_exists = LEP
				country_exists = CHI
			}
			OR = {
				NOT = { country_exists = SQI }
				has_global_flag = LEP_collapse_SQI_out
			}
		}
		set_variable = { LEP.LEP_league_war_victor = ANQ }
		ANQ = {
			set_country_flag = ANQ_feng_aid_undecided
			country_event = { id = anq.64 days = 2 }
			country_event = { id = CHI.earlygame.004 days = 10 } #A Shadowy Defector
		}
	}
	if = {
		limit = { has_variable = LEP.LEP_league_war_victor }
		set_global_flag = LEP_league_war_over
		clr_global_flag = LEP_war
		ANQ = {
			LEP_remove_collapse_dm = yes
		}
		SQI = {
			LEP_remove_collapse_dm = yes
		}
		CHI = {
			LEP_remove_collapse_dm = yes
		}
		LEP = {
			LEP_remove_collapse_dm = yes
		}
		if = {
			limit = { has_global_flag = LEP_wuxi_vp_increased }
			clr_global_flag = LEP_wuxi_vp_increased
			add_victory_points = { province = 10076 value = -10 }
		}
		#### Cleanup of LEP war decisions - ANQ
		ANQ = {
			remove_targeted_decision = { target = 606 decision = ANQ_Yangtze_River_Line }
			remove_targeted_decision = { target = 1050 decision = ANQ_Huai_River_Line }
			remove_targeted_decision = { target = 1047 decision = ANQ_Xuzhou_Rail_Line }
			remove_targeted_decision = { target = 1044 decision = ANQ_Nanchang_Rail_Line }
			remove_targeted_decision = { target = 597 decision = ANQ_Jinan_Rail_Line }
			remove_targeted_decision = { target = 1075 decision = ANQ_Nantong_Port_Line }
			remove_targeted_decision = { target = 803 decision = ANQ_Wenzhou_Port_Line }
			remove_targeted_decision = { target = 1066 decision = ANQ_Quanzhou_Port_Line }
			remove_targeted_decision = { target = 596 decision = ANQ_Hangzhou_Port_Line }
		}
	}
}

LEP_add_collapse_dm = {
	randomize_temp_variable = {
		var = days_to_fire_temp
		distribution = uniform
		min = 25
		max = 40
	}
	set_variable = { china_morale_collapse_rate = 0 }
	if = {
		limit = { tag = ANQ }
		if = {
			limit = { QIE = { has_country_flag = wu_intervenes_proANQ } }
			set_variable = { china_league_war_morale = 70 }
		}
		else = {
			set_variable = { china_league_war_morale = 45 }
		}

		add_ideas = league_collapse_ANQ

		set_variable = { LEP_dead_factor = 1 }
	}
	else_if = {
		limit = { tag = SQI }
		set_variable = { china_league_war_morale = 50 }

		add_ideas = league_collapse_SQI

		set_variable = { LEP_dead_factor = 1 }
	}
	else_if = {
		limit = { tag = CHI }
		set_variable = { china_league_war_morale = 90 }

		add_ideas = league_collapse_CHI

		set_variable = { LEP_dead_factor = 1 }
	}
	else_if = {
		limit = { tag = LEP }
		if = {
			limit = { QIE = { has_country_flag = wu_intervenes_proLEP } }
			set_variable = { china_league_war_morale = 65 }
		}
		else = {
			set_variable = { china_league_war_morale = 35 }
		}

		set_variable = { LEP_dead_factor = 1 }

		add_ideas = league_collapse_LEP
	}
	hidden_effect = {
		china_update_morale = yes
		country_event = { id = lepwar.2 days = 34 }
	}
}

LEP_create_militia_template = {
	if = {
		limit = { NOT = { has_template = "League War Militia" } }
		division_template = {
			name = "League War Militia"
			is_locked = yes
			division_names_group = CHYN_INF_01
			regiments = {
				irregular_infantry = { x = 0 y = 0 }
				irregular_infantry = { x = 0 y = 1 }
				irregular_infantry = { x = 0 y = 2 }
				irregular_infantry = { x = 0 y = 3 }
				irregular_infantry = { x = 0 y = 4 }
			}
		}
	}
}

LEP_remove_collapse_dm = {
	if = {
		limit = { has_idea = league_collapse_ANQ }

		remove_ideas = league_collapse_ANQ
		set_variable = { LEP_dead_factor = 2 }
	}
	else_if = {
		limit = { has_idea = league_collapse_SQI }

		remove_ideas = league_collapse_SQI
		set_variable = { LEP_dead_factor = 2 }
	}
	else_if = {
		limit = { has_idea = league_collapse_CHI }

		remove_ideas = league_collapse_CHI
		set_variable = { LEP_dead_factor = 2 }
	}
	else_if = {
		limit = { has_idea = league_collapse_LEP }

		remove_ideas = league_collapse_LEP
		set_variable = { LEP_dead_factor = 2 }
	}
	if = {
		limit = { has_idea = china_anti_stalemate_idea_2 }
		remove_ideas = china_anti_stalemate_idea_2
	}
	if = {
		limit = { has_template = "League War Militia" }
		delete_unit_template_and_units = { division_template = "League War Militia" }
	}
	if = {
		limit = { has_template = "Chinese Nationalist Militia" }
		delete_unit_template_and_units = { division_template = "Chinese Nationalist Militia" }
	}
	if = {
		limit = { has_template = "Warlord Militia" }
		delete_unit_template_and_units = { division_template = "Warlord Militia" }
	}
}

china_update_morale = {
	add_to_variable = { china_league_war_morale = change_league_war_morale_by }
	custom_effect_tooltip = china_morale_will_change_by

	clamp_variable = {
		var = china_league_war_morale
		min = 0
		max = 100
	}
	if = {
		limit = { check_variable = { china_league_war_morale > 60 } }
		set_variable = { china_league_war_flame_frame_var = 3 }
	}
	if = {
		limit = { check_variable = { china_league_war_morale > 30 } }
		set_variable = { china_league_war_flame_frame_var = 2 }
	}
	else = {
		set_variable = { china_league_war_flame_frame_var = 1 }
	}

	# Calculate Political Power Gain
	set_variable = { china_morale_dm_political_power_gain = china_league_war_morale }
	add_to_variable = { china_morale_dm_political_power_gain = -50 }
	multiply_variable = { china_morale_dm_political_power_gain = 0.5 }
	multiply_variable = { china_morale_dm_political_power_gain = 0.01 }

	# Calculate War Support
	set_variable = { china_morale_dm_war_support_factor = china_league_war_morale }
	add_to_variable = { china_morale_dm_war_support_factor = -50 }
	multiply_variable = { china_morale_dm_war_support_factor = 0.3 }
	multiply_variable = { china_morale_dm_war_support_factor = 0.01 }

	# Calculate Surrender Limit
	set_variable = { china_morale_dm_surrender_limit = china_league_war_morale }
	multiply_variable = { china_morale_dm_surrender_limit = 0.4 }
	add_to_variable = { china_morale_dm_surrender_limit = -30 }
	multiply_variable = { china_morale_dm_surrender_limit = 0.01 }

	# Calculate Breakthrough Factor
	set_variable = { china_morale_dm_breakthrough_factor = china_league_war_morale }
	multiply_variable = { china_morale_dm_breakthrough_factor = 0.25 }
	multiply_variable = { china_morale_dm_breakthrough_factor = 0.01 }

	hidden_effect = {
		if = {
			limit = { check_variable = { china_league_war_morale < 30 } }
			activate_mission = china_collapsing_morale
		}
	}
}

#####################################
# China resources decisions setup - initialized on startup
#####################################

china_setup_resources_decisions = {
	hidden_effect = {
		for_each_scope_loop = {
			array = global.china_tags_array
			#### Decisions that are not activated by focus ####
			activate_targeted_decision = { target = 1050 decision = ANQ_develop_huainan_steel_decision }
			activate_targeted_decision = { target = 613 decision = ANQ_develop_nanjing_steel_decision }
			activate_targeted_decision = { target = 597 decision = ANQ_develop_jinan_steel_decision }

			#### The decisions that are also unlocked by focuses and thus are not available by default for some tags ####
			if = {
				limit = { THIS = { NOT = { tag = FNG tag = MAN } } }
				activate_targeted_decision = { target = 716 decision = FNG_Expand_the_Anshan_Mines }
				activate_targeted_decision = { target = 716 decision = MAN_Aluminium_Extraction }
			}
			if = {
				limit = { THIS = { NOT = { tag = HNN } } }
				activate_targeted_decision = { target = 602 decision = ANQ_develop_changsa_steel_decision }
			}
			if = {
				limit = { THIS = { NOT = { tag = LEP } } }
				activate_targeted_decision = { target = 1012 decision = LEP_improved_tungsten_extraction }
			}
			if = {
				limit = { THIS = { NOT = { tag = LEC } } }
				activate_targeted_decision = { target = 609 decision = LEC_to_the_coal_fields }
			}
			if = {
				limit = { THIS = { NOT = { tag = GXC } } }
				activate_targeted_decision = { target = 800 decision = GXC_Fuguo_Coal_Mine }
			}
			if = {
				limit = { THIS = { NOT = { tag = QIE tag = SZC } } }
				activate_targeted_decision = { target = 614 decision = QIE_develop_tangshan_steel_decision }
				activate_targeted_decision = { target = 1060 decision = QIE_develop_hebei_steel_decision }
			}
			if = {
				limit = { THIS = { NOT = { tag = SQI } } }
				activate_targeted_decision = { target = 1044 decision = SQI_develop_jiangxi_tungsten_decision }
				activate_targeted_decision = { target = 1046 decision = SQI_develop_fujian_aluminium_decision }
			}
			if = {
				limit = { THIS = { NOT = { tag = SHX } } }
				activate_targeted_decision = { target = 1072 decision = SHX_expand_coal_mines1_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_expand_coal_mines2_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_improve_metal_refining1_decision }
				activate_targeted_decision = { target = 622 decision = SHX_improve_metal_refining2_decision }
				activate_targeted_decision = { target = 622 decision = SHX_improve_metal_refining3_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_further_resource_extraction1_decision }
				activate_targeted_decision = { target = 1072 decision = SHX_further_resource_extraction2_decision }
			}
			if = {
				limit = { THIS = { NOT = { tag = SZC } } }
				activate_targeted_decision = { target = 661 decision = SZC_Jialing_Coal_Fields }
				activate_targeted_decision = { target = 601 decision = SZC_The_Riches_Of_Xikang }
				activate_targeted_decision = { target = 661 decision = SZC_Extract_Natural_Gas1 }
				activate_targeted_decision = { target = 650 decision = SZC_Extract_Natural_Gas2 }
				activate_targeted_decision = { target = 605 decision = SZC_Extract_Natural_Gas3 }
			}
			if = {
				limit = { THIS = { NOT = { tag = SIK } } }
				activate_targeted_decision = { target = 617 decision = SIK_mineral_expedition }
				activate_targeted_decision = { target = 287 decision = SIK_open_mineral_mining }
				activate_targeted_decision = { target = 618 decision = SIK_northern_gold }
			}
			if = {
				limit = { THIS = { NOT = { tag = YUN } } }
				activate_targeted_decision = { target = 816 decision = YUN_mining1_decision }
				activate_targeted_decision = { target = 325 decision = YUN_mining2_decision }
				activate_targeted_decision = { target = 816 decision = YUN_mining3_decision }
				activate_targeted_decision = { target = 816 decision = YUN_mining4_decision }
			}
		}
	}
}

# GXC is the fallback
china_puppet_setup = {
	hidden_effect = { set_potential_national_government = yes }
	if = {
		limit = { tag = CHI }
		set_cosmetic_tag = united_china_kuomintang
		CHI_puppet_setup_effect = yes
	}
	else_if = {
		limit = { tag = LEP }
		set_cosmetic_tag = united_china
		set_politics = {
			ruling_party = paternal_autocrat
			elections_allowed = no
		}
		set_political_party = {
			ideology = paternal_autocrat
			popularity = 20
		}
		set_political_party = {
			ideology = market_liberal
			popularity = 60
		}
		set_temp_variable = { coalition_partner_var = token:market_liberal }
		add_to_coalition = yes
	}
	else_if = {
		limit = { tag = QIE }
		if = {
			limit = { ROOT = { tag = RUS } }
			set_cosmetic_tag = QIE_united_china
			set_politics = {
				ruling_party = authoritarian_democrat
				elections_allowed = no
			}
			set_political_party = {
				ideology = authoritarian_democrat
				popularity = 60
			}
		}
		else = {
			set_cosmetic_tag = united_china
			set_politics = {
				ruling_party = authoritarian_democrat
				elections_allowed = no
			}
			set_political_party = {
				ideology = authoritarian_democrat
				popularity = 60
			}
			hidden_effect = {
				if = {
					limit = { has_character = QIE_yan_huiqing }
					QIE_yan_huiqing = { promote_character = authoritarian_democrat_subtype }
				}
				else = {
					random_list = {
						1 = {
							QIE_wellington_koo = {
								set_nationality = PREV
								promote_character = yes
							}
						}
						1 = {
							QIE_hu_shih = {
								set_nationality = PREV
								promote_character = yes
							}
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = { tag = FNG }
		if = {
			limit = { FNG_JAP_hostile = no }
			set_cosmetic_tag = united_china
			set_politics = {
				ruling_party = authoritarian_democrat
				elections_allowed = no
			}
			hidden_effect = {
				set_popularities = {
					totalist = 0
					radical_socialist = 0
					syndicalist = 0
					social_democrat = 0
					social_liberal = 0
					market_liberal = 42
					social_conservative = 10
					authoritarian_democrat = 28
					paternal_autocrat = 20
					national_populist = 0
				}
			}
		}
		else = {
			set_cosmetic_tag = FNG_JAP
			set_global_flag = FNG_projapan
			if = {
				limit = { has_character = FNG_zhang_zuolin }
				retire_character = FNG_zhang_zuolin
			}
			if = {
				limit = { has_character = FNG_zhang_xueliang }
				retire_character = FNG_zhang_xueliang
			}
			if = {
				limit = { has_character = FNG_wu_junsheng }
				retire_character = FNG_wu_junsheng
			}
			FNG_tang_shaoyi = {
				if = {
					limit = { has_ideology = market_liberal_subtype }
					promote_character = market_liberal_subtype
				}
				else = {
					add_country_leader_role = {
						country_leader = {
							ideology = market_liberal_subtype
							desc = FNG_tang_shaoyi_leader_desc
						}
						promote_leader = yes
					}
				}
			}
			set_politics = {
				ruling_party = market_liberal
				elections_allowed = no
			}
			add_popularity = {
				ideology = market_liberal
				popularity = 0.4
			}
			hidden_effect = {
				remove_ideas = {
					FNG_Disastrous_Governance
					FNG_Plutocratic_Exploitation
					FNG_Expel_the_Japanese_Bandits
				}
				# FNG_grand_marshals_favor_category
				remove_targeted_decision = { target = THIS decision = FNG_favor_concordia_association }
				remove_targeted_decision = { target = THIS decision = FNG_favor_communications_clique }
				remove_targeted_decision = { target = THIS decision = FNG_favor_recovery_league }
				remove_targeted_decision = { target = THIS decision = FNG_favor_zhang_clique }
				# FNG_fixing_the_economy_category
				remove_targeted_decision = { target = THIS decision = FNG_Centralise_the_Banks }
				remove_targeted_decision = { target = THIS decision = FNG_Re_Introduce_the_Fengtian_Dollar }
				remove_targeted_decision = { target = THIS decision = FNG_Fill_the_Silver_Reserve }
				remove_targeted_decision = { target = THIS decision = FNG_Encourage_Japanese_Investment }
				remove_targeted_decision = { target = THIS decision = FNG_Encourage_Chinese_Investment }
				# china_army_decisions
				remove_targeted_decision = { target = THIS decision = FNG_Militarize_the_Minsheng_Truck }
				remove_targeted_decision = { target = THIS decision = FNG_Revise_our_Position_on_Looting }
				remove_targeted_decision = { target = THIS decision = FNG_Rebuild_the_Second_Army }
				remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Cangzhou }
				remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Kaifeng }
				remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Ruyang }
				remove_targeted_decision = { target = THIS decision = FNG_Raise_Independent_Brigades_in_Guanzhong }
				remove_targeted_decision = { target = THIS decision = FNG_Raise_the_Baoding_Cadet_Corps }
				# FNG_Preparing_For_The_Princes_Visit
				remove_targeted_decision = { target = THIS decision = FNG_increase_security_in_shenyang }
				remove_targeted_decision = { target = THIS decision = FNG_investigate_the_junior_officer_corps }
				remove_targeted_decision = { target = THIS decision = FNG_reinforce_soldierly_discipline }
				remove_targeted_decision = { target = THIS decision = FNG_present_chinese_modernity }
				remove_targeted_decision = { target = THIS decision = FNG_Fortress_Manchuria }
				# FNG_railways
				remove_targeted_decision = { target = THIS decision = FNG_The_Jinhan_Railway }
				remove_targeted_decision = { target = THIS decision = FNG_The_Jinpu_Railway }
				remove_targeted_decision = { target = THIS decision = FNG_The_Yuehan_Railway }
				remove_targeted_decision = { target = THIS decision = FNG_Railway_Construction_Jilin_Hailong }
				remove_targeted_decision = { target = THIS decision = FNG_Railway_Construction_Changchun_Dalai }
				remove_targeted_decision = { target = THIS decision = FNG_Railway_Construction_Taonan_Suolun }
				# FNG_foreign_policy
				remove_targeted_decision = { target = QIE decision = FNG_Denounce_Qing_Monarchism }
				remove_targeted_decision = { target = GER decision = FNG_Denounce_German_Imperialism }
				remove_targeted_decision = { target = THIS decision = FNG_National_Irredentism }
				remove_targeted_decision = { target = THIS decision = FNG_Wu_Wang_Zai_Ju }
				remove_targeted_decision = { target = THIS decision = FNG_Escalate_the_Propaganda_War }
				remove_targeted_decision = { target = THIS decision = FNG_The_Yanshan_Plan }
				remove_targeted_decision = { target = THIS decision = FNG_Shanhaiguan_Infiltration }
				remove_targeted_decision = { target = SQI decision = FNG_Annex_Shandong_Anqing_Puppet }
				# FNG_Commission_Japanese_Ships
				remove_targeted_decision = { target = JAP decision = FNG_JAP_destroyers }
				remove_targeted_decision = { target = JAP decision = FNG_JAP_subs }
				remove_targeted_decision = { target = JAP decision = FNG_JAP_cruisers }
				remove_targeted_decision = { target = JAP decision = FNG_JAP_convoys }
			}
		}
	}
	else = {
		if = {
			limit = { ROOT = { has_authoritarian_government = yes } }
			set_cosmetic_tag = united_china_kuomintang_guangxi
			load_focus_tree = KR_RKMT
			if = {
				limit = { original_tag = GXC }
				GXC_li_zongren = {
					set_nationality = GXC
					promote_character = yes
				}
			}
			set_politics = {
				ruling_party = authoritarian_democrat
				elections_allowed = no
			}
			set_political_party = {
				ideology = authoritarian_democrat
				popularity = 60
			}
		}
		else = {
			set_cosmetic_tag = united_china_federalist
			load_focus_tree = Federalist_China_Tree
			save_global_event_target_as = UPC_leader
			set_politics = {
				ruling_party = social_liberal
				elections_allowed = no
			}
			set_political_party = {
				ideology = social_liberal
				popularity = 60
			}
			hidden_effect = {
				remove_ideas = {
					GXC_RKMT_angry_merchants
					GXC_RKMT_appeased_merchants
					GXC_RKMT_weary_gentry
					GXC_RKMT_rent_caps
					GXC_kmt_comissar_idea
					GXC_provisional_yuan_idea
					GXC_legislative_yuan_idea
					KR_RKMT_popular_support_1
					KR_RKMT_popular_support_2
					KR_RKMT_popular_support_3
					KR_RKMT_popular_support_4
					KR_RKMT_popular_support_5
					GXC_rkmt_spy_idea
					GXC_economic_instability
					GXC_economic_instability2
					GXC_economic_instability3
					GXC_economic_instability4
					GXC_economic_instability5
					GXC_low_literacy
					GXC_low_literacy2
					GXC_low_literacy3
					GXC_low_literacy4
					GXC_golden_decade
					GXC_rkmt_revolution
					GXC_rkmt_revolution2
					GXC_rkmt_revolution3
					GXC_kmt_cic_idea
					GXC_nra_idea
					GXC_kmt_demobilisation
					GXC_kmt_demobilisation2
					GXC_kmt_demobilisation3
					GXC_kmt_demobilisation4
					GXC_kmt_naval_reforms1
					GXC_kmt_naval_reforms2
					GXC_kmt_naval_reforms3
					GXC_kmt_naval_reforms4
					GXC_kmt_naval_reforms5
					GXC_kmt_naval_reforms6
				}
			}
		}
	}
}

china_integrate_ally_effect = {
	if = {
		limit = { FROM = { tag = CHI } }
		CHI_recruit_all_generals_from_THIS = yes
	}
	transfer_all_unit_leaders_to_FROM = yes
	every_subject_country = {
		get_current_government_type = yes
		FROM = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_integrated_puppet
				end_wars = no
			}
		}
		restore_previous_government_type = yes
	}
	every_owned_state = {
		limit = {
			is_core_china = yes
			is_claim_or_core_of_FROM = no
		}
		add_claim_by = FROM
	}
	FROM = {
		annex_country = {
			target = ROOT
			transfer_troops = yes
		}
	}
	if = {
		limit = { is_ai = no }
		FROM = { change_tag_from = ROOT }
	}
}

china_integrate_TARGET_effect = {
	set_temp_variable = { integrator = THIS }
	event_target:target = {
		clr_country_flag = FNG_promised_autonomy
		if = {
			limit = { var:integrator = { tag = CHI } }
			CHI_recruit_all_generals_from_THIS = yes
		}
		every_unit_leader = {
			limit = { has_character_flag = CHI_original_unit_leader }
			hidden_effect = {
				remove_second_in_command_role = yes
				demote_to_general = yes
				remove_trait = { trait = recently_promoted }
			}
			set_nationality = var:integrator
		}
		every_subject_country = {
			custom_effect_tooltip = tooltip_white_line
			get_current_government_type = yes
			var:integrator = { puppet = PREV }
			restore_previous_government_type = yes
		}
		custom_effect_tooltip = tooltip_white_line
		if = {
			limit = { has_variable = integrator:can_integrate_@event_target:target }
			every_core_state = {
				limit = {
					NOT = { is_core_of = var:integrator }
					core_of_PREV_can_be_integrated_by_ROOT = yes
				}
				add_core_of = var:integrator
			}
			every_core_state = {
				limit = {
					is_china_claim_area = yes
					NOT = { is_core_of = var:integrator }
					core_of_PREV_can_be_integrated_by_ROOT = no
				}
				add_claim_by = var:integrator
			}
			hidden_effect = {
				every_core_state = {
					limit = { check_variable = { core_countries^num > 1 } }
					remove_core_of = PREV
				}
			}
		}
		else = {
			every_core_state = {
				limit = {
					is_china_claim_area = yes
					NOT = { is_core_of = var:integrator }
				}
				add_claim_by = var:integrator
			}
		}
	}
	custom_effect_tooltip = tooltip_white_line
	annex_country = {
		target = event_target:target
		transfer_troops = yes
	}
	if = {
		limit = { event_target:target = { is_ai = no } }
		change_tag_from = event_target:target
	}
}

china_kmt_set_cosmetic_effect = {
	if = {
		limit = {
			var:new_overlord = { china_is_aligned_with_kmt = yes }
			NOT = { var:new_overlord = { check_variable = { country_leader:china_alignment = token:chinese_republican } } }
		}
		#In Alphabetical Order for ease of search
		if = {
			limit = { original_tag = GXC }
			set_cosmetic_tag = GXC_KMT
		}
		else_if = {
			limit = { original_tag = HNN }
			set_cosmetic_tag = HNN_KMT
		}
		else_if = {
			limit = {
				original_tag = SHX
				has_cosmetic_tag = SHX_NCPC
			}
			set_cosmetic_tag = SHX_NCPC_KMT
		}
		else_if = {
			limit = { original_tag = SHX }
			set_cosmetic_tag = SHX_KMT
		}
		else_if = {
			limit = { original_tag = SIK }
			set_cosmetic_tag = SIK_KMT
		}
		else_if = {
			limit = { original_tag = SZC }
			set_cosmetic_tag = SZC_KMT
		}
		else_if = {
			limit = { original_tag = XSM }
			set_cosmetic_tag = XSM_KMT
		}
		else_if = {
			limit = { original_tag = YUN }
			set_cosmetic_tag = YUN_KMT
		}
	}
}

china_puppet_ROOT_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		ROOT = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
			}
		}
	}
	set_autonomy = {
		target = ROOT
		autonomy_state = kr_associated_governorate
		end_wars = no
	}
	hidden_effect = {
		if = {
			limit = { has_wargoal_against = ROOT }
			remove_wargoal = { target = ROOT type = all }
		}
		ROOT = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV
			}
			if = {
				limit = { has_wargoal_against = PREV }
				remove_wargoal = { target = PREV type = all }
			}
			china_kmt_set_cosmetic_effect = yes
		}
	}
}

china_puppet_PREV_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		PREV = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
			}
		}
	}
	set_autonomy = {
		target = PREV
		autonomy_state = kr_associated_governorate
		end_wars = no
	}
	hidden_effect = {
		if = {
			limit = { has_wargoal_against = PREV }
			remove_wargoal = { target = PREV type = all }
		}
		PREV = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
			if = {
				limit = { has_wargoal_against = PREV }
				remove_wargoal = { target = PREV type = all }
			}
			china_kmt_set_cosmetic_effect = yes
		}
	}
}

china_puppet_FROM_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		FROM = {
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_chinese_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_associated_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
				china_kmt_set_cosmetic_effect = yes
			}
			get_current_government_type = yes
		}
	}
	set_autonomy = {
		target = FROM
		autonomy_state = kr_associated_governorate
		end_wars = no
	}
	hidden_effect = {
		FROM = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
			china_kmt_set_cosmetic_effect = yes
		}
	}
}

china_puppet_TARGET_effect = {
	hidden_effect = { var:target = { get_current_government_type = yes } }
	set_autonomy = {
		target = var:target
		autonomy_state = kr_associated_governorate
		end_wars = no
	}
	hidden_effect = {
		var:target = {
			restore_previous_government_type = yes
			clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
			china_kmt_set_cosmetic_effect = yes
		}
	}
}

china_break_puppet_effect = {
	if = {
		limit = { china_is_governorate = yes }
		leave_faction = yes
		overlord = {
			set_temp_variable = { former_overlord = THIS }
			set_autonomy = {
				target = PREV
				autonomy_state = autonomy_free
			}
		}
		peace_out_non_neighbours_after_leaving_faction = yes
		every_owned_state = {
			limit = {
				is_core_china = yes
				NOT = { is_core_of = var:former_overlord }
			}
			add_claim_by = var:former_overlord
		}
		if = {
			limit = { has_cosmetic_tag = SHX_NCPC_KMT }
			set_cosmetic_tag = SHX_NCPC
		}
		else_if = {
			limit = {
				original_tag = YUN
				has_cosmetic_tag = YUN_KMT
				check_variable = { country_leader:china_alignment = token:right_kuomintang }
			}
			set_cosmetic_tag = YUN_NRA
		}
		else_if = {
			limit = {
				OR = {
					has_cosmetic_tag = GXC_KMT
					has_cosmetic_tag = HNN_KMT
					has_cosmetic_tag = SHX_KMT
					has_cosmetic_tag = SIK_KMT
					has_cosmetic_tag = SZC_KMT
					has_cosmetic_tag = XSM_KMT
					has_cosmetic_tag = YUN_KMT
				}
			}
			drop_cosmetic_tag = yes
		}
	}
}

china_generic_set_government_cosmetic_effect = {
	if = {
		limit = { original_tag = ANQ }
		set_cosmetic_tag = ANQ_government
	}
	else_if = {
		limit = { original_tag = CHI }
		set_cosmetic_tag = CHI_government
		complete_national_focus = CHI_second_national_congress
		set_country_flag = CHI_phase_two_begins_flag
	}
	else_if = {
		limit = { original_tag = GXC }
		if = {
			limit = { capital_scope = { state = 594 } } #Nanning
			set_cosmetic_tag = GXC_government_nanning
		}
		else = {
			set_cosmetic_tag = GXC_government_guangzhou
		}
	}
	else_if = {
		limit = { original_tag = HNN }
		set_cosmetic_tag = HNN_government
	}
	else_if = {
		limit = { original_tag = KUM }
		if = {
			limit = { has_cosmetic_tag = KUM_zhongying }
			set_cosmetic_tag = KUM_government_zhongying
		}
		else = {
			set_cosmetic_tag = KUM_government
		}
	}
	else_if = {
		limit = { original_tag = LEP }
		set_cosmetic_tag = LEP_government
	}
	else_if = {
		limit = { original_tag = SHX }
		SHX_new_republic = yes
	}
	else_if = {
		limit = { original_tag = SIK }
		set_cosmetic_tag = SIK_government
	}
	else_if = {
		limit = { original_tag = SQI }
		if = {
			limit = { has_government = national_populist }
			if = {
				limit = {
					owns_state = 608
					controls_state = 608
				}
				set_capital = { state = 608 remember_old_capital = no }
			}
			set_cosmetic_tag = SQI_government_yiguandao
			QIE = {
				QIE_aisin_gioro_puyi = {
					hidden_effect = {
						set_nationality = ROOT
						remove_all_country_leader_roles = yes
					}
					set_portraits = {
						character = QIE_aisin_gioro_puyi
						civilian = { large = gfx/leaders/QIE/Portrait_QIE_Puyi_Uniform.png }
					}
					add_country_leader_role = {
						country_leader = {
							desc = QIE_aisin_gioro_puyi_yiguandao_leader_desc
							ideology = national_populist_subtype
							traits = { SQI_imprisoned_emperor }
						}
						promote_leader = yes
					}
				}
			}
		}
		else_if = {
			limit = {
				613 = {
					is_owned_and_controlled_by = PREV
					is_capital = yes }
			}
			set_cosmetic_tag = SQI_government_nanjing
		}
		else = {
			set_cosmetic_tag = SQI_government
		}
	}
	else_if = {
		limit = { original_tag = SZC }
		if = {
			limit = { has_country_leader = { character = GXC_chen_jiongming } }
			set_cosmetic_tag = SZC_government_federalist
		}
		else_if = {
			limit = {
				OR = {
					has_country_leader = { character = QIE_yan_huiqing }
					has_country_leader = { character = QIE_jiang_baili }
				}
			}
			set_cosmetic_tag = SZC_zhili_clique
		}
		else_if = {
			limit = { capital_scope = { state = 605 } } #Chengdu
			set_cosmetic_tag = SZC_government_chengdu
		}
		else = {
			set_cosmetic_tag = SZC_government_chongqing
		}
	}
	else_if = {
		limit = { original_tag = YUN }
		if = {
			limit = { check_variable = { country_leader:china_alignment = token:right_kuomintang } }
			set_cosmetic_tag = YUN_NRA
		}
		else = {
			set_cosmetic_tag = YUN_government
		}
	}
	else_if = {
		limit = { original_tag = XSM }
		if = {
			limit = { XSM = { capital_scope = { state = 348 } } }
			set_cosmetic_tag = XSM_government_yinchuan
		}
		else = {
			set_cosmetic_tag = XSM_government_lanzhou
		}
	}
}

china_autonomy_level_up = {
	hidden_effect = { get_current_government_type = yes }
	if = {
		limit = { has_autonomy_state = kr_integrated_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = kr_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_autonomous_governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = kr_autonomous_governorate }
		FROM = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_associated_governorate
				end_wars = no
			}
		}
	}
	hidden_effect = { restore_previous_government_type = yes }
}

china_autonomy_level_down = {
	hidden_effect = { get_current_government_type = yes }
	if = {
		limit = { has_autonomy_state = kr_associated_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_autonomous_governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = kr_autonomous_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_governorate
				end_wars = no
			}
		}
	}
	else_if = {
		limit = { has_autonomy_state = kr_governorate }
		overlord = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_integrated_governorate
				end_wars = no
			}
		}
	}
	hidden_effect = { restore_previous_government_type = yes }
}

china_generate_chinese_theorists = {
	### make sure that the below are exactly the same as in history/general/china_advisors
	generate_character = {
		token_base = china_northern_school
		advisor = {
			name = china_northern_school
			desc = china_northern_school_desc
			slot = theorist
			traits = { KR_northern_school }
			ledger = army
			cost = 100
		}
		portraits = {
			army = { small = GFX_idea_doctrinal_orthodoxy_spirit }
		}
	}
	generate_character = {
		token_base = china_southern_school
		advisor = {
			name = china_southern_school
			desc = china_southern_school_desc
			slot = theorist
			traits = { KR_southern_school }
			ledger = army
			cost = 100
		}
		portraits = {
			army = { small = GFX_idea_upbeat_command_spirit }
		}
	}
	generate_character = {
		token_base = china_green_forest_school
		advisor = {
			name = china_green_forest_school
			desc = china_green_forest_school_desc
			slot = theorist
			traits = { KR_green_forest_school }
			ledger = army
			cost = 100
		}
		portraits = {
			army = { small = GFX_idea_traditionalism_academy_spirit }
		}
	}
}

china_enable_non_government_demand_submission_decisions = {
	effect_tooltip = {
		if = {
			limit = {
				can_declare_war_on = QIE
				OR = {
					QIE = { china_is_potential_government = no }
					QIE = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = QIE }
		}
		if = {
			limit = {
				can_declare_war_on = FNG
				OR = {
					FNG = { china_is_potential_government = no }
					FNG = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = FNG }
		}
		if = {
			limit = {
				can_declare_war_on = SHX
				OR = {
					SHX = { china_is_potential_government = no }
					SHX = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = SHX }
		}
		if = {
			limit = {
				can_declare_war_on = GXC
				OR = {
					GXC = { china_is_potential_government = no }
					GXC = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = GXC }
		}
		if = {
			limit = {
				can_declare_war_on = YUN
				OR = {
					YUN = { china_is_potential_government = no }
					YUN = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = YUN }
		}
		if = {
			limit = {
				can_declare_war_on = HNN
				OR = {
					HNN = { china_is_potential_government = no }
					HNN = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = HNN }
		}
		if = {
			limit = {
				can_declare_war_on = SZC
				OR = {
					SZC = { china_is_potential_government = no }
					SZC = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = SZC }
		}
		if = {
			limit = {
				can_declare_war_on = LEP
				OR = {
					LEP = { china_is_potential_government = no }
					LEP = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = LEP }
		}
		if = {
			limit = {
				can_declare_war_on = ANQ
				OR = {
					ANQ = { china_is_potential_government = no }
					ANQ = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = ANQ }
		}
		if = {
			limit = {
				can_declare_war_on = CHI
				OR = {
					CHI = { china_is_potential_government = no }
					CHI = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = CHI }
		}
		if = {
			limit = {
				can_declare_war_on = SQI
				OR = {
					SQI = { china_is_potential_government = no }
					SQI = { china_is_unaligned = yes } #NPA
				}
			}
			activate_targeted_decision = { decision = china_demand_submission target = SQI }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				OR = {
					china_is_potential_government = no
					china_is_unaligned = yes
				}
				NOT = { original_tag = XSM }
				NOT = { original_tag = KUM }
				NOT = { original_tag = SIK }
			}
			add_to_array = { ROOT.china_possible_targets_array = THIS }
		}
	}
}

china_enable_all_demand_submission_decisions = {
	effect_tooltip = {
		if = {
			limit = { can_declare_war_on = QIE }
			activate_targeted_decision = { decision = china_demand_submission target = QIE }
		}
		if = {
			limit = { can_declare_war_on = FNG }
			activate_targeted_decision = { decision = china_demand_submission target = FNG }
		}
		if = {
			limit = { can_declare_war_on = SHX }
			activate_targeted_decision = { decision = china_demand_submission target = SHX }
		}
		if = {
			limit = { can_declare_war_on = GXC }
			activate_targeted_decision = { decision = china_demand_submission target = GXC }
		}
		if = {
			limit = { can_declare_war_on = YUN }
			activate_targeted_decision = { decision = china_demand_submission target = YUN }
		}
		if = {
			limit = { can_declare_war_on = HNN }
			activate_targeted_decision = { decision = china_demand_submission target = HNN }
		}
		if = {
			limit = { can_declare_war_on = SZC }
			activate_targeted_decision = { decision = china_demand_submission target = SZC }
		}
		if = {
			limit = { can_declare_war_on = LEP }
			activate_targeted_decision = { decision = china_demand_submission target = LEP }
		}
		if = {
			limit = { can_declare_war_on = ANQ }
			activate_targeted_decision = { decision = china_demand_submission target = ANQ }
		}
		if = {
			limit = { can_declare_war_on = CHI }
			activate_targeted_decision = { decision = china_demand_submission target = CHI }
		}
		if = {
			limit = { can_declare_war_on = SQI }
			activate_targeted_decision = { decision = china_demand_submission target = SQI }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				NOT = { original_tag = XSM }
				NOT = { original_tag = KUM }
				NOT = { original_tag = SIK }
			}
			add_to_array = { ROOT.china_possible_targets_array = THIS }
		}
	}
}

china_enable_all_attack_decisions = {
	effect_tooltip = {
		if = {
			limit = { can_declare_war_on = QIE }
			activate_targeted_decision = { decision = china_attack_decision target = QIE }
		}
		if = {
			limit = { can_declare_war_on = FNG }
			activate_targeted_decision = { decision = china_attack_decision target = FNG }
		}
		if = {
			limit = { can_declare_war_on = SHX }
			activate_targeted_decision = { decision = china_attack_decision target = SHX }
		}
		if = {
			limit = { can_declare_war_on = GXC }
			activate_targeted_decision = { decision = china_attack_decision target = GXC }
		}
		if = {
			limit = { can_declare_war_on = YUN }
			activate_targeted_decision = { decision = china_attack_decision target = YUN }
		}
		if = {
			limit = { can_declare_war_on = HNN }
			activate_targeted_decision = { decision = china_attack_decision target = HNN }
		}
		if = {
			limit = { can_declare_war_on = LEP }
			activate_targeted_decision = { decision = china_attack_decision target = LEP }
		}
		if = {
			limit = { can_declare_war_on = ANQ }
			activate_targeted_decision = { decision = china_attack_decision target = ANQ }
		}
		if = {
			limit = { can_declare_war_on = CHI }
			activate_targeted_decision = { decision = china_attack_decision target = CHI }
		}
		if = {
			limit = { can_declare_war_on = SQI }
			activate_targeted_decision = { decision = china_attack_decision target = SQI }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				NOT = { original_tag = XSM }
				NOT = { original_tag = KUM }
				NOT = { original_tag = SIK }
			}
			ROOT = { activate_targeted_decision = { decision = china_attack_decision target = PREV } }
		}
	}
}

china_enable_outskirts_decisions = {
	if = {
		limit = { can_declare_war_on = XSM }
		add_to_array = { ROOT.china_possible_targets_array = XSM }
		effect_tooltip = { activate_targeted_decision = { target = XSM decision = china_demand_submission } }
	}
	if = {
		limit = { can_declare_war_on = MON }
		activate_targeted_decision = { decision = china_demand_annexation target = MON }
	}
	if = {
		limit = { can_declare_war_on = TIB }
		activate_targeted_decision = { decision = china_demand_annexation target = TIB }
	}
	if = {
		limit = { can_declare_war_on = SIK }
		add_to_array = { ROOT.china_possible_targets_array = SIK }
		effect_tooltip = { activate_targeted_decision = { target = SIK decision = china_demand_submission } }
	}
	if = {
		limit = { can_declare_war_on = KUM }
		if = {
			limit = { KUM = { has_country_flag = KUM_is_chinese_tag } }
			add_to_array = { ROOT.china_possible_targets_array = KUM }
			effect_tooltip = { activate_targeted_decision = { target = KUM decision = china_demand_submission } }
		}
		else = {
			activate_targeted_decision = { decision = china_demand_annexation target = KUM }
		}
	}
	if = {
		limit = { can_declare_war_on = ETS }
		activate_targeted_decision = { decision = china_demand_annexation target = ETS }
	}
}

china_enable_concession_decisions = {
	set_country_flag = china_concession_decisions_unlocked
	effect_tooltip = {
		if = {
			limit = { country_exists = LEC }
			activate_targeted_decision = { decision = china_negotiate_with_legation_cities target = LEC }
		}
		if = {
			limit = { var:326.owner = { is_chinese_tag = no } } #Hong Kong
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 326.owner }
		}
		if = {
			limit = { var:609.owner = { is_chinese_tag = no } } #Tianjin
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 609.owner }
		}
		if = {
			limit = { var:728.owner = { is_chinese_tag = no } } #Guangzhouwan
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 728.owner }
		}
		if = {
			limit = { var:729.owner = { is_chinese_tag = no } } #Macau
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 729.owner }
		}
		if = {
			limit = { var:744.owner = { is_chinese_tag = no } } #Qingdao
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 744.owner }
		}
		if = {
			limit = { var:745.owner = { is_chinese_tag = no } } #Kwantung
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 745.owner }
		}
		if = {
			limit = { var:996.owner = { is_chinese_tag = no } } #Weihaiwei
			activate_targeted_decision = { decision = china_request_return_of_concessions target = 996.owner }
		}
	}
}

china_generic_land_reform_setup = {
	set_variable = { China_land_reform_var = 100 }
	every_state = {
		limit = {
			OR = {
				is_china_claim_area = yes
				is_core_of = MON
			}
			OR = {
				has_state_category = one
				has_state_category = two
				has_state_category = three
			}
		}
		ROOT = {
			activate_targeted_decision = { target = PREV decision = china_generic_land_reform_decision }
		}
	}
}

china_add_research_slots = {
	if = {
		limit = { has_global_flag = china_united }
		add_research_slot_until_five = yes
	}
	else = {
		add_research_slot_until_four = yes
	}
}

china_generic_unification_effect = {
	log = "KR_Event_Logging;CHINA UNITED BY A minor clique;[GetDateText]"
	if = {
		limit = {
			OR = {
				has_cosmetic_tag = KUM_zhongying
				has_cosmetic_tag = KUM_government_zhongying
			}
		}
		set_cosmetic_tag = united_china_zhongying
	}
	else_if = {
		limit = { has_cosmetic_tag = KUM_government }
		set_cosmetic_tag = united_china_hami
	}
	else_if = {
		limit = {
			OR = {
				has_cosmetic_tag = GXC_guangxi
				has_cosmetic_tag = GXC_government_nanning
			}
		}
		set_cosmetic_tag = united_china_guangxi
	}
	else = {
		set_cosmetic_tag = united_china
	}
	add_ideas = CHS_legitimacy1
	add_ideas = CHS_bureaucracy1
	add_ideas = CHS_military1
	custom_effect_tooltip = enables_new_focus_branches
	activate_targeted_decision = { decision = china_move_capital target = ROOT }
}

china_army_reform_increase_step = {
	if = {
		limit = { has_idea = china_poor_army_3_officers }
		swap_ideas = {
			remove_idea = china_poor_army_3_officers
			add_idea = china_poor_army_2_officers
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_3 }
		swap_ideas = {
			remove_idea = china_poor_army_3
			add_idea = china_poor_army_2
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_2_officers }
		swap_ideas = {
			remove_idea = china_poor_army_2_officers
			add_idea = china_poor_army_1_officers
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_2 }
		swap_ideas = {
			remove_idea = china_poor_army_2
			add_idea = china_poor_army_1
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_1_officers }
		swap_ideas = {
			remove_idea = china_poor_army_1_officers
			add_idea = china_poor_army_0
		}
		clr_country_flag = china_has_poor_army #disables china_army_reform_ai AI strategy plan
	}
	else = {
		remove_ideas = china_poor_army_1
		clr_country_flag = china_has_poor_army #disables china_army_reform_ai AI strategy plan
	}
}

china_army_reform_remove_officer_penalty = {
	if = {
		limit = { has_idea = china_poor_army_3_officers }
		swap_ideas = {
			remove_idea = china_poor_army_3_officers
			add_idea = china_poor_army_3
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_2_officers }
		swap_ideas = {
			remove_idea = china_poor_army_2_officers
			add_idea = china_poor_army_2
		}
	}
	else_if = {
		limit = { has_idea = china_poor_army_1_officers }
		swap_ideas = {
			remove_idea = china_poor_army_1_officers
			add_idea = china_poor_army_1
		}
	}
	else = {
		remove_ideas = china_poor_army_0
	}
}

china_merges_wuhan = {
	1048 = { set_state_flag = wuhan_formed }
	set_victory_points = { province = 7167 value = 0 } #Wuchang
	set_victory_points = { province = 12467 value = 0 } #Hankou
	set_victory_points = { province = 4619 value = 20 } #Wuchang/Wuhan
	set_province_name = { id = 4619 name = VICTORY_POINTS_4619_WUHAN }
}

china_splits_wuhan = {
	1048 = { clr_state_flag = wuhan_formed }
	set_victory_points = { province = 4619 value = 12 } #Wuchang
	set_victory_points = { province = 12467 value = 5 } #Hanyang
	set_victory_points = { province = 7167 value = 5 } #Hankou
	set_province_name = { id = 4619 name = VICTORY_POINTS_4619 }
}
