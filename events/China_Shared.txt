###########################
# Shared Chinese Events
###########################

add_namespace = china_shared
add_namespace = china_redoubt

country_event = { #Fading Legitimacy!
	id = china_shared.1
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.1" }
	title = china_shared.1.t
	desc = china_shared.1.d

	is_triggered_only = yes

	option = {
		name = china_shared.1.a
		add_political_power = -20
	}
}

country_event = { #An United Front
	id = china_shared.2
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.2" }
	title = china_shared.2.t
	desc = china_shared.2.d

	is_triggered_only = yes

	option = {
		name = china_shared.2.a
		hidden_effect = {
			every_other_country = {
				limit = {
					OR = {
						is_han_chinese_tag = yes
						tag = TAN
						AND = {
							tag = TIB
							has_government = social_democrat
							NOT = {
								has_country_flag = attending_tokyo_conference
								has_country_flag = tokyo_conference_ally
								any_of_scopes = {
									array = ROOT.enemies
									is_han_chinese_tag = yes
								}
							}
						}
					}
					is_subject = no
					OR = {
						is_in_faction = no
						is_faction_leader = yes
					}
					NOT = { tag = FNG }
				}
				if = {
					limit = {
						NOT = {
							has_war_with = ROOT
							any_enemy_country = {
								OR = {
									is_han_chinese_tag = yes
									tag = TAN
								}
							}
						}
					}
					country_event = {
						id = china_shared.3
						days = 8
						random = 288
					}
				}
				else_if = {
					limit = {
						OR = {
							has_war_with = ROOT
							any_enemy_country = {
								OR = {
									is_han_chinese_tag = yes
									tag = TAN
								}
							}
						}
						surrender_progress < 0.5
					}
					country_event = {
						id = china_shared.4
						days = 8
						random = 288
					}
				}
			}
		}
	}
}

country_event = { #A Call For Unity
	id = china_shared.3
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.3" }
	title = china_shared.3.t
	desc = china_shared.3.d

	is_triggered_only = yes

	option = {
		name = china_shared.3.a #Yes, for the good of China
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				is_in_array = {
					array = FNG.FNG_conference_participants
					value = ROOT
				}
			}
			modifier = {
				add = -90
				is_ruled_by_pro_fengtian = yes
			}
		}
		set_country_flag = joined_united_front
		hidden_effect = {
			if = {
				limit = { is_faction_leader = yes }
				every_other_country = {
					limit = { is_in_faction_with = ROOT }
					country_event = {
						id = china_shared.3
						days = 5
						random = 120
					}
				}
			}
			FROM = {
				country_event = china_shared.4
			}
		}
	}

	option = {
		name = china_shared.3.b #No, we shall not join
		ai_chance = {
			factor = 0
			modifier = {
				add = 90
				is_ruled_by_pro_fengtian = yes
			}
			modifier = {
				factor = 0
				FROM = { has_country_flag = joined_united_front }
			}
		}
		hidden_effect = {
			FROM = {
				country_event = china_shared.5
			}
		}
	}
}

country_event = { #FROM joins the United Front
	id = china_shared.4
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.4" }
	title = china_shared.4.t
	desc = china_shared.4.d

	is_triggered_only = yes

	option = {
		name = china_shared.4.a
		add_political_power = 5
	}
}

country_event = { #FROM refuses to join the Front
	id = china_shared.5
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.5" }
	title = china_shared.5.t
	desc = china_shared.5.d

	is_triggered_only = yes

	option = {
		name = china_shared.5.a
		add_political_power = -5
	}
}

country_event = { #FROM Offers A Ceasefire
	id = china_shared.6
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.6" }
	title = china_shared.6.t
	desc = china_shared.6.d

	is_triggered_only = yes

	option = {
		name = china_shared.6.a #For now
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				is_in_array = {
					array = FNG.FNG_conference_participants
					value = ROOT
				}
			}
			modifier = {
				add = -90
				is_ruled_by_pro_fengtian = yes
			}
		}
		set_country_flag = joined_united_front
		chinese_united_front_ceasefire = yes
		FROM = {
			country_event = china_shared.7
		}
	}

	option = {
		name = china_shared.6.b #Never
		ai_chance = {
			factor = 0
			modifier = {
				add = 90
				is_ruled_by_pro_fengtian = yes
			}
		}
		custom_effect_tooltip = china_war_with_united_front
		FROM = {
			country_event = china_shared.8
		}
	}
}

country_event = { #FROM Accepts Ceasefire
	id = china_shared.7
	title = china_shared.7.t
	desc = china_shared.7.d

	is_triggered_only = yes

	immediate = {
		log = "[GetDateText]: [Root.GetName]: event china_shared.7"
		hidden_effect = {
			### peace out FROM and ROOT
			FROM = {
				save_event_target_as = white_peace_receiver
				white_peace_with_ROOT = yes
			}

			### peace out any future UF members
			every_other_country = {
				limit = {
					has_war_with = FROM
					has_country_flag = joined_united_front
				}
				white_peace_with_TARGET = yes
			}
		}
	}

	option = {
		name = china_shared.7.a
		custom_effect_tooltip = china_ceasefire_occupation_transfer
		effect_tooltip = {
			FROM = {
				white_peace_with_ROOT = yes
			}
		}
	}
}

country_event = { #FROM Refuses Ceasefire
	id = china_shared.8
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.8" }
	title = china_shared.8.t
	desc = china_shared.8.d

	is_triggered_only = yes

	option = {
		name = china_shared.8.a
	}
}

country_event = { #Formation of the United Front
	id = china_shared.9
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.9" }
	title = china_shared.9.t
	desc = china_shared.9.d

	is_triggered_only = yes

	option = {
		name = china_shared.9.a
		set_global_flag = chinese_united_front_formed
		save_global_event_target_as = chinese_united_front_leader
		if = {
			limit = { is_faction_leader = yes }
			set_faction_name = "Chinese United Front"
			for_each_scope_loop = {
				array = ROOT.faction_members
				set_country_flag = original_front_faction_member
			}
		}
		else = {
			create_faction = "Chinese United Front"
		}
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				is_faction_leader = yes
				has_country_flag = joined_united_front
			}
			save_faction_into_array = yes
			dismantle_faction = yes
		}
		every_other_country = {
			limit = {
				is_chinese_tag = yes
				has_country_flag = joined_united_front
			}
			ROOT = { add_to_faction = PREV }
		}
		setup_united_front_AI = yes
	}
}

country_event = { #The United Front Fails
	id = china_shared.10
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.10" }
	title = china_shared.10.t
	desc = china_shared.10.d

	trigger = {
		NOT = {
			any_of_scopes = {
				array = global.china_tags_array
				has_country_flag = joined_united_front
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = china_shared.9.a
		add_political_power = -100
	}
}

country_event = { #The United Front Collapses
	id = china_shared.11
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.11" }
	title = china_shared.11.t
	desc = china_shared.11.d

	trigger = {
		has_global_flag = chinese_united_front_formed
	}

	is_triggered_only = yes

	option = {
		name = china_shared.11.a
		add_political_power = -20
		hidden_effect = {
			clr_global_flag = chinese_united_front_formed
			clear_global_event_target = chinese_united_front_leader
			dismantle_faction = yes
			china_reform_faction = yes
			every_other_country = {
				limit = {
					has_country_flag = original_front_faction_member
				}
				clr_country_flag = original_front_faction_member
				set_global_flag = TEMPORARY_DISABLED_FACTION_POPUP
				ROOT = { add_to_faction = PREV }
			}
			every_other_country = {
				limit = { has_country_flag = was_chinese_faction_leader }
				clr_country_flag = was_chinese_faction_leader
				clear_array = THIS.chinese_faction_members
			}
			news_event = {
				id = china_shared.14
				days = 1
			}
		}
	}
}

country_event = { #FROM leaves the United Front
	id = china_shared.12
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.12" }
	title = china_shared.12.t
	desc = china_shared.12.d

	trigger = {
		has_global_flag = chinese_united_front_formed
	}

	is_triggered_only = yes

	option = {
		name = china_shared.12.a
	}
}

news_event = { #The Chinese United Front
	id = china_shared.13
	title = china_shared.13.t

	desc = {
		text = china_shared.13.d.pro_JAP
		trigger = {
			is_chinese_tag = yes
			is_working_with_JAP = yes
		}
	}
	desc = {
		text = china_shared.13.d.anti_JAP
		trigger = {
			is_chinese_tag = yes
			is_working_with_JAP = no
		}
	}
	desc = {
		text = china_shared.13.d.JAP
		trigger = {
			tag = JAP
		}
	}
	desc = {
		text = china_shared.13.d.others
		trigger = {
			NOT = { tag = JAP }
			is_chinese_tag = no
		}
	}

	picture = GFX_news_event_china_war

	major = yes
	show_major = {
		NOT = {
			tag = event_target:current_china_leader
		}
	}

	immediate = {
		log = "[GetDateText]: [Root.GetName]: event china_shared.13"
		hidden_effect = {
			every_state = {
				limit = {
					OR = {
						state = 608 #Beijing
						state = 613 #Nanjing
						state = 1048 #Wuhan
						state = 650 #Chongqing
						state = 607 #Luoyang
						state = 325 #Kunming
						state = 602 #Changsha
						state = 592 #Guangzhou
						state = 597 #Jinan
						state = 799 #Xi'an
					}
					controller = {
						OR = {
							tag = JAP
							AND = {
								NOT = { is_in_faction_with = JAP }
								is_ruled_by_pro_fengtian = yes
								FNG_JAP_hostile = no
							}
							is_in_array = {
								array = JAP.allies
								value = THIS
							}
						}
					}
				}
				set_state_flag = JAP_captures_this_state
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = china_shared.13.a
		trigger = {
			is_chinese_tag = yes
			is_working_with_JAP = yes
		}
	}
	option = {
		name = china_shared.13.b
		trigger = {
			is_chinese_tag = yes
			is_working_with_JAP = no
		}
	}
	option = {
		name = china_shared.13.c
		trigger = {
			tag = JAP
		}
	}
	option = {
		name = china_shared.13.e
		trigger = {
			NOT = { tag = JAP }
			is_chinese_tag = no
		}
	}
}

news_event = { #Collapse of the United Front
	id = china_shared.14
	title = china_shared.14.t
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_shared.14" }

	desc = {
		text = china_shared.14.d.CHI
		trigger = {
			is_chinese_tag = yes
		}
	}
	desc = {
		text = china_shared.14.d.JAP
		trigger = {
			tag = JAP
		}
	}
	desc = {
		text = china_shared.14.d.others
		trigger = {
			NOT = { tag = JAP }
			is_chinese_tag = no
		}
	}

	picture = GFX_news_event_china_war

	major = yes
	show_major = {
		NOT = {
			tag = event_target:current_china_leader
		}
	}

	is_triggered_only = yes

	option = {
		name = china_shared.14.a
		trigger = {
			is_chinese_tag = yes
		}
	}
	option = {
		name = china_shared.14.b
		trigger = {
			tag = JAP
		}
	}
	option = {
		name = china_shared.14.c
		trigger = {
			NOT = { tag = JAP }
			is_chinese_tag = no
		}
	}
}

country_event = { #The Government Flees
	id = china_redoubt.1
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_redoubt.1" }
	title = china_redoubt.1.t
	desc = china_redoubt.1.d

	trigger = {
		has_event_target = china_national_redoubt
		is_in_faction_with = event_target:china_national_redoubt
		event_target:china_national_redoubt = {
			has_capitulated = no
		}
	}

	is_triggered_only = yes

	option = {
		name = china_redoubt.1.a
		event_target:china_national_redoubt = {
			country_event = {
				id = china_redoubt.2
				days = 2
				random = 120
			}
		}
	}

	option = {
		name = china_redoubt.1.b
		trigger = {
			is_ai = no
		}
		event_target:china_national_redoubt = {
			country_event = china_redoubt.2
			change_tag_from = ROOT
		}
	}
}

country_event = { #The Government Reaches Sichuan/Yunnan
	id = china_redoubt.2
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_redoubt.2" }
	title = china_redoubt.2.t
	desc = china_redoubt.2.d

	trigger = {
		is_in_faction_with = event_target:current_china_leader
	}

	is_triggered_only = yes

	option = {
		name = china_redoubt.2.a
		every_other_country = {
			limit = { is_exiled_in = FROM }
			become_exiled_in = {
				target = ROOT
				legitimacy = 100
			}
		}
		FROM = {
			become_exiled_in = {
				target = ROOT
				legitimacy = 100
			}
		}
		central_government_flees_to_redoubt = yes
	}
}

country_event = { #The Government Returns Home
	id = china_redoubt.3
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_redoubt.3" }
	title = china_redoubt.3.t
	desc = china_redoubt.3.d

	is_triggered_only = yes

	option = {
		name = china_redoubt.3.a
		if = {
			limit = { is_government_in_exile = yes }
			end_exile = event_target:current_china_leader
		}
		central_government_returns = yes
	}

	option = {
		name = china_redoubt.3.b
		if = {
			limit = { is_government_in_exile = yes }
			end_exile = event_target:current_china_leader
		}
		central_government_returns = yes
		event_target:current_china_leader = {
			change_tag_from = ROOT
		}
	}
}

country_event = { #Ally Flees to the Redoubt
	id = china_redoubt.4
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_redoubt.4" }
	title = china_redoubt.4.t
	desc = china_redoubt.4.d

	trigger = {
		has_event_target = china_national_redoubt
		is_in_faction_with = event_target:china_national_redoubt
		event_target:china_national_redoubt = {
			has_capitulated = no
		}
	}

	is_triggered_only = yes

	option = {
		name = china_redoubt.4.a
		event_target:china_national_redoubt = {
			country_event = {
				id = china_redoubt.5
				days = 2
				random = 120
			}
		}
	}

	option = {
		name = china_redoubt.4.b
		trigger = {
			is_ai = no
		}
		event_target:china_national_redoubt = {
			country_event = china_redoubt.5
			change_tag_from = ROOT
		}
	}
}

country_event = { #Ally Reaches Sichuan/Yunnan
	id = china_redoubt.5
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_redoubt.5" }
	title = china_redoubt.5.t
	desc = china_redoubt.5.d

	trigger = {
		is_in_faction_with = FROM
	}

	is_triggered_only = yes

	option = {
		name = china_redoubt.5.a
		FROM = {
			become_exiled_in = {
				target = ROOT
				legitimacy = 100
			}
		}
	}
}

country_event = { #Ally Returns Home
	id = china_redoubt.6
	immediate = { log = "[GetDateText]: [Root.GetName]: event china_redoubt.6" }
	title = china_redoubt.6.t
	desc = china_redoubt.6.d

	is_triggered_only = yes

	option = {
		name = china_redoubt.6.a
		if = {
			limit = { is_government_in_exile = yes }
			end_exile = event_target:current_china_leader
		}
	}
}
